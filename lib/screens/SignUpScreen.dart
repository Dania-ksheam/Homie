// // // // // // // // // // // // // // // // // // // '
// // // // // // // // // // // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:test/extantion.dart';

// // // // // // // // // // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final String userType;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final VoidCallback changeLocale; // Function to change language

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const SignUpScreen({
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     Key? key,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     required this.userType,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     required this.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   }) : super(key: key);

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   _SignUpScreenState createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _phoneController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _bioController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _experienceController = TextEditingController();

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   String _selectedCategory = "Electrician";
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   String _selectedGender = "Male";
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   String? _avatarPath;

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   // Backend URL
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   final String backendUrl = "https://192.168.0.109:7127/api/User"; // Replace with your backend URL

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     final isServiceProvider = widget.userType == context.t.serviceProvider;

// // // // // // // // // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         title: Text("${context.t.signUp} - ${widget.userType}"),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           IconButton(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             icon: const Icon(Icons.language),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             onPressed: widget.changeLocale, // Call the passed language change function
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.start,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Name Input
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _nameController,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.username,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.userNameRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Email Input
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.email,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) =>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     value != null && value.contains('@') ? null : context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Password Input
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _passwordController,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.password,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 isPassword: true,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.passwordRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Confirm Password Input
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _confirmPasswordController,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.confirmPassword,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 isPassword: true,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   if (value != _passwordController.text) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.passwordMismatch;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Address Input
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _addressController,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.address,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.addressRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Phone Input with Libyan Country Code
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   Container(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     width: 80,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     padding: const EdgeInsets.symmetric(horizontal: 8.0),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     alignment: Alignment.center,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       color: Colors.grey[300],
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       borderRadius: BorderRadius.circular(8.0),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     child: const Text(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       "00218",
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   const SizedBox(width: 10),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     child: _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       controller: _phoneController,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       label: context.t.phoneNumber,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                         if (value == null || value.isEmpty || value.length < 8) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                           return context.t.phoneNumberInvalid;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                         }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                         return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Age Selection Dropdown
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 value: _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     _selectedAge = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 items: List.generate(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   82, // Generate ages from 18 to 99
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   (index) => (18 + index).toString(),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 ).map((age) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   return DropdownMenuItem<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     value: age,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     child: Text(age),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 }).toList(),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 decoration: InputDecoration(labelText: context.t.age),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.age;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Gender Selection
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               Text(context.t.gender, style: const TextStyle(fontWeight: FontWeight.bold)),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     value: "Male",
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.male),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     value: "Female",
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.female),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Service Provider Fields
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               if (isServiceProvider) ...[
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   controller: _bioController,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   label: context.t.bio,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   validatorMessage: context.t.allFieldsRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   controller: _experienceController,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   label: context.t.experience,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.number,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   validatorMessage: context.t.allFieldsRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   value: _selectedCategory,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       _selectedCategory = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   items: [
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     context.t.electrician,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     context.t.cleaning,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     context.t.plumbing,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                     context.t.teaching,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   ]
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       .map((category) => DropdownMenuItem<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                             value: category,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                             child: Text(category),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: context.t.category),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ],

// // // // // // // // // // // // // // // // // // // // // // // // // // // //               // Submit Button
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ElevatedButton(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 onPressed: _submitForm,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 style: ElevatedButton.styleFrom(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   minimumSize: const Size(double.infinity, 50),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 child: Text(context.t.signUp),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build text fields
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     bool isPassword = false,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(labelText: label),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       obscureText: isPassword,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ??
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   // Form submission
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   Future<void> _submitForm() async {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     if (_formKey.currentState!.validate()) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       final userDetails = {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "name": _nameController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "email": _emailController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "phone": "00218${_phoneController.text}",
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "address": _addressController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "age": _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "gender": _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "category": widget.userType == context.t.serviceProvider ? _selectedCategory : null,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "bio": _bioController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "experience": _experienceController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         "avatar": _avatarPath,
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // // // // // // // // // // // //       // Send data to backend
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           headers: {"Content-Type": "application/json"},
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           body: jsonEncode(userDetails),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // // // // // // // // // // // //         if (response.statusCode == 200) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           // Handle successful sign-up
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           print("Sign-up successful!");
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           // Handle error
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           print("Failed to sign up: ${response.body}");
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       } catch (error) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         print("Error connecting to the backend: $error");
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // // // // // // // // // import 'dart:io';

// // // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:test/extantion.dart';

// // // // // // // // // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final int userType; // Accepts 0 (Client) or 1 (Service Provider)
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final VoidCallback changeLocale;

// // // // // // // // // // // // // // // // // // // // // // // // // // //   const SignUpScreen({
// // // // // // // // // // // // // // // // // // // // // // // // // // //     Key? key,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     required this.userType,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     required this.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }) : super(key: key);

// // // // // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // // // // //   _SignUpScreenState createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _phoneController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _bioController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _experienceController = TextEditingController();

// // // // // // // // // // // // // // // // // // // // // // // // // // //   String _selectedCategory = "Electrician";
// // // // // // // // // // // // // // // // // // // // // // // // // // //   String _selectedGender = "Male";
// // // // // // // // // // // // // // // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // // // // // // // // // // //   bool _isPasswordVisible = false;
// // // // // // // // // // // // // // // // // // // // // // // // // // //   bool _isConfirmPasswordVisible = false;

// // // // // // // // // // // // // // // // // // // // // // // // // // //   final String backendUrl = "https://192.168.0.109:7127/api/User"; // Replace with your backend URL

// // // // // // // // // // // // // // // // // // // // // // // // // // //   final ImagePicker _imagePicker = ImagePicker();

// // // // // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //     final isServiceProvider = widget.userType == 1;

// // // // // // // // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // // // // // // // //         title: Text("${context.t.signUp} - ${widget.userType == 0 ? context.t.client : context.t.serviceProvider}"),
// // // // // // // // // // // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // // // // // // // // // // //           IconButton(
// // // // // // // // // // // // // // // // // // // // // // // // // // //             icon: const Icon(Icons.language),
// // // // // // // // // // // // // // // // // // // // // // // // // // //             onPressed: widget.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // // // // // // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.start,
// // // // // // // // // // // // // // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Avatar Upload
// // // // // // // // // // // // // // // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 child: GestureDetector(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     radius: 50,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     backgroundImage: _avatarImage != null
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         ? FileImage(_avatarImage!)
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         : const AssetImage("images/default_avatar.png") as ImageProvider,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         ? const Icon(Icons.camera_alt, size: 30, color: Colors.white)
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Name Input
// // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _nameController,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.username,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.userNameRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Email Input
// // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.email,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) =>
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     value != null && value.contains('@') ? null : context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Password Input with Toggle
// // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildPasswordField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _passwordController,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.password,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 isPasswordVisible: _isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 onVisibilityToggle: () {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     _isPasswordVisible = !_isPasswordVisible;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.passwordRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Confirm Password Input with Toggle
// // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildPasswordField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _confirmPasswordController,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.confirmPassword,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 isPasswordVisible: _isConfirmPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 onVisibilityToggle: () {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     _isConfirmPasswordVisible = !_isConfirmPasswordVisible;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   if (value != _passwordController.text) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.passwordMismatch;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Address Input
// // // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _addressController,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.address,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.addressRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Phone Input with Libyan Country Code
// // // // // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   Container(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     width: 80,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     padding: const EdgeInsets.symmetric(horizontal: 8.0),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     alignment: Alignment.center,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       color: Colors.grey[300],
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       borderRadius: BorderRadius.circular(8.0),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     child: const Text(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       "00218",
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   const SizedBox(width: 10),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     child: _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       controller: _phoneController,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       label: context.t.phoneNumber,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         if (value == null || value.isEmpty || value.length < 8) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                           return context.t.phoneNumberInvalid;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         }
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Age Selection Dropdown
// // // // // // // // // // // // // // // // // // // // // // // // // // //               DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 value: _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     _selectedAge = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 items: List.generate(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   82, // Generate ages from 18 to 99
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   (index) => (18 + index).toString(),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 ).map((age) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   return DropdownMenuItem<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     value: age,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     child: Text(age),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   );
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 }).toList(),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 decoration: InputDecoration(labelText: context.t.age),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.age;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Gender Selection
// // // // // // // // // // // // // // // // // // // // // // // // // // //               Text(context.t.gender, style: const TextStyle(fontWeight: FontWeight.bold)),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     value: "Male",
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.male),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     value: "Female",
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.female),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Service Provider Fields
// // // // // // // // // // // // // // // // // // // // // // // // // // //               if (isServiceProvider) ...[
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   controller: _bioController,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   label: context.t.bio,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   validatorMessage: context.t.allFieldsRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //                 _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   controller: _experienceController,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   label: context.t.experience,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.number,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   validatorMessage: context.t.allFieldsRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   value: _selectedCategory,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       _selectedCategory = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   items: [
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     context.t.electrician,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     context.t.cleaning,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     context.t.plumbing,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                     context.t.teaching,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   ]
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       .map((category) => DropdownMenuItem<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                             value: category,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                             child: Text(category),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: context.t.category),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ],

// // // // // // // // // // // // // // // // // // // // // // // // // // //               // Submit Button
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ElevatedButton(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 onPressed: _submitForm,
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 style: ElevatedButton.styleFrom(
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   minimumSize: const Size(double.infinity, 50),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 child: Text(context.t.signUp),
// // // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build text fields
// // // // // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(labelText: label),
// // // // // // // // // // // // // // // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ??
// // // // // // // // // // // // // // // // // // // // // // // // // // //           (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //             if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //               return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // // // // //             }
// // // // // // // // // // // // // // // // // // // // // // // // // // //             return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build password fields with visibility toggle
// // // // // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildPasswordField({
// // // // // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     required bool isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     required VoidCallback onVisibilityToggle,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // // // // //       obscureText: !isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // // // // // // // // // //         labelText: label,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         suffixIcon: IconButton(
// // // // // // // // // // // // // // // // // // // // // // // // // // //           icon: Icon(
// // // // // // // // // // // // // // // // // // // // // // // // // // //             isPasswordVisible ? Icons.visibility : Icons.visibility_off,
// // // // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //           onPressed: onVisibilityToggle,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ??
// // // // // // // // // // // // // // // // // // // // // // // // // // //           (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //             if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //               return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // // // // //             }
// // // // // // // // // // // // // // // // // // // // // // // // // // //             return null;
// // // // // // // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // // //   // Image Picker
// // // // // // // // // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // // // // // // // // //     final pickedFile = await _imagePicker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // // //   // Form submission
// // // // // // // // // // // // // // // // // // // // // // // // // // //   Future<void> _submitForm() async {
// // // // // // // // // // // // // // // // // // // // // // // // // // //     if (_formKey.currentState!.validate()) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //       final userDetails = {
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "name": _nameController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "email": _emailController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "phone": "00218${_phoneController.text}",
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "address": _addressController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "age": _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "gender": _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "type": widget.userType, // 0 = Client, 1 = Service Provider
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "category": widget.userType == 1 ? _selectedCategory : null,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "bio": _bioController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "experience": _experienceController.text,
// // // // // // // // // // // // // // // // // // // // // // // // // // //         "avatar": _avatarImage?.path,
// // // // // // // // // // // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // // // // // // // // // // // // //           headers: {"Content-Type": "application/json"},
// // // // // // // // // // // // // // // // // // // // // // // // // // //           body: jsonEncode(userDetails),
// // // // // // // // // // // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // // // // // // // // // // //         if (response.statusCode == 200) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //           print("Sign-up successful!");
// // // // // // // // // // // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // // // // // // // // // // //           print("Failed to sign up: ${response.body}");
// // // // // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // // // // //       } catch (error) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //         print("Error connecting to the backend: $error");
// // // // // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // // // // // // // // // // import 'package:test/extantion.dart';

// // // // // // // // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // // // // // // //   final int userType; // Accepts 0 (Client) or 1 (Service Provider)
// // // // // // // // // // // // // // // // // // // // // // // // // //   final VoidCallback changeLocale;

// // // // // // // // // // // // // // // // // // // // // // // // // //   const SignUpScreen({
// // // // // // // // // // // // // // // // // // // // // // // // // //     Key? key,
// // // // // // // // // // // // // // // // // // // // // // // // // //     required this.userType,
// // // // // // // // // // // // // // // // // // // // // // // // // //     required this.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // // // //   }) : super(key: key);

// // // // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // // // //   _SignUpScreenState createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _phoneController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _bioController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _experienceController = TextEditingController();

// // // // // // // // // // // // // // // // // // // // // // // // // //   String _selectedCategory = "Electrician";
// // // // // // // // // // // // // // // // // // // // // // // // // //   String _selectedGender = "Male";
// // // // // // // // // // // // // // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // // // // // // // // // //   bool _isPasswordVisible = false;
// // // // // // // // // // // // // // // // // // // // // // // // // //   bool _isConfirmPasswordVisible = false;

// // // // // // // // // // // // // // // // // // // // // // // // // //   final String backendUrl = "https://192.168.0.109:7127/api/User"; // Replace with your backend URL

// // // // // // // // // // // // // // // // // // // // // // // // // //   final ImagePicker _imagePicker = ImagePicker();

// // // // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // // // // // // //     final isServiceProvider = widget.userType == 1;

// // // // // // // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // // // // // // //         title: Text("${context.t.signUp} - ${widget.userType == 0 ? context.t.client : context.t.serviceProvider}"),
// // // // // // // // // // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // // // // // // // // // //           IconButton(
// // // // // // // // // // // // // // // // // // // // // // // // // //             icon: const Icon(Icons.language),
// // // // // // // // // // // // // // // // // // // // // // // // // //             onPressed: widget.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // // // // // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.start,
// // // // // // // // // // // // // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Avatar Upload
// // // // // // // // // // // // // // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 child: GestureDetector(
// // // // // // // // // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // // // // // // // // // //                     radius: 50,
// // // // // // // // // // // // // // // // // // // // // // // // // //                     backgroundImage: _avatarImage != null
// // // // // // // // // // // // // // // // // // // // // // // // // //                         ? FileImage(_avatarImage!)
// // // // // // // // // // // // // // // // // // // // // // // // // //                         : const AssetImage("images/default_avatar.png") as ImageProvider,
// // // // // // // // // // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // // // // // // // // // //                         ? const Icon(Icons.camera_alt, size: 30, color: Colors.white)
// // // // // // // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Name Input
// // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _nameController,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.username,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.userNameRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Email Input
// // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.email,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) =>
// // // // // // // // // // // // // // // // // // // // // // // // // //                     value != null && value.contains('@') ? null : context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Password Input with Toggle
// // // // // // // // // // // // // // // // // // // // // // // // // //               _buildPasswordField(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _passwordController,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.password,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 isPasswordVisible: _isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 onVisibilityToggle: () {
// // // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // //                     _isPasswordVisible = !_isPasswordVisible;
// // // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.passwordRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Confirm Password Input with Toggle
// // // // // // // // // // // // // // // // // // // // // // // // // //               _buildPasswordField(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _confirmPasswordController,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.confirmPassword,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 isPasswordVisible: _isConfirmPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 onVisibilityToggle: () {
// // // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // //                     _isConfirmPasswordVisible = !_isConfirmPasswordVisible;
// // // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                   if (value != _passwordController.text) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.passwordMismatch;
// // // // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Address Input
// // // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _addressController,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.address,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.addressRequired,
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Phone Input with Libyan Country Code
// // // // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // // // //                   Container(
// // // // // // // // // // // // // // // // // // // // // // // // // //                     width: 80,
// // // // // // // // // // // // // // // // // // // // // // // // // //                     padding: const EdgeInsets.symmetric(horizontal: 8.0),
// // // // // // // // // // // // // // // // // // // // // // // // // //                     alignment: Alignment.center,
// // // // // // // // // // // // // // // // // // // // // // // // // //                     decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // // // // // // // //                       color: Colors.grey[300],
// // // // // // // // // // // // // // // // // // // // // // // // // //                       borderRadius: BorderRadius.circular(8.0),
// // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                     child: const Text(
// // // // // // // // // // // // // // // // // // // // // // // // // //                       "00218",
// // // // // // // // // // // // // // // // // // // // // // // // // //                       style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                   const SizedBox(width: 10),
// // // // // // // // // // // // // // // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // // // // // // // // // // // // // // //                     child: _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // // //                       controller: _phoneController,
// // // // // // // // // // // // // // // // // // // // // // // // // //                       label: context.t.phoneNumber,
// // // // // // // // // // // // // // // // // // // // // // // // // //                       keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // // // // // // //                       validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                         if (value == null || value.isEmpty || value.length < 8) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                           return context.t.phoneNumberInvalid;
// // // // // // // // // // // // // // // // // // // // // // // // // //                         }
// // // // // // // // // // // // // // // // // // // // // // // // // //                         return null;
// // // // // // // // // // // // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Age Selection Dropdown
// // // // // // // // // // // // // // // // // // // // // // // // // //               DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 value: _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // //                     _selectedAge = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // //                 items: List.generate(
// // // // // // // // // // // // // // // // // // // // // // // // // //                   82, // Generate ages from 18 to 99
// // // // // // // // // // // // // // // // // // // // // // // // // //                   (index) => (18 + index).toString(),
// // // // // // // // // // // // // // // // // // // // // // // // // //                 ).map((age) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                   return DropdownMenuItem<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // //                     value: age,
// // // // // // // // // // // // // // // // // // // // // // // // // //                     child: Text(age),
// // // // // // // // // // // // // // // // // // // // // // // // // //                   );
// // // // // // // // // // // // // // // // // // // // // // // // // //                 }).toList(),
// // // // // // // // // // // // // // // // // // // // // // // // // //                 decoration: InputDecoration(labelText: context.t.age),
// // // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                   if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.age;
// // // // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Gender Selection
// // // // // // // // // // // // // // // // // // // // // // // // // //               Text(context.t.gender, style: const TextStyle(fontWeight: FontWeight.bold)),
// // // // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // //                     value: "Male",
// // // // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.male),
// // // // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // // // //                     value: "Female",
// // // // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.female),
// // // // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // // //               // Submit Button
// // // // // // // // // // // // // // // // // // // // // // // // // //               ElevatedButton(
// // // // // // // // // // // // // // // // // // // // // // // // // //                 onPressed: submitForm,
// // // // // // // // // // // // // // // // // // // // // // // // // //                 style: ElevatedButton.styleFrom(
// // // // // // // // // // // // // // // // // // // // // // // // // //                   minimumSize: const Size(double.infinity, 50),
// // // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // // //                 child: Text(context.t.signUp),
// // // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build text fields
// // // // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(labelText: label),
// // // // // // // // // // // // // // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ??
// // // // // // // // // // // // // // // // // // // // // // // // // //           (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // //             if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // // //               return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // // // //             }
// // // // // // // // // // // // // // // // // // // // // // // // // //             return null;
// // // // // // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build password fields with visibility toggle
// // // // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildPasswordField({
// // // // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // // // //     required bool isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // // //     required VoidCallback onVisibilityToggle,
// // // // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // // // //       obscureText: !isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // // // // // // // // //         labelText: label,
// // // // // // // // // // // // // // // // // // // // // // // // // //         suffixIcon: IconButton(
// // // // // // // // // // // // // // // // // // // // // // // // // //           icon: Icon(
// // // // // // // // // // // // // // // // // // // // // // // // // //             isPasswordVisible ? Icons.visibility : Icons.visibility_off,
// // // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // // //           onPressed: onVisibilityToggle,
// // // // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ??
// // // // // // // // // // // // // // // // // // // // // // // // // //           (value) {
// // // // // // // // // // // // // // // // // // // // // // // // // //             if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // // //               return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // // // //             }
// // // // // // // // // // // // // // // // // // // // // // // // // //             return null;
// // // // // // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // // //   // Image Picker
// // // // // // // // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // // // // // // // //     final pickedFile = await _imagePicker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // // // // // // // // // import 'package:test/extantion.dart';

// // // // // // // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // // // // // //   final int userType; // Accepts 0 (Client) or 1 (Service Provider)
// // // // // // // // // // // // // // // // // // // // // // // // //   final VoidCallback changeLocale;

// // // // // // // // // // // // // // // // // // // // // // // // //   const SignUpScreen({
// // // // // // // // // // // // // // // // // // // // // // // // //     Key? key,
// // // // // // // // // // // // // // // // // // // // // // // // //     required this.userType,
// // // // // // // // // // // // // // // // // // // // // // // // //     required this.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // // //   }) : super(key: key);

// // // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // // //   _SignUpScreenState createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _phoneController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _bioController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _experienceController = TextEditingController();

// // // // // // // // // // // // // // // // // // // // // // // // //   String _selectedCategory = "Electrician";
// // // // // // // // // // // // // // // // // // // // // // // // //   String _selectedGender = "Male";
// // // // // // // // // // // // // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // // // // // // // // //   bool _isPasswordVisible = false;
// // // // // // // // // // // // // // // // // // // // // // // // //   bool _isConfirmPasswordVisible = false;

// // // // // // // // // // // // // // // // // // // // // // // // //   final String backendUrl = "https://192.168.0.109:7127/api/User"; // Replace with your backend URL

// // // // // // // // // // // // // // // // // // // // // // // // //   final ImagePicker _imagePicker = ImagePicker();

// // // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // // // // // //     final isServiceProvider = widget.userType == 1;

// // // // // // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // // // // // //         title: Text("${context.t.signUp} - ${widget.userType == 0 ? context.t.client : context.t.serviceProvider}"),
// // // // // // // // // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // // // // // // // // //           IconButton(
// // // // // // // // // // // // // // // // // // // // // // // // //             icon: const Icon(Icons.language),
// // // // // // // // // // // // // // // // // // // // // // // // //             onPressed: widget.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // // // // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.start,
// // // // // // // // // // // // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Avatar Upload
// // // // // // // // // // // // // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // // // // // // // // // // // // //                 child: GestureDetector(
// // // // // // // // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // // // // // // // // //                     radius: 50,
// // // // // // // // // // // // // // // // // // // // // // // // //                     backgroundImage: _avatarImage != null
// // // // // // // // // // // // // // // // // // // // // // // // //                         ? FileImage(_avatarImage!)
// // // // // // // // // // // // // // // // // // // // // // // // //                         : const AssetImage("images/default_avatar.png") as ImageProvider,
// // // // // // // // // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // // // // // // // // //                         ? const Icon(Icons.camera_alt, size: 30, color: Colors.white)
// // // // // // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Name Input
// // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _nameController,
// // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.username,
// // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.userNameRequired,
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Email Input
// // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.email,
// // // // // // // // // // // // // // // // // // // // // // // // //                 keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) =>
// // // // // // // // // // // // // // // // // // // // // // // // //                     value != null && value.contains('@') ? null : context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Password Input with Toggle
// // // // // // // // // // // // // // // // // // // // // // // // //               _buildPasswordField(
// // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _passwordController,
// // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.password,
// // // // // // // // // // // // // // // // // // // // // // // // //                 isPasswordVisible: _isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // //                 onVisibilityToggle: () {
// // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // //                     _isPasswordVisible = !_isPasswordVisible;
// // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.passwordRequired,
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Confirm Password Input with Toggle
// // // // // // // // // // // // // // // // // // // // // // // // //               _buildPasswordField(
// // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _confirmPasswordController,
// // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.confirmPassword,
// // // // // // // // // // // // // // // // // // // // // // // // //                 isPasswordVisible: _isConfirmPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // //                 onVisibilityToggle: () {
// // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // //                     _isConfirmPasswordVisible = !_isConfirmPasswordVisible;
// // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // //                   if (value != _passwordController.text) {
// // // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.passwordMismatch;
// // // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Address Input
// // // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // //                 controller: _addressController,
// // // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.address,
// // // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.addressRequired,
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Phone Input with Libyan Country Code
// // // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // // //                   Container(
// // // // // // // // // // // // // // // // // // // // // // // // //                     width: 80,
// // // // // // // // // // // // // // // // // // // // // // // // //                     padding: const EdgeInsets.symmetric(horizontal: 8.0),
// // // // // // // // // // // // // // // // // // // // // // // // //                     alignment: Alignment.center,
// // // // // // // // // // // // // // // // // // // // // // // // //                     decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // // // // // // //                       color: Colors.grey[300],
// // // // // // // // // // // // // // // // // // // // // // // // //                       borderRadius: BorderRadius.circular(8.0),
// // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // //                     child: const Text(
// // // // // // // // // // // // // // // // // // // // // // // // //                       "00218",
// // // // // // // // // // // // // // // // // // // // // // // // //                       style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // //                   const SizedBox(width: 10),
// // // // // // // // // // // // // // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // // // // // // // // // // // // // //                     child: _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // // //                       controller: _phoneController,
// // // // // // // // // // // // // // // // // // // // // // // // //                       label: context.t.phoneNumber,
// // // // // // // // // // // // // // // // // // // // // // // // //                       keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // // // // // //                       validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // //                         if (value == null || value.isEmpty || value.length < 8) {
// // // // // // // // // // // // // // // // // // // // // // // // //                           return context.t.phoneNumberInvalid;
// // // // // // // // // // // // // // // // // // // // // // // // //                         }
// // // // // // // // // // // // // // // // // // // // // // // // //                         return null;
// // // // // // // // // // // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Age Selection Dropdown
// // // // // // // // // // // // // // // // // // // // // // // // //               DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // // // // //                 value: _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // // //                 onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // //                     _selectedAge = value!;
// // // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // //                 items: List.generate(
// // // // // // // // // // // // // // // // // // // // // // // // //                   82, // Generate ages from 18 to 99
// // // // // // // // // // // // // // // // // // // // // // // // //                   (index) => (18 + index).toString(),
// // // // // // // // // // // // // // // // // // // // // // // // //                 ).map((age) {
// // // // // // // // // // // // // // // // // // // // // // // // //                   return DropdownMenuItem<String>(value: age, child: Text(age));
// // // // // // // // // // // // // // // // // // // // // // // // //                 }).toList(),
// // // // // // // // // // // // // // // // // // // // // // // // //                 decoration: InputDecoration(labelText: context.t.age),
// // // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // //                   if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.age;
// // // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Gender Selection
// // // // // // // // // // // // // // // // // // // // // // // // //               Text(context.t.gender, style: const TextStyle(fontWeight: FontWeight.bold)),
// // // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // // //                     value: "Male",
// // // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.male),
// // // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // // //                     value: "Female",
// // // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.female),
// // // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // // //               // Submit Button
// // // // // // // // // // // // // // // // // // // // // // // // //               ElevatedButton(
// // // // // // // // // // // // // // // // // // // // // // // // //                 onPressed: submitForm,
// // // // // // // // // // // // // // // // // // // // // // // // //                 style: ElevatedButton.styleFrom(
// // // // // // // // // // // // // // // // // // // // // // // // //                   minimumSize: const Size(double.infinity, 50),
// // // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // // //                 child: Text(context.t.signUp),
// // // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build text fields
// // // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(labelText: label),
// // // // // // // // // // // // // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ?? (value) {
// // // // // // // // // // // // // // // // // // // // // // // // //         if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // //           return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // // //         return null;
// // // // // // // // // // // // // // // // // // // // // // // // //       },
// // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build password fields with visibility toggle
// // // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildPasswordField({
// // // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // // //     required bool isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // //     required VoidCallback onVisibilityToggle,
// // // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // // //       obscureText: !isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // // // // // // // //         labelText: label,
// // // // // // // // // // // // // // // // // // // // // // // // //         suffixIcon: IconButton(
// // // // // // // // // // // // // // // // // // // // // // // // //           icon: Icon(
// // // // // // // // // // // // // // // // // // // // // // // // //             isPasswordVisible ? Icons.visibility : Icons.visibility_off,
// // // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // // //           onPressed: onVisibilityToggle,
// // // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ?? (value) {
// // // // // // // // // // // // // // // // // // // // // // // // //         if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // // //           return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // // //         return null;
// // // // // // // // // // // // // // // // // // // // // // // // //       },
// // // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // //   // Image Picker
// // // // // // // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // // // // // // //     final pickedFile = await _imagePicker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // // //   // Submit Form and Send to API
// // // // // // // // // // // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // // // // // // // // // // //       // Create the form data to be sent
// // // // // // // // // // // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // // // // // // // // // // //         'name': _nameController.text,
// // // // // // // // // // // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // // // // // // // // // // //         'address': _addressController.text,
// // // // // // // // // // // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // // // // // // // // // // //         'category': _selectedCategory,
// // // // // // // // // // // // // // // // // // // // // // // // //         'gender': _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // // //         'age': _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // // //         'avatar': _avatarImage != null ? base64Encode(_avatarImage!.readAsBytesSync()) : null,
// // // // // // // // // // // // // // // // // // // // // // // // //         // You can add other fields as needed
// // // // // // // // // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // // // // // // // //         // Send the data to your backend API using a POST request
// // // // // // // // // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl), // Replace with your backend URL
// // // // // // // // // // // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // // // // // // // // //         // Handle the response from the server
// // // // // // // // // // // // // // // // // // // // // // // // //         if (response.statusCode == 200) {
// // // // // // // // // // // // // // // // // // // // // // // // //           // Success: Handle success response
// // // // // // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // // // // // // // // //           // Failure: Handle failure response
// // // // // // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // // // // // // // // // // //         // Catch and handle errors (e.g., network issues)
// // // // // // // // // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // // // // // // // // import 'package:test/extantion.dart';

// // // // // // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // // // // //   final int userType; // Accepts 0 (Client) or 1 (Service Provider)
// // // // // // // // // // // // // // // // // // // // // // // //   final VoidCallback changeLocale;

// // // // // // // // // // // // // // // // // // // // // // // //   const SignUpScreen({
// // // // // // // // // // // // // // // // // // // // // // // //     Key? key,
// // // // // // // // // // // // // // // // // // // // // // // //     required this.userType,
// // // // // // // // // // // // // // // // // // // // // // // //     required this.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // //   }) : super(key: key);

// // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // //   _SignUpScreenState createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _phoneController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _bioController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // // //   final TextEditingController _experienceController = TextEditingController();

// // // // // // // // // // // // // // // // // // // // // // // //   String _selectedCategory = "Electrician";
// // // // // // // // // // // // // // // // // // // // // // // //   String _selectedGender = "Male";
// // // // // // // // // // // // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // // // // // // // //   bool _isPasswordVisible = false;
// // // // // // // // // // // // // // // // // // // // // // // //   bool _isConfirmPasswordVisible = false;
// // // // // // // // // // // // // // // // // // // // // // // //   bool _isLoading = false; // For loading state

// // // // // // // // // // // // // // // // // // // // // // // //   final String backendUrl = "https://192.168.0.109:7127/api/User"; // Replace with your backend URL

// // // // // // // // // // // // // // // // // // // // // // // //   final ImagePicker _imagePicker = ImagePicker();

// // // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // // // // //     final isServiceProvider = widget.userType == 1;

// // // // // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // // // // //         title: Text("${context.t.signUp} - ${widget.userType == 0 ? context.t.client : context.t.serviceProvider}"),
// // // // // // // // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // // // // // // // //           IconButton(
// // // // // // // // // // // // // // // // // // // // // // // //             icon: const Icon(Icons.language),
// // // // // // // // // // // // // // // // // // // // // // // //             onPressed: widget.changeLocale,
// // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // // // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.start,
// // // // // // // // // // // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Avatar Upload
// // // // // // // // // // // // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // // // // // // // // // // // //                 child: GestureDetector(
// // // // // // // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // // // // // // // //                     radius: 50,
// // // // // // // // // // // // // // // // // // // // // // // //                     backgroundImage: _avatarImage != null
// // // // // // // // // // // // // // // // // // // // // // // //                         ? FileImage(_avatarImage!)
// // // // // // // // // // // // // // // // // // // // // // // //                         : const AssetImage("images/default_avatar.png") as ImageProvider,
// // // // // // // // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // // // // // // // //                         ? const Icon(Icons.camera_alt, size: 30, color: Colors.white)
// // // // // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Name Input
// // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // //                 controller: _nameController,
// // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.username,
// // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.userNameRequired,
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Email Input
// // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.email,
// // // // // // // // // // // // // // // // // // // // // // // //                 keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) =>
// // // // // // // // // // // // // // // // // // // // // // // //                     value != null && value.contains('@') ? null : context.t.emailRequired,
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Password Input with Toggle
// // // // // // // // // // // // // // // // // // // // // // // //               _buildPasswordField(
// // // // // // // // // // // // // // // // // // // // // // // //                 controller: _passwordController,
// // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.password,
// // // // // // // // // // // // // // // // // // // // // // // //                 isPasswordVisible: _isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // //                 onVisibilityToggle: () {
// // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // //                     _isPasswordVisible = !_isPasswordVisible;
// // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.passwordRequired,
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Confirm Password Input with Toggle
// // // // // // // // // // // // // // // // // // // // // // // //               _buildPasswordField(
// // // // // // // // // // // // // // // // // // // // // // // //                 controller: _confirmPasswordController,
// // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.confirmPassword,
// // // // // // // // // // // // // // // // // // // // // // // //                 isPasswordVisible: _isConfirmPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // //                 onVisibilityToggle: () {
// // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // //                     _isConfirmPasswordVisible = !_isConfirmPasswordVisible;
// // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // //                   if (value != _passwordController.text) {
// // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.passwordMismatch;
// // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Address Input
// // // // // // // // // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // //                 controller: _addressController,
// // // // // // // // // // // // // // // // // // // // // // // //                 label: context.t.address,
// // // // // // // // // // // // // // // // // // // // // // // //                 validatorMessage: context.t.addressRequired,
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Phone Input with Libyan Country Code
// // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // //                   Container(
// // // // // // // // // // // // // // // // // // // // // // // //                     width: 80,
// // // // // // // // // // // // // // // // // // // // // // // //                     padding: const EdgeInsets.symmetric(horizontal: 8.0),
// // // // // // // // // // // // // // // // // // // // // // // //                     alignment: Alignment.center,
// // // // // // // // // // // // // // // // // // // // // // // //                     decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // // // // // //                       color: Colors.grey[300],
// // // // // // // // // // // // // // // // // // // // // // // //                       borderRadius: BorderRadius.circular(8.0),
// // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // //                     child: const Text(
// // // // // // // // // // // // // // // // // // // // // // // //                       "00218",
// // // // // // // // // // // // // // // // // // // // // // // //                       style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // //                   const SizedBox(width: 10),
// // // // // // // // // // // // // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // // // // // // // // // // // // //                     child: _buildTextField(
// // // // // // // // // // // // // // // // // // // // // // // //                       controller: _phoneController,
// // // // // // // // // // // // // // // // // // // // // // // //                       label: context.t.phoneNumber,
// // // // // // // // // // // // // // // // // // // // // // // //                       keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // // // // //                       validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // //                         if (value == null || value.isEmpty || value.length < 8) {
// // // // // // // // // // // // // // // // // // // // // // // //                           return context.t.phoneNumberInvalid;
// // // // // // // // // // // // // // // // // // // // // // // //                         }
// // // // // // // // // // // // // // // // // // // // // // // //                         return null;
// // // // // // // // // // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Age Selection Dropdown
// // // // // // // // // // // // // // // // // // // // // // // //               DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // // // //                 value: _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // //                 onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // //                   setState(() {
// // // // // // // // // // // // // // // // // // // // // // // //                     _selectedAge = value!;
// // // // // // // // // // // // // // // // // // // // // // // //                   });
// // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // //                 items: List.generate(
// // // // // // // // // // // // // // // // // // // // // // // //                   82, // Generate ages from 18 to 99
// // // // // // // // // // // // // // // // // // // // // // // //                   (index) => (18 + index).toString(),
// // // // // // // // // // // // // // // // // // // // // // // //                 ).map((age) {
// // // // // // // // // // // // // // // // // // // // // // // //                   return DropdownMenuItem<String>(value: age, child: Text(age));
// // // // // // // // // // // // // // // // // // // // // // // //                 }).toList(),
// // // // // // // // // // // // // // // // // // // // // // // //                 decoration: InputDecoration(labelText: context.t.age),
// // // // // // // // // // // // // // // // // // // // // // // //                 validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // // //                   if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // //                     return context.t.age;
// // // // // // // // // // // // // // // // // // // // // // // //                   }
// // // // // // // // // // // // // // // // // // // // // // // //                   return null;
// // // // // // // // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Gender Selection
// // // // // // // // // // // // // // // // // // // // // // // //               Text(context.t.gender, style: const TextStyle(fontWeight: FontWeight.bold)),
// // // // // // // // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // //                     value: "Male",
// // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.male),
// // // // // // // // // // // // // // // // // // // // // // // //                   Radio<String>(
// // // // // // // // // // // // // // // // // // // // // // // //                     value: "Female",
// // // // // // // // // // // // // // // // // // // // // // // //                     groupValue: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // //                     onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // // //                       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // //                         _selectedGender = value!;
// // // // // // // // // // // // // // // // // // // // // // // //                       });
// // // // // // // // // // // // // // // // // // // // // // // //                     },
// // // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // // //                   Text(context.t.female),
// // // // // // // // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // // // // // //               // Submit Button
// // // // // // // // // // // // // // // // // // // // // // // //               ElevatedButton(
// // // // // // // // // // // // // // // // // // // // // // // //                 onPressed: _isLoading ? null : submitForm, // Disable when loading
// // // // // // // // // // // // // // // // // // // // // // // //                 style: ElevatedButton.styleFrom(
// // // // // // // // // // // // // // // // // // // // // // // //                   minimumSize: const Size(double.infinity, 50),
// // // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // // //                 child: _isLoading
// // // // // // // // // // // // // // // // // // // // // // // //                     ? const CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // // // // // // // // // // //                     : Text(context.t.signUp),
// // // // // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build text fields
// // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(labelText: label),
// // // // // // // // // // // // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ?? (value) {
// // // // // // // // // // // // // // // // // // // // // // // //         if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // //           return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // //         return null;
// // // // // // // // // // // // // // // // // // // // // // // //       },
// // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // //   // Helper to build password fields with visibility toggle
// // // // // // // // // // // // // // // // // // // // // // // //   Widget _buildPasswordField({
// // // // // // // // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // // // // //     required bool isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // //     required VoidCallback onVisibilityToggle,
// // // // // // // // // // // // // // // // // // // // // // // //     String? validatorMessage,
// // // // // // // // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // // // // // // // // //       obscureText: !isPasswordVisible,
// // // // // // // // // // // // // // // // // // // // // // // //       decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // // // // // // //         labelText: label,
// // // // // // // // // // // // // // // // // // // // // // // //         suffixIcon: IconButton(
// // // // // // // // // // // // // // // // // // // // // // // //           icon: Icon(
// // // // // // // // // // // // // // // // // // // // // // // //             isPasswordVisible ? Icons.visibility : Icons.visibility_off,
// // // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // // //           onPressed: onVisibilityToggle,
// // // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // // //       validator: validator ?? (value) {
// // // // // // // // // // // // // // // // // // // // // // // //         if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // // //           return validatorMessage;
// // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // //         return null;
// // // // // // // // // // // // // // // // // // // // // // // //       },
// // // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // //   // Image Picker
// // // // // // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // // // // // //     final pickedFile = await _imagePicker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // // //   // Submit Form and Send to API
// // // // // // // // // // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // // // //         _isLoading = true; // Show loading indicator
// // // // // // // // // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // // // // // // // // //       // Create the form data to be sent
// // // // // // // // // // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // // // // // // // // // //         'name': _nameController.text,
// // // // // // // // // // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // // // // // // // // // //         'address': _addressController.text,
// // // // // // // // // // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // // // // // // // // // //         'category': _selectedCategory,
// // // // // // // // // // // // // // // // // // // // // // // //         'gender': _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // // //         'age': _selectedAge,
// // // // // // // // // // // // // // // // // // // // // // // //         'avatar': _avatarImage != null ? base64Encode(_avatarImage!.readAsBytesSync()) : null,
// // // // // // // // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // // // // // // //         // Send the data to your backend API using a POST request
// // // // // // // // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl), // Replace with your backend URL
// // // // // // // // // // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // // // // // // // //         // Handle the response from the server
// // // // // // // // // // // // // // // // // // // // // // // //         if (response.statusCode == 200) {
// // // // // // // // // // // // // // // // // // // // // // // //           // Success: Handle success response
// // // // // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // // // // // // // //           // Failure: Handle failure response
// // // // // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // // // // // // // // // //         // Catch and handle errors (e.g., network issues)
// // // // // // // // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // // // // // // // // // //           _isLoading = false; // Hide loading indicator
// // // // // // // // // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';

// // // // // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // // //   final _phoneController = TextEditingController();

// // // // // // // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // // // // // // // // // // //   String? _selectedGender;
// // // // // // // // // // // // // // // // // // // // // // //   String? _selectedAge;

// // // // // // // // // // // // // // // // // // // // // // //   final String backendUrl = 'https://192.168.0.109:7127/api/user'; // Replace with your API endpoint

// // // // // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // // // // //     final pickedFile = await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // // // // // // // // //         'userAddress': _addressController.text,
// // // // // // // // // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // // // // // // // // // // // // // // // //         'gender': _selectedGender == 'Male' ? 1 : 0,
// // // // // // // // // // // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // // // // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // // // // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // // // // // // // // // // //         'location': 'Some Location', // Replace with actual location data if needed
// // // // // // // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // // // //         title: Text('Sign Up'),
// // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // // // // // // //                     radius: 45,
// // // // // // // // // // // // // // // // // // // // // // //                     backgroundImage: _avatarImage != null
// // // // // // // // // // // // // // // // // // // // // // //                         ? FileImage(_avatarImage!)
// // // // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 45)
// // // // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your name';
// // // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter a valid email';
// // // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Password'),
// // // // // // // // // // // // // // // // // // // // // // //                   obscureText: true,
// // // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // // //                   controller: _addressController,
// // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your address';
// // // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // // //                   controller: _phoneController,
// // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Phone'),
// // // // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your phone number';
// // // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // // //                   value: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Gender'),
// // // // // // // // // // // // // // // // // // // // // // //                   items: ['Male', 'Female']
// // // // // // // // // // // // // // // // // // // // // // //                       .map((gender) => DropdownMenuItem(
// // // // // // // // // // // // // // // // // // // // // // //                             value: gender,
// // // // // // // // // // // // // // // // // // // // // // //                             child: Text(gender),
// // // // // // // // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // // // // // // // //                       _selectedGender = value;
// // // // // // // // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // // // // // // // // // // // //                       value == null ? 'Please select your gender' : null,
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.number,
// // // // // // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // // //                     _selectedAge = value;
// // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // // //                     if (value == null || int.tryParse(value) == null) {
// // // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter a valid age';
// // // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';

// // // // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // // //   final _phoneController = TextEditingController();

// // // // // // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // // // // // // // // // //   String? _selectedGender;
// // // // // // // // // // // // // // // // // // // // // //   String? _selectedAge;

// // // // // // // // // // // // // // // // // // // // // //   final String backendUrl = 'http://your-backend-url/api/user'; // Replace with your API endpoint

// // // // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // // // //     final pickedFile = await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // // // // // // // //         'userAddress': _addressController.text,
// // // // // // // // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // // // // // // // // // // // // // // //         'gender': _selectedGender == 'Male' ? 1 : 0,
// // // // // // // // // // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // // // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // // // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // // // // // // // // // //         'location': 'Some Location', // Replace with actual location data if needed
// // // // // // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // // //         title: Text('Sign Up'),
// // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // // // // // //                     radius: 45,
// // // // // // // // // // // // // // // // // // // // // //                     backgroundImage: _avatarImage != null
// // // // // // // // // // // // // // // // // // // // // //                         ? FileImage(_avatarImage!)
// // // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 45)
// // // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your name';
// // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter a valid email';
// // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Password'),
// // // // // // // // // // // // // // // // // // // // // //                   obscureText: true,
// // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // //                   controller: _addressController,
// // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your address';
// // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // //                   controller: _phoneController,
// // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Phone'),
// // // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your phone number';
// // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // // //                   value: _selectedGender,
// // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Gender'),
// // // // // // // // // // // // // // // // // // // // // //                   items: ['Male', 'Female']
// // // // // // // // // // // // // // // // // // // // // //                       .map((gender) => DropdownMenuItem(
// // // // // // // // // // // // // // // // // // // // // //                             value: gender,
// // // // // // // // // // // // // // // // // // // // // //                             child: Text(gender),
// // // // // // // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // // // // // // //                       _selectedGender = value;
// // // // // // // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // // // // // // // // // // //                       value == null ? 'Please select your gender' : null,
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.number,
// // // // // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // // //                     _selectedAge = value;
// // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // // //                     if (value == null || int.tryParse(value) == null) {
// // // // // // // // // // // // // // // // // // // // // //                       return 'Please enter a valid age';
// // // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';

// // // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // // // //   final _phoneController = TextEditingController();

// // // // // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // // // // // // // // //   String? _selectedGender;
// // // // // // // // // // // // // // // // // // // // //   String? _selectedAge;

// // // // // // // // // // // // // // // // // // // // //   final String backendUrl = 'https://192.168.0.109:7127/api/user'; // Replace with your API endpoint

// // // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // // //     final pickedFile = await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // // // // // // //         'userAddress': _addressController.text,
// // // // // // // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // // // // // // // // // // // // // //         'gender': _selectedGender == 'Male' ? 1 : 0,
// // // // // // // // // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // // // // // // // // //         'location': 'Some Location', // Replace with actual location data if needed
// // // // // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // //         title: Text('Sign Up'),
// // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // // // // //                     radius: 45,
// // // // // // // // // // // // // // // // // // // // //                     backgroundImage: _avatarImage != null
// // // // // // // // // // // // // // // // // // // // //                         ? FileImage(_avatarImage!)
// // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 45)
// // // // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your name';
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // // // // // // // //                       return 'Please enter a valid email';
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Password'),
// // // // // // // // // // // // // // // // // // // // //                   obscureText: true,
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // //                   controller: _addressController,
// // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your address';
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // //                   controller: _phoneController,
// // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Phone'),
// // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // //                       return 'Please enter your phone number';
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // // // //                   value: _selectedGender,
// // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Gender'),
// // // // // // // // // // // // // // // // // // // // //                   items: ['Male', 'Female']
// // // // // // // // // // // // // // // // // // // // //                       .map((gender) => DropdownMenuItem(
// // // // // // // // // // // // // // // // // // // // //                             value: gender,
// // // // // // // // // // // // // // // // // // // // //                             child: Text(gender),
// // // // // // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // // // // // //                       _selectedGender = value;
// // // // // // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // // // // // // // // // //                       value == null ? 'Please select your gender' : null,
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.number,
// // // // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // // // //                     _selectedAge = value;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || int.tryParse(value) == null) {
// // // // // // // // // // // // // // // // // // // // //                       return 'Please enter a valid age';
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // import 'dart:convert'; // For base64 encoding
// // // // // // // // // // // // // // // // // // // // import 'dart:io'; // For File handling
// // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart'; // For image picking
// // // // // // // // // // // // // // // // // // // // import 'package:location/location.dart'; // For location fetching
// // // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http; // For API requests

// // // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // //   final int userType; // 0 for Client, 1 for Service Provider

// // // // // // // // // // // // // // // // // // // //   const SignUpScreen({
// // // // // // // // // // // // // // // // // // // //     Key? key,
// // // // // // // // // // // // // // // // // // // //     required this.userType,
// // // // // // // // // // // // // // // // // // // //   }) : super(key: key);

// // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // //   _SignUpScreenState createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // // //   final TextEditingController _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // // //   final TextEditingController _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // // //   final TextEditingController _locationController = TextEditingController();
// // // // // // // // // // // // // // // // // // // //   File? _avatarImage; // Store picked image

// // // // // // // // // // // // // // // // // // // //   final String backendUrl = 'https://your-backend-url.com/api';

// // // // // // // // // // // // // // // // // // // //   // Function to pick an image
// // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // //     final pickedFile = await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   // Function to fetch current location
// // // // // // // // // // // // // // // // // // // //   Future<void> _fetchCurrentLocation() async {
// // // // // // // // // // // // // // // // // // // //     final location = Location();
// // // // // // // // // // // // // // // // // // // //     bool serviceEnabled;
// // // // // // // // // // // // // // // // // // // //     PermissionStatus permissionGranted;

// // // // // // // // // // // // // // // // // // // //     serviceEnabled = await location.serviceEnabled();
// // // // // // // // // // // // // // // // // // // //     if (!serviceEnabled) {
// // // // // // // // // // // // // // // // // // // //       serviceEnabled = await location.requestService();
// // // // // // // // // // // // // // // // // // // //       if (!serviceEnabled) return;
// // // // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // // // //     permissionGranted = await location.hasPermission();
// // // // // // // // // // // // // // // // // // // //     if (permissionGranted == PermissionStatus.denied) {
// // // // // // // // // // // // // // // // // // // //       permissionGranted = await location.requestPermission();
// // // // // // // // // // // // // // // // // // // //       if (permissionGranted != PermissionStatus.granted) return;
// // // // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // // // //     final currentLocation = await location.getLocation();
// // // // // // // // // // // // // // // // // // // //     setState(() {
// // // // // // // // // // // // // // // // // // // //       _locationController.text = '${currentLocation.latitude}, ${currentLocation.longitude}';
// // // // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   // Function to convert image to base64
// // // // // // // // // // // // // // // // // // // //   String? _convertImageToBase64(File? imageFile) {
// // // // // // // // // // // // // // // // // // // //     if (imageFile == null) return null;
// // // // // // // // // // // // // // // // // // // //     final bytes = imageFile.readAsBytesSync();
// // // // // // // // // // // // // // // // // // // //     return base64Encode(bytes);
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   // Function to submit the form
// // // // // // // // // // // // // // // // // // // //   Future<void> submitForm() async {
// // // // // // // // // // // // // // // // // // // //     if (!_formKey.currentState!.validate()) return;

// // // // // // // // // // // // // // // // // // // //     final imageBase64 = _convertImageToBase64(_avatarImage);

// // // // // // // // // // // // // // // // // // // //     final body = {
// // // // // // // // // // // // // // // // // // // //       'name': _nameController.text,
// // // // // // // // // // // // // // // // // // // //       'email': _emailController.text,
// // // // // // // // // // // // // // // // // // // //       'password': _passwordController.text,
// // // // // // // // // // // // // // // // // // // //       'location': _locationController.text,
// // // // // // // // // // // // // // // // // // // //       'userType': widget.userType.toString(), // Pass userType from the widget
// // // // // // // // // // // // // // // // // // // //       'image': imageBase64, // Send image as base64
// // // // // // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // //       final response = await http.post(
// // // // // // // // // // // // // // // // // // // //         Uri.parse('$backendUrl/register'),
// // // // // // // // // // // // // // // // // // // //         headers: {'Content-Type': 'application/json'},
// // // // // // // // // // // // // // // // // // // //         body: jsonEncode(body),
// // // // // // // // // // // // // // // // // // // //       );

// // // // // // // // // // // // // // // // // // // //       if (response.statusCode == 200) {
// // // // // // // // // // // // // // // // // // // //         print("User registered successfully");
// // // // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // //           const SnackBar(content: Text('Registration successful!')),
// // // // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // // // // //         print("Error: ${response.body}");
// // // // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // //           const SnackBar(content: Text('Registration failed!')),
// // // // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // //     } catch (e) {
// // // // // // // // // // // // // // // // // // // //       print("Error: $e");
// // // // // // // // // // // // // // // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // //         const SnackBar(content: Text('An error occurred!')),
// // // // // // // // // // // // // // // // // // // //       );
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // //     final isClient = widget.userType == 0; // Determine user type (Client or Service Provider)

// // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // //         title: Text(isClient ? 'Client Sign Up' : 'Service Provider Sign Up'),
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // // // //                 // Name field
// // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // // // // // // //                   decoration: const InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // //                       return 'Name is required';
// // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),

// // // // // // // // // // // // // // // // // // // //                 // Email field
// // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // // // // // // //                   decoration: const InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // // // // // // //                       return 'Enter a valid email';
// // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),

// // // // // // // // // // // // // // // // // // // //                 // Password field
// // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // // // // // // //                   decoration: const InputDecoration(labelText: 'Password'),
// // // // // // // // // // // // // // // // // // // //                   obscureText: true,
// // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),

// // // // // // // // // // // // // // // // // // // //                 // Location field
// // // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // // //                   controller: _locationController,
// // // // // // // // // // // // // // // // // // // //                   readOnly: true,
// // // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // // //                     labelText: 'Location',
// // // // // // // // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // // // // // // // //                       icon: const Icon(Icons.my_location),
// // // // // // // // // // // // // // // // // // // //                       onPressed: _fetchCurrentLocation,
// // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // //                       return 'Location is required';
// // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),

// // // // // // // // // // // // // // // // // // // //                 // Avatar picker
// // // // // // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // //                   child: _avatarImage == null
// // // // // // // // // // // // // // // // // // // //                       ? Container(
// // // // // // // // // // // // // // // // // // // //                           height: 150,
// // // // // // // // // // // // // // // // // // // //                           decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // //                             color: Colors.grey[300],
// // // // // // // // // // // // // // // // // // // //                             borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // // //                           child: const Center(child: Text('Tap to select an image')),
// // // // // // // // // // // // // // // // // // // //                         )
// // // // // // // // // // // // // // // // // // // //                       : Image.file(_avatarImage!, height: 150, fit: BoxFit.cover),
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),

// // // // // // // // // // // // // // // // // // // //                 // Submit button
// // // // // // // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // // // // // // //                   onPressed: submitForm,
// // // // // // // // // // // // // // // // // // // //                   child: const Text('Sign Up'),
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';

// // // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // // //   final _phoneController = TextEditingController();

// // // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // // // // // // //   String? _selectedGender;
// // // // // // // // // // // // // // // // // // //   String? _selectedAge;

// // // // // // // // // // // // // // // // // // //   final String backendUrl = 'http://your-backend-url/api/user'; // Replace with your API endpoint

// // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // //     final pickedFile = await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // // // // //         'userAddress': _addressController.text,
// // // // // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // // // // // // // // // // // //         'gender': _selectedGender == 'Male' ? 1 : 0,
// // // // // // // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // // // // // // //         'location': 'Some Location', // Replace with actual location data if needed
// // // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // //         title: Text('Sign Up'),
// // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // // //                     radius: 45,
// // // // // // // // // // // // // // // // // // //                     backgroundImage: _avatarImage != null
// // // // // // // // // // // // // // // // // // //                         ? FileImage(_avatarImage!)
// // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 45)
// // // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // //                       return 'Please enter your name';
// // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // // // // // //                       return 'Please enter a valid email';
// // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Password'),
// // // // // // // // // // // // // // // // // // //                   obscureText: true,
// // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // //                   controller: _addressController,
// // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // //                       return 'Please enter your address';
// // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // //                   controller: _phoneController,
// // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Phone'),
// // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // //                       return 'Please enter your phone number';
// // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // // //                   value: _selectedGender,
// // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Gender'),
// // // // // // // // // // // // // // // // // // //                   items: ['Male', 'Female']
// // // // // // // // // // // // // // // // // // //                       .map((gender) => DropdownMenuItem(
// // // // // // // // // // // // // // // // // // //                             value: gender,
// // // // // // // // // // // // // // // // // // //                             child: Text(gender),
// // // // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // // // //                       _selectedGender = value;
// // // // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // // // // // // // //                       value == null ? 'Please select your gender' : null,
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.number,
// // // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // // //                     _selectedAge = value;
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // //                     if (value == null || int.tryParse(value) == null) {
// // // // // // // // // // // // // // // // // // //                       return 'Please enter a valid age';
// // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // // import 'package:location/location.dart';

// // // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // // // // // //   final _phoneController = TextEditingController();

// // // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // // // // // //   String? _selectedGender;
// // // // // // // // // // // // // // // // // //   String? _selectedAge;

// // // // // // // // // // // // // // // // // //   final String backendUrl =
// // // // // // // // // // // // // // // // // //       'http:///api/user'; // Replace with your API endpoint
// // // // // // // // // // // // // // // // // //        Future<void> _updateLocation() async {
// // // // // // // // // // // // // // // // // //     final location = Location();
// // // // // // // // // // // // // // // // // //     bool serviceEnabled;
// // // // // // // // // // // // // // // // // //     PermissionStatus permissionGranted;

// // // // // // // // // // // // // // // // // //     serviceEnabled = await location.serviceEnabled();
// // // // // // // // // // // // // // // // // //     if (!serviceEnabled) {
// // // // // // // // // // // // // // // // // //       serviceEnabled = await location.requestService();
// // // // // // // // // // // // // // // // // //       if (!serviceEnabled) return;
// // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // //     permissionGranted = await location.hasPermission();
// // // // // // // // // // // // // // // // // //     if (permissionGranted == PermissionStatus.denied) {
// // // // // // // // // // // // // // // // // //       permissionGranted = await location.requestPermission();
// // // // // // // // // // // // // // // // // //       if (permissionGranted != PermissionStatus.granted) return;
// // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // //     final currentLocation = await location.getLocation();
// // // // // // // // // // // // // // // // // //     setState(() {
// // // // // // // // // // // // // // // // // //       locationText = '${currentLocation.latitude}, ${currentLocation.longitude}';
// // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // //     final pickedFile =
// // // // // // // // // // // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // // // //         'userAddress': _addressController.text,
// // // // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // // // // // // // // // // //         'gender': _selectedGender == 'Male' ? 1 : 0,
// // // // // // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // // // // // //         'location':
// // // // // // // // // // // // // // // // // //             'Some Location', // Replace with actual location data if needed
// // // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // //         title: Text('Sign Up'),
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // // //                     radius: 45,
// // // // // // // // // // // // // // // // // //                     backgroundImage:
// // // // // // // // // // // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 45)
// // // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // //                       return 'Please enter your name';
// // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // // // // //                       return 'Please enter a valid email';
// // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Password'),
// // // // // // // // // // // // // // // // // //                   obscureText: true,
// // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // //                   controller: _addressController,
// // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // //                       return 'Please enter your address';
// // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // //                   controller: _phoneController,
// // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Phone'),
// // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // //                       return 'Please enter your phone number';
// // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // // //                   value: _selectedGender,
// // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Gender'),
// // // // // // // // // // // // // // // // // //                   items: ['Male', 'Female']
// // // // // // // // // // // // // // // // // //                       .map((gender) => DropdownMenuItem(
// // // // // // // // // // // // // // // // // //                             value: gender,
// // // // // // // // // // // // // // // // // //                             child: Text(gender),
// // // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // // //                       _selectedGender = value;
// // // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // // // // // // //                       value == null ? 'Please select your gender' : null,
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.number,
// // // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // // //                     _selectedAge = value;
// // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // //                     if (value == null || int.tryParse(value) == null) {
// // // // // // // // // // // // // // // // // //                       return 'Please enter a valid age';
// // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // import 'package:location/location.dart';

// // // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // // // // //   final _phoneController = TextEditingController();

// // // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // // // // //   bool _obscurePassword = true;
// // // // // // // // // // // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // // // // // // // // // // //   String? _selectedGender;
// // // // // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // // // // //   String locationText = "";
// // // // // // // // // // // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // // // // // // // // // // //     "Tripoli City Center",
// // // // // // // // // // // // // // // // //     "Martyrs' Square",
// // // // // // // // // // // // // // // // //     "Al-Mansoura",
// // // // // // // // // // // // // // // // //     "Gargaresh",
// // // // // // // // // // // // // // // // //     "Hai Al-Andalus",
// // // // // // // // // // // // // // // // //     "Ben Ashur",
// // // // // // // // // // // // // // // // //     "Garden City",
// // // // // // // // // // // // // // // // //     "Abu Salim",
// // // // // // // // // // // // // // // // //     "Souk Al-Juma",
// // // // // // // // // // // // // // // // //     "Janzour"
// // // // // // // // // // // // // // // // //   ];

// // // // // // // // // // // // // // // // //   final String backendUrl =
// // // // // // // // // // // // // // // // //       'https://192.168.0.109:7127/api/user'; // Replace with your API endpoint

// // // // // // // // // // // // // // // // //   // Function to get the current location using the Location package
// // // // // // // // // // // // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // // // // // // // // // // // //     final location = Location();
// // // // // // // // // // // // // // // // //     bool serviceEnabled;
// // // // // // // // // // // // // // // // //     PermissionStatus permissionGranted;

// // // // // // // // // // // // // // // // //     serviceEnabled = await location.serviceEnabled();
// // // // // // // // // // // // // // // // //     if (!serviceEnabled) {
// // // // // // // // // // // // // // // // //       serviceEnabled = await location.requestService();
// // // // // // // // // // // // // // // // //       if (!serviceEnabled) return;
// // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // //     permissionGranted = await location.hasPermission();
// // // // // // // // // // // // // // // // //     if (permissionGranted == PermissionStatus.denied) {
// // // // // // // // // // // // // // // // //       permissionGranted = await location.requestPermission();
// // // // // // // // // // // // // // // // //       if (permissionGranted != PermissionStatus.granted) return;
// // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // //     final currentLocation = await location.getLocation();
// // // // // // // // // // // // // // // // //     setState(() {
// // // // // // // // // // // // // // // // //       locationText = '${currentLocation.latitude}, ${currentLocation.longitude}';
// // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // //     final pickedFile =
// // // // // // // // // // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // // // // // // // // // // //         'userAddress': _addressController.text, // Address sent as a string
// // // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // // // // // // // // // //         'gender': _selectedGender == 'Male' ? 1 : 0,
// // // // // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // // // // //         'location': locationText, // Current location sent as a string
// // // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // // // //     _getCurrentLocation(); // Get location on screen load
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // //         title: Text('Sign Up'),
// // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // // //                     radius: 45,
// // // // // // // // // // // // // // // // //                     backgroundImage:
// // // // // // // // // // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 45)
// // // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // //                       return 'Please enter your name';
// // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // // // //                       return 'Please enter a valid email';
// // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // // // // //                     labelText: 'Password',
// // // // // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // // // // //                       icon: Icon(
// // // // // // // // // // // // // // // // //                         _obscurePassword
// // // // // // // // // // // // // // // // //                             ? Icons.visibility_off
// // // // // // // // // // // // // // // // //                             : Icons.visibility,
// // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // // // // // // // // // // //                         });
// // // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // // // // //                       icon: Icon(
// // // // // // // // // // // // // // // // //                         _obscureConfirmPassword
// // // // // // // // // // // // // // // // //                             ? Icons.visibility_off
// // // // // // // // // // // // // // // // //                             : Icons.visibility,
// // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // // // // // // // // // // //                         });
// // // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // //                     if (value == null || value != _passwordController.text) {
// // // // // // // // // // // // // // // // //                       return 'Passwords do not match';
// // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // //                   value: _addressController.text.isEmpty ? null : _addressController.text,
// // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // // // // //                   items: _tripoliStreets
// // // // // // // // // // // // // // // // //                       .map((street) => DropdownMenuItem(
// // // // // // // // // // // // // // // // //                             value: street,
// // // // // // // // // // // // // // // // //                             child: Text(street),
// // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // //                       _addressController.text = value ?? '';
// // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // //                       return 'Please select your address';
// // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // //                   controller: _phoneController,
// // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Phone'),
// // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // //                       return 'Please enter your phone number';
// // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // // //                   value: _selectedGender,
// // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Gender'),
// // // // // // // // // // // // // // // // //                   items: ['Male', 'Female']
// // // // // // // // // // // // // // // // //                       .map((gender) => DropdownMenuItem(
// // // // // // // // // // // // // // // // //                             value: gender,
// // // // // // // // // // // // // // // // //                             child: Text(gender),
// // // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // // //                       _selectedGender = value;
// // // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // // // // // //                       value == null ? 'Please select your gender' : null,
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.number,
// // // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // // //                     _selectedAge = value;
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // //                     if (value == null || int.tryParse(value) == null) {
// // // // // // // // // // // // // // // // //                       return 'Please enter a valid age';
// // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //                 SizedBox(height: 32),
// // // // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // import 'package:location/location.dart';
// // // // // // // // // // // // // // // // import 'package:flag/flag.dart'; // Import the flag package

// // // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // // // //   final _phoneController = TextEditingController();
// // // // // // // // // // // // // // // //   final _locationController = TextEditingController(); // Added location controller

// // // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // // // //   bool _obscurePassword = true;
// // // // // // // // // // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // // // // // // // // // //   String? _selectedGender;
// // // // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // // // // // // // // // //     "Tripoli City Center",
// // // // // // // // // // // // // // // //     "Martyrs' Square",
// // // // // // // // // // // // // // // //     "Al-Mansoura",
// // // // // // // // // // // // // // // //     "Gargaresh",
// // // // // // // // // // // // // // // //     "Hai Al-Andalus",
// // // // // // // // // // // // // // // //     "Ben Ashur",
// // // // // // // // // // // // // // // //     "Garden City",
// // // // // // // // // // // // // // // //     "Abu Salim",
// // // // // // // // // // // // // // // //     "Souk Al-Juma",
// // // // // // // // // // // // // // // //     "Janzour"
// // // // // // // // // // // // // // // //   ];

// // // // // // // // // // // // // // // //   final String backendUrl =
// // // // // // // // // // // // // // // //       'https://192.168.0.109:7127/api/user'; // Replace with your API endpoint

// // // // // // // // // // // // // // // //   // Function to get the current location using the Location package
// // // // // // // // // // // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // // // // // // // // // // //     final location = Location();
// // // // // // // // // // // // // // // //     bool serviceEnabled;
// // // // // // // // // // // // // // // //     PermissionStatus permissionGranted;

// // // // // // // // // // // // // // // //     serviceEnabled = await location.serviceEnabled();
// // // // // // // // // // // // // // // //     if (!serviceEnabled) {
// // // // // // // // // // // // // // // //       serviceEnabled = await location.requestService();
// // // // // // // // // // // // // // // //       if (!serviceEnabled) return;
// // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // //     permissionGranted = await location.hasPermission();
// // // // // // // // // // // // // // // //     if (permissionGranted == PermissionStatus.denied) {
// // // // // // // // // // // // // // // //       permissionGranted = await location.requestPermission();
// // // // // // // // // // // // // // // //       if (permissionGranted != PermissionStatus.granted) return;
// // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // //     final currentLocation = await location.getLocation();
// // // // // // // // // // // // // // // //     setState(() {
// // // // // // // // // // // // // // // //       // Setting the location in the TextFormField controller
// // // // // // // // // // // // // // // //       _locationController.text =
// // // // // // // // // // // // // // // //           'Latitude: ${currentLocation.latitude}, Longitude: ${currentLocation.longitude}';
// // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // //     final pickedFile =
// // // // // // // // // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // // // // // // // // // //         'userAddress': _addressController.text, // Address sent as a string
// // // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // // // // // // // // //         'gender': _selectedGender == 'Male' ? 1 : 0,
// // // // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // // // //         'location': _locationController.text, // Current location sent as a string
// // // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // // //     // Initial setup without location fetching on screen load
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // //         title: Text('Sign Up'),
// // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // // //                     radius: 45,
// // // // // // // // // // // // // // // //                     backgroundImage:
// // // // // // // // // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 45)
// // // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // //                       return 'Please enter your name';
// // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // // //                       return 'Please enter a valid email';
// // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // // // //                     labelText: 'Password',
// // // // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // // // //                       icon: Icon(
// // // // // // // // // // // // // // // //                         _obscurePassword
// // // // // // // // // // // // // // // //                             ? Icons.visibility_off
// // // // // // // // // // // // // // // //                             : Icons.visibility,
// // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // // // // // // // // // //                         });
// // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // // // //                       icon: Icon(
// // // // // // // // // // // // // // // //                         _obscureConfirmPassword
// // // // // // // // // // // // // // // //                             ? Icons.visibility_off
// // // // // // // // // // // // // // // //                             : Icons.visibility,
// // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // // // // // // // // // //                         });
// // // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // //                     if (value == null || value != _passwordController.text) {
// // // // // // // // // // // // // // // //                       return 'Passwords do not match';
// // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // // //                   value: _addressController.text.isEmpty ? null : _addressController.text,
// // // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // // // //                   items: _tripoliStreets
// // // // // // // // // // // // // // // //                       .map((street) => DropdownMenuItem(
// // // // // // // // // // // // // // // //                             value: street,
// // // // // // // // // // // // // // // //                             child: Text(street),
// // // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // // //                       _addressController.text = value ?? '';
// // // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // //                       return 'Please select your address';
// // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // //                 ),

// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // // //                 // Icon inside the TextFormField to fetch the location
// // // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // // //                   onTap: _getCurrentLocation, // Fetch location when tapped
// // // // // // // // // // // // // // // //                   child: TextFormField(
// // // // // // // // // // // // // // // //                     controller: _locationController,
// // // // // // // // // // // // // // // //                     decoration: InputDecoration(
// // // // // // // // // // // // // // // //                       labelText: 'Current Location',
// // // // // // // // // // // // // // // //                       suffixIcon: Icon(Icons.location_on),
// // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // //                     readOnly: true, // Make it read-only
// // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //                 SizedBox(height: 32),
// // // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // import 'package:location/location.dart';
// // // // // // // // // // // // // // // import 'package:flag/flag.dart'; // Import the flag package

// // // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // // //   final _phoneController = TextEditingController();
// // // // // // // // // // // // // // //   final _locationController = TextEditingController();
// // // // // // // // // // // // // // //  // final _ageController =TextEditingController();// Added location controller

// // // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // // //   bool _obscurePassword = true;
// // // // // // // // // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // // // // // // // // //   String? _selectedGender;
// // // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // // // // // // // // //   "Martyrs' Square",
// // // // // // // // // // // // // // //     "Al-Mansoura",
// // // // // // // // // // // // // // //     "Gargaresh",
// // // // // // // // // // // // // // //     "Hai Al-Andalus",
// // // // // // // // // // // // // // //     "Ben Ashur",
// // // // // // // // // // // // // // //     "Garden City",
// // // // // // // // // // // // // // //     "Abu Salim",
// // // // // // // // // // // // // // //     "Souk Al-Juma",
// // // // // // // // // // // // // // //     "Janzour"
// // // // // // // // // // // // // // //   ];

// // // // // // // // // // // // // // //   final String backendUrl =
// // // // // // // // // // // // // // //       'https://192.168.0.109:7127/api/user'; // Replace with your API endpoint

// // // // // // // // // // // // // // //   // Function to get the current location using the Location package
// // // // // // // // // // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // // // // // // // // // //     final location = Location();
// // // // // // // // // // // // // // //     bool serviceEnabled;
// // // // // // // // // // // // // // //     PermissionStatus permissionGranted;

// // // // // // // // // // // // // // //     serviceEnabled = await location.serviceEnabled();
// // // // // // // // // // // // // // //     if (!serviceEnabled) {
// // // // // // // // // // // // // // //       serviceEnabled = await location.requestService();
// // // // // // // // // // // // // // //       if (!serviceEnabled) return;
// // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // //     permissionGranted = await location.hasPermission();
// // // // // // // // // // // // // // //     if (permissionGranted == PermissionStatus.denied) {
// // // // // // // // // // // // // // //       permissionGranted = await location.requestPermission();
// // // // // // // // // // // // // // //       if (permissionGranted != PermissionStatus.granted) return;
// // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // //     final currentLocation = await location.getLocation();
// // // // // // // // // // // // // // //     setState(() {
// // // // // // // // // // // // // // //       // Setting the location in the TextFormField controller
// // // // // // // // // // // // // // //       _locationController.text =
// // // // // // // // // // // // // // //           'Latitude: ${currentLocation.latitude}, Longitude: ${currentLocation.longitude}';
// // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // //     final pickedFile =
// // // // // // // // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // // // // // // // // //         'userAddress': _addressController.text, // Address sent as a string
// // // // // // // // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // // // // // // // //         'gender': _selectedGender == 'Male' ? 1 : 0,
// // // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // // //         'location': _locationController.text,
// // // // // // // // // // // // // // //         'phone':_phoneController // Current location sent as a string
// // // // // // // // // // // // // // //       };

// // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // // //           Uri.parse(backendUrl),
// // // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // // //           },
// // // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // // //         );

// // // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // // //           );
// // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // // //         );
// // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // //     // Initial setup without location fetching on screen load
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // //         title: Text('Sign Up'),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // // //                     radius: 45,
// // // // // // // // // // // // // // //                     backgroundImage:
// // // // // // // // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 45)
// // // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // //                       return 'Please enter your name';
// // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // //                     if (value == null || !value.contains('@')) {
// // // // // // // // // // // // // // //                       return 'Please enter a valid email';
// // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // // //                     labelText: 'Password',
// // // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // // //                       icon: Icon(
// // // // // // // // // // // // // // //                         _obscurePassword
// // // // // // // // // // // // // // //                             ? Icons.visibility_off
// // // // // // // // // // // // // // //                             : Icons.visibility,
// // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // // // // // // // // //                         });
// // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // //                     if (value == null || value.length < 6) {
// // // // // // // // // // // // // // //                       return 'Password must be at least 6 characters';
// // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // // //                       icon: Icon(
// // // // // // // // // // // // // // //                         _obscureConfirmPassword
// // // // // // // // // // // // // // //                             ? Icons.visibility_off
// // // // // // // // // // // // // // //                             : Icons.visibility,
// // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // // // // // // // // //                         });
// // // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // //                     if (value == null || value != _passwordController.text) {
// // // // // // // // // // // // // // //                       return 'Passwords do not match';
// // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // //                 // Dropdown for Age
// // // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // // //                   value: _selectedAge,
// // // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // // // //                   items: List.generate(100, (index) => index + 1)
// // // // // // // // // // // // // // //                       .map((age) => DropdownMenuItem(
// // // // // // // // // // // // // // //                             value: age.toString(),
// // // // // // // // // // // // // // //                             child: Text(age.toString()),
// // // // // // // // // // // // // // //                           ))
// // // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // // //                       _selectedAge = value;
// // // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // //                       return 'Please select your age';
// // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // //                 // Flag and address dropdown
// // // // // // // // // // // // // // //                 Row(
// // // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // // //                     Flag.fromString('LY', height: 20, width: 30), // Libyan Flag
// // // // // // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // // // //                       child: DropdownButtonFormField<String>(
// // // // // // // // // // // // // // //                         value: _addressController.text.isEmpty ? null : _addressController.text,
// // // // // // // // // // // // // // //                         decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // // //                         items: _tripoliStreets
// // // // // // // // // // // // // // //                             .map((street) => DropdownMenuItem(
// // // // // // // // // // // // // // //                                   value: street,
// // // // // // // // // // // // // // //                                   child: Text(street),
// // // // // // // // // // // // // // //                                 ))
// // // // // // // // // // // // // // //                             .toList(),
// // // // // // // // // // // // // // //                         onChanged: (value) {
// // // // // // // // // // // // // // //                           setState(() {
// // // // // // // // // // // // // // //                             _addressController.text = value ?? '';
// // // // // // // // // // // // // // //                           });
// // // // // // // // // // // // // // //                         },
// // // // // // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // // // // // //                           if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // //                             return 'Please select your address';
// // // // // // // // // // // // // // //                           }
// // // // // // // // // // // // // // //                           return null;
// // // // // // // // // // // // // // //                         },
// // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // // //                 // Icon inside the TextFormField to fetch the location
// // // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // // //                   onTap: _getCurrentLocation, // Fetch location when tapped
// // // // // // // // // // // // // // //                   child: TextFormField(
// // // // // // // // // // // // // // //                     controller: _locationController,
// // // // // // // // // // // // // // //                     decoration: InputDecoration(
// // // // // // // // // // // // // // //                       labelText: 'Current Location',
// // // // // // // // // // // // // // //                       suffixIcon: Icon(Icons.location_on),
// // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // //                     readOnly: true, // Make it read-only
// // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //                 SizedBox(height: 32),
// // // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // import 'package:location/location.dart';
// // // // // // // // // // // // // // import 'package:flag/flag.dart';

// // // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // // }

// // // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // // //   final _phoneController = TextEditingController();
// // // // // // // // // // // // // //   final _locationController = TextEditingController();

// // // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // // //   bool _obscurePassword = true;
// // // // // // // // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // // //   GenderType? _selectedGender; // ✅ FIXED: Now using GenderType (backend enum)
// // // // // // // // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // // // // // // // //     "Martyrs' Square",
// // // // // // // // // // // // // //     "Al-Mansoura",
// // // // // // // // // // // // // //     "Gargaresh",
// // // // // // // // // // // // // //     "Hai Al-Andalus",
// // // // // // // // // // // // // //     "Ben Ashur",
// // // // // // // // // // // // // //     "Garden City",
// // // // // // // // // // // // // //     "Abu Salim",
// // // // // // // // // // // // // //     "Souk Al-Juma",
// // // // // // // // // // // // // //     "Janzour"
// // // // // // // // // // // // // //   ];

// // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // //     final pickedFile =
// // // // // // // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // // //       });
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // // //       });

// // // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // // // // // // // //         'userAddress': _addressController.text, // Address as string
// // // // // // // // // // // // // //         'phone': _phoneController.text, // 9-digit phone number
// // // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'), // Convert age to int
// // // // // // // // // // // // // //         'gender': _selectedGender == GenderType.male
// // // // // // // // // // // // // //             ? 1
// // // // // // // // // // // // // //             : 0, // ✅ FIXED ENUM (Male = 1, Female = 0)
// // // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1, // 0 = Customer, 1 = Vendor
// // // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // // //             ? base64Encode(
// // // // // // // // // // // // // //                 _avatarImage!.readAsBytesSync()) // Convert image to Base64
// // // // // // // // // // // // // //             : null,
// // // // // // // // // // // // // //         'location': _locationController.text, // GPS Location as a string
// // // // // // // // // // // // // //       };

// // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // // //           Uri.parse('https://192.168.0.109:7127/api/user'), // Your API
// // // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // // //           },
// // // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // // //         );

// // // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // // //           );
// // // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // // //         } else {
// // // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // // //           );
// // // // // // // // // // // // // //         }
// // // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // // //         );
// // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // // //         });
// // // // // // // // // // // // // //       }
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // // //                     radius: 100,
// // // // // // // // // // // // // //                     backgroundImage:
// // // // // // // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // //                 // Name
// // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // //                 // Email
// // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // // // // // // // // // // //                       ? 'Enter a valid email'
// // // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // //                 // Password
// // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // //                     labelText: 'Password',
// // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // //                       icon: Icon(_obscurePassword
// // // // // // // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // // // // // // //                           : Icons.visibility),
// // // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // // // // // // // //                         });
// // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // // // // // // // //                   validator: (value) => value == null || value.length < 6
// // // // // // // // // // // // // //                       ? 'Password must be at least 6 characters'
// // // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // //                 // Confirm Password
// // // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // // //                       icon: Icon(_obscureConfirmPassword
// // // // // // // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // // // // // // //                           : Icons.visibility),
// // // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // // // // // // // //                         });
// // // // // // // // // // // // // //                       },
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // // // // // // // //                   validator: (value) => value != _passwordController.text
// // // // // // // // // // // // // //                       ? 'Passwords do not match'
// // // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // //                 // Age Dropdown
// // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // //                   value: _selectedAge,
// // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // // // // // // // // // // // //                       .map((age) =>
// // // // // // // // // // // // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // //                       _selectedAge = value;
// // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // //                 // Phone Number with Flag
// // // // // // // // // // // // // //                 Row(
// // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // // // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // // // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // // // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // // //                       child: TextFormField(
// // // // // // // // // // // // // //                         controller: _phoneController,
// // // // // // // // // // // // // //                         keyboardType: TextInputType.phone,
// // // // // // // // // // // // // //                         maxLength: 9, // Restrict to 9 digits
// // // // // // // // // // // // // //                         decoration: InputDecoration(
// // // // // // // // // // // // // //                           labelText: 'Phone Number',
// // // // // // // // // // // // // //                           counterText: "", // Hide character count
// // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // // // // //                           if (value == null ||
// // // // // // // // // // // // // //                               value.isEmpty ||
// // // // // // // // // // // // // //                               value.length != 9 ||
// // // // // // // // // // // // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // // // // // // // // // // // //                             return 'Enter a valid 9-digit number';
// // // // // // // // // // // // // //                           }
// // // // // // // // // // // // // //                           return null;
// // // // // // // // // // // // // //                         },
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // //                 // Address Dropdown (NO FLAG HERE)
// // // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // // //                   value: _addressController.text.isEmpty
// // // // // // // // // // // // // //                       ? null
// // // // // // // // // // // // // //                       : _addressController.text,
// // // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // // //                   items: _tripoliStreets
// // // // // // // // // // // // // //                       .map((street) =>
// // // // // // // // // // // // // //                           DropdownMenuItem(value: street, child: Text(street)))
// // // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // // //                       _addressController.text = value ?? '';
// // // // // // // // // // // // // //                     });
// // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // //                   validator: (value) => value == null || value.isEmpty
// // // // // // // // // // // // // //                       ? 'Select your address'
// // // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // // //                 // Location
// // // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // // //                   onTap: () {}, // Replace with _getCurrentLocation() if needed
// // // // // // // // // // // // // //                   child: TextFormField(
// // // // // // // // // // // // // //                     controller: _locationController,
// // // // // // // // // // // // // //                     decoration: InputDecoration(
// // // // // // // // // // // // // //                       labelText: 'Current Location',
// // // // // // // // // // // // // //                       suffixIcon: Icon(Icons.location_on),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                     readOnly: true,
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 SizedBox(height: 32),
// // // // // // // // // // // // // //                 // Sign Up Button
// // // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // // //                   onPressed: _isLoading
// // // // // // // // // // // // // //                       ? null
// // // // // // // // // // // // // //                       : () {}, // Replace with submitForm() if needed
// // // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // }
// // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // import 'package:location/location.dart';
// // // // // // // // // // // // // import 'package:flag/flag.dart';

// // // // // // // // // // // // // // Define the GenderType enum
// // // // // // // // // // // // // enum GenderType { male, female }

// // // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // // //   @override
// // // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // // }

// // // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // // //   final _phoneController = TextEditingController();
// // // // // // // // // // // // //   final _locationController = TextEditingController();

// // // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // // //   bool _obscurePassword = true;
// // // // // // // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // // //   GenderType? _selectedGender; // Now using GenderType enum
// // // // // // // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // // // // // // //     "Martyrs' Square",
// // // // // // // // // // // // //     "Al-Mansoura",
// // // // // // // // // // // // //     "Gargaresh",
// // // // // // // // // // // // //     "Hai Al-Andalus",
// // // // // // // // // // // // //     "Ben Ashur",
// // // // // // // // // // // // //     "Garden City",
// // // // // // // // // // // // //     "Abu Salim",
// // // // // // // // // // // // //     "Souk Al-Juma",
// // // // // // // // // // // // //     "Janzour"
// // // // // // // // // // // // //   ];

// // // // // // // // // // // // //   // Location Service
// // // // // // // // // // // // //   Location _location = Location();

// // // // // // // // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // // // // // // // //     try {
// // // // // // // // // // // // //       // Check if location service is enabled
// // // // // // // // // // // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // // // // // // // // // // //       if (!_serviceEnabled) {
// // // // // // // // // // // // //         _serviceEnabled = await _location.requestService();
// // // // // // // // // // // // //         if (!_serviceEnabled) {
// // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // //             SnackBar(content: Text("Location service is not enabled")),
// // // // // // // // // // // // //           );
// // // // // // // // // // // // //           return;
// // // // // // // // // // // // //         }
// // // // // // // // // // // // //       }

// // // // // // // // // // // // //       // Check for location permissions
// // // // // // // // // // // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // // // // // // // // // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // // // // // // // // // // //         _permissionGranted = await _location.requestPermission();
// // // // // // // // // // // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // //             SnackBar(content: Text("Location permission denied")),
// // // // // // // // // // // // //           );
// // // // // // // // // // // // //           return;
// // // // // // // // // // // // //         }
// // // // // // // // // // // // //       }

// // // // // // // // // // // // //       // Get current location
// // // // // // // // // // // // //       LocationData _currentLocation = await _location.getLocation();

// // // // // // // // // // // // //       // Update the location controller with latitude and longitude
// // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // //         _locationController.text =
// // // // // // // // // // // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // // // // // // // // // // //       });
// // // // // // // // // // // // //     } catch (e) {
// // // // // // // // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // //         SnackBar(content: Text("Error getting location: $e")),
// // // // // // // // // // // // //       );
// // // // // // // // // // // // //     }
// // // // // // // // // // // // //   }

// // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // //     final pickedFile =
// // // // // // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // // //       });
// // // // // // // // // // // // //     }
// // // // // // // // // // // // //   }

// // // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // // //       });

// // // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // // // // // // //         'userAddress': _addressController.text, // Address as string
// // // // // // // // // // // // //         'phone': _phoneController.text, // 9-digit phone number
// // // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'), // Convert age to int
// // // // // // // // // // // // //         'gender': _selectedGender == GenderType.male
// // // // // // // // // // // // //             ? 1
// // // // // // // // // // // // //             : 0, // 1 = male, 0 = female
// // // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1, // 0 = Customer, 1 = Vendor
// // // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync()) // Convert image to Base64
// // // // // // // // // // // // //             : null,
// // // // // // // // // // // // //         'location': _locationController.text, // GPS Location as a string
// // // // // // // // // // // // //       };

// // // // // // // // // // // // //       try {
// // // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // // //           Uri.parse('https://192.168.0.109:7127/api/user'), // Your API
// // // // // // // // // // // // //           headers: {
// // // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // // //           },
// // // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // // //         );

// // // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // // //           );
// // // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // // //         } else {
// // // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // // //           );
// // // // // // // // // // // // //         }
// // // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // // //         );
// // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // // //         });
// // // // // // // // // // // // //       }
// // // // // // // // // // // // //     }
// // // // // // // // // // // // //   }

// // // // // // // // // // // // //   @override
// // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // // //               children: [
// // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // // //                     radius: 100,
// // // // // // // // // // // // //                     backgroundImage:
// // // // // // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // // // // // // // // // //                         : null,
// // // // // // // // // // // // //                   ),
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Name
// // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Email
// // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // // // // // // // // // //                       ? 'Enter a valid email'
// // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Password
// // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // //                     labelText: 'Password',
// // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // //                       icon: Icon(_obscurePassword
// // // // // // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // // // // // //                           : Icons.visibility),
// // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // // // // // // //                         });
// // // // // // // // // // // // //                       },
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                   ),
// // // // // // // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // // // // // // //                   validator: (value) => value == null || value.length < 6
// // // // // // // // // // // // //                       ? 'Password must be at least 6 characters'
// // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Confirm Password
// // // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // // //                       icon: Icon(_obscureConfirmPassword
// // // // // // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // // // // // //                           : Icons.visibility),
// // // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // // // // // // //                         });
// // // // // // // // // // // // //                       },
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                   ),
// // // // // // // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // // // // // // //                   validator: (value) => value != _passwordController.text
// // // // // // // // // // // // //                       ? 'Passwords do not match'
// // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Age Dropdown
// // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // //                   value: _selectedAge,
// // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // // // // // // // // // // //                       .map((age) =>
// // // // // // // // // // // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // //                       _selectedAge = value;
// // // // // // // // // // // // //                     });
// // // // // // // // // // // // //                   },
// // // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Gender Radio Buttons
// // // // // // // // // // // // //                 Row(
// // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // //                       child: ListTile(
// // // // // // // // // // // // //                         title: Text('Male'),
// // // // // // // // // // // // //                         leading: Radio<GenderType>(
// // // // // // // // // // // // //                           value: GenderType.male,
// // // // // // // // // // // // //                           groupValue: _selectedGender,
// // // // // // // // // // // // //                           onChanged: (GenderType? value) {
// // // // // // // // // // // // //                             setState(() {
// // // // // // // // // // // // //                               _selectedGender = value;
// // // // // // // // // // // // //                             });
// // // // // // // // // // // // //                           },
// // // // // // // // // // // // //                         ),
// // // // // // // // // // // // //                       ),
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // //                       child: ListTile(
// // // // // // // // // // // // //                         title: Text('Female'),
// // // // // // // // // // // // //                         leading: Radio<GenderType>(
// // // // // // // // // // // // //                           value: GenderType.female,
// // // // // // // // // // // // //                           groupValue: _selectedGender,
// // // // // // // // // // // // //                           onChanged: (GenderType? value) {
// // // // // // // // // // // // //                             setState(() {
// // // // // // // // // // // // //                               _selectedGender = value;
// // // // // // // // // // // // //                             });
// // // // // // // // // // // // //                           },
// // // // // // // // // // // // //                         ),
// // // // // // // // // // // // //                       ),
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                   ],
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Phone Number with Flag
// // // // // // // // // // // // //                 Row(
// // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // //                       child: TextFormField(
// // // // // // // // // // // // //                         controller: _phoneController,
// // // // // // // // // // // // //                         keyboardType: TextInputType.phone,
// // // // // // // // // // // // //                         maxLength: 9, // Restrict to 9 digits
// // // // // // // // // // // // //                         decoration: InputDecoration(
// // // // // // // // // // // // //                           labelText: 'Phone Number',
// // // // // // // // // // // // //                           counterText: "", // Hide character count
// // // // // // // // // // // // //                         ),
// // // // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // // // //                           if (value == null ||
// // // // // // // // // // // // //                               value.isEmpty ||
// // // // // // // // // // // // //                               value.length != 9 ||
// // // // // // // // // // // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // // // // // // // // // // //                             return 'Enter a valid 9-digit number';
// // // // // // // // // // // // //                           }
// // // // // // // // // // // // //                           return null;
// // // // // // // // // // // // //                         },
// // // // // // // // // // // // //                       ),
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                   ],
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Address Dropdown
// // // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // // //                   value: _addressController.text.isEmpty
// // // // // // // // // // // // //                       ? null
// // // // // // // // // // // // //                       : _addressController.text,
// // // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // // // // // //                   items: _tripoliStreets
// // // // // // // // // // // // //                       .map((street) =>
// // // // // // // // // // // // //                           DropdownMenuItem(value: street, child: Text(street)))
// // // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // // //                       _addressController.text = value ?? '';
// // // // // // // // // // // // //                     });
// // // // // // // // // // // // //                   },
// // // // // // // // // // // // //                   validator: (value) => value == null || value.isEmpty
// // // // // // // // // // // // //                       ? 'Select your address'
// // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // // //                 // Location
// // // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // // //                   onTap: _getCurrentLocation, // Fetch location on tap
// // // // // // // // // // // // //                   child: TextFormField(
// // // // // // // // // // // // //                     controller: _locationController,
// // // // // // // // // // // // //                     decoration: InputDecoration(
// // // // // // // // // // // // //                       labelText: 'Current Location',
// // // // // // // // // // // // //                       suffixIcon: Icon(Icons.location_on),
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                     readOnly: true, // Prevent user from manually typing here
// // // // // // // // // // // // //                   ),
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //                 SizedBox(height: 32),
// // // // // // // // // // // // //                 // Sign Up Button
// // // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // // // // // // // // //                       : Text('Sign Up'),
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //               ],
// // // // // // // // // // // // //             ),
// // // // // // // // // // // // //           ),
// // // // // // // // // // // // //         ),
// // // // // // // // // // // // //       ),
// // // // // // // // // // // // //     );
// // // // // // // // // // // // //   }
// // // // // // // // // // // // // }
// // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // import 'package:location/location.dart';
// // // // // // // // // // // // import 'package:flag/flag.dart';

// // // // // // // // // // // // // Define the GenderType enum
// // // // // // // // // // // // enum GenderType { male, female }

// // // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // // //   @override
// // // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // // }

// // // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // // //   final _phoneController = TextEditingController();
// // // // // // // // // // // //   final _locationController = TextEditingController();

// // // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // // //   bool _obscurePassword = true;
// // // // // // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // // //   GenderType? _selectedGender; // Now using GenderType enum
// // // // // // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // // // // // //     "Martyrs' Square",
// // // // // // // // // // // //     "Al-Mansoura",
// // // // // // // // // // // //     "Gargaresh",
// // // // // // // // // // // //     "Hai Al-Andalus",
// // // // // // // // // // // //     "Ben Ashur",
// // // // // // // // // // // //     "Garden City",
// // // // // // // // // // // //     "Abu Salim",
// // // // // // // // // // // //     "Souk Al-Juma",
// // // // // // // // // // // //     "Janzour"
// // // // // // // // // // // //   ];

// // // // // // // // // // // //   // Location Service
// // // // // // // // // // // //   Location _location = Location();

// // // // // // // // // // // //   // Method to get current location
// // // // // // // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // // // // // // //     try {
// // // // // // // // // // // //       // Check if location service is enabled
// // // // // // // // // // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // // // // // // // // // //       if (!_serviceEnabled) {
// // // // // // // // // // // //         _serviceEnabled = await _location.requestService();
// // // // // // // // // // // //         if (!_serviceEnabled) {
// // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // //             SnackBar(content: Text("Location service is not enabled")),
// // // // // // // // // // // //           );
// // // // // // // // // // // //           return;
// // // // // // // // // // // //         }
// // // // // // // // // // // //       }

// // // // // // // // // // // //       // Check for location permissions
// // // // // // // // // // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // // // // // // // // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // // // // // // // // // //         _permissionGranted = await _location.requestPermission();
// // // // // // // // // // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // //             SnackBar(content: Text("Location permission denied")),
// // // // // // // // // // // //           );
// // // // // // // // // // // //           return;
// // // // // // // // // // // //         }
// // // // // // // // // // // //       }

// // // // // // // // // // // //       // Get current location
// // // // // // // // // // // //       LocationData _currentLocation = await _location.getLocation();

// // // // // // // // // // // //       // Update the location controller with latitude and longitude
// // // // // // // // // // // //       setState(() {
// // // // // // // // // // // //         _locationController.text =
// // // // // // // // // // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // // // // // // // // // //       });
// // // // // // // // // // // //     } catch (e) {
// // // // // // // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // //         SnackBar(content: Text("Error getting location: $e")),
// // // // // // // // // // // //       );
// // // // // // // // // // // //     }
// // // // // // // // // // // //   }

// // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // //     final pickedFile =
// // // // // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // // //       setState(() {
// // // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // // //       });
// // // // // // // // // // // //     }
// // // // // // // // // // // //   }

// // // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // // //       setState(() {
// // // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // // //       });

// // // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // // // // // //         'userAddress': _addressController.text, // Address as string
// // // // // // // // // // // //         'phone': _phoneController.text, // 9-digit phone number
// // // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'), // Convert age to int
// // // // // // // // // // // //         'gender': _selectedGender == GenderType.male
// // // // // // // // // // // //             ? 1
// // // // // // // // // // // //             : 0, // 1 = male, 0 = female
// // // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1, // 0 = Customer, 1 = Vendor
// // // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync()) // Convert image to Base64
// // // // // // // // // // // //             : null,
// // // // // // // // // // // //         'location': _locationController.text, // GPS Location as a string
// // // // // // // // // // // //       };

// // // // // // // // // // // //       try {
// // // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // // //           Uri.parse('https://192.168.0.109:7127/api/user'), // Your API
// // // // // // // // // // // //           headers: {
// // // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // // //           },
// // // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // // //         );

// // // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // // //           );
// // // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // // //         } else {
// // // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // // //           );
// // // // // // // // // // // //         }
// // // // // // // // // // // //       } catch (e) {
// // // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // // //         );
// // // // // // // // // // // //       } finally {
// // // // // // // // // // // //         setState(() {
// // // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // // //         });
// // // // // // // // // // // //       }
// // // // // // // // // // // //     }
// // // // // // // // // // // //   }

// // // // // // // // // // // //   @override
// // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // // // // // // // // //       body: Padding(
// // // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // //         child: Form(
// // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // // //             child: Column(
// // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // // //               children: [
// // // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // // //                     radius: 100,
// // // // // // // // // // // //                     backgroundImage:
// // // // // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // // // // // // // // //                         : null,
// // // // // // // // // // // //                   ),
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Name
// // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Email
// // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // // // // // // // // //                       ? 'Enter a valid email'
// // // // // // // // // // // //                       : null,
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Password
// // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // //                     labelText: 'Password',
// // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // //                       icon: Icon(_obscurePassword
// // // // // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // // // // //                           : Icons.visibility),
// // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // // // // // //                         });
// // // // // // // // // // // //                       },
// // // // // // // // // // // //                     ),
// // // // // // // // // // // //                   ),
// // // // // // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // // // // // //                   validator: (value) => value == null || value.length < 6
// // // // // // // // // // // //                       ? 'Password must be at least 6 characters'
// // // // // // // // // // // //                       : null,
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Confirm Password
// // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // //                       icon: Icon(_obscureConfirmPassword
// // // // // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // // // // //                           : Icons.visibility),
// // // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // // //                         setState(() {
// // // // // // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // // // // // //                         });
// // // // // // // // // // // //                       },
// // // // // // // // // // // //                     ),
// // // // // // // // // // // //                   ),
// // // // // // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // // // // // //                   validator: (value) => value != _passwordController.text
// // // // // // // // // // // //                       ? 'Passwords do not match'
// // // // // // // // // // // //                       : null,
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Age Dropdown
// // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // //                   value: _selectedAge,
// // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // // // // // // // // // //                       .map((age) =>
// // // // // // // // // // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // //                       _selectedAge = value;
// // // // // // // // // // // //                     });
// // // // // // // // // // // //                   },
// // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Gender Radio Buttons
// // // // // // // // // // // //                 Row(
// // // // // // // // // // // //                   children: [
// // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // //                       child: ListTile(
// // // // // // // // // // // //                         title: Text('Male'),
// // // // // // // // // // // //                         leading: Radio<GenderType>(
// // // // // // // // // // // //                           value: GenderType.male,
// // // // // // // // // // // //                           groupValue: _selectedGender,
// // // // // // // // // // // //                           onChanged: (GenderType? value) {
// // // // // // // // // // // //                             setState(() {
// // // // // // // // // // // //                               _selectedGender = value;
// // // // // // // // // // // //                             });
// // // // // // // // // // // //                           },
// // // // // // // // // // // //                         ),
// // // // // // // // // // // //                       ),
// // // // // // // // // // // //                     ),
// // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // //                       child: ListTile(
// // // // // // // // // // // //                         title: Text('Female'),
// // // // // // // // // // // //                         leading: Radio<GenderType>(
// // // // // // // // // // // //                           value: GenderType.female,
// // // // // // // // // // // //                           groupValue: _selectedGender,
// // // // // // // // // // // //                           onChanged: (GenderType? value) {
// // // // // // // // // // // //                             setState(() {
// // // // // // // // // // // //                               _selectedGender = value;
// // // // // // // // // // // //                             });
// // // // // // // // // // // //                           },
// // // // // // // // // // // //                         ),
// // // // // // // // // // // //                       ),
// // // // // // // // // // // //                     ),
// // // // // // // // // // // //                   ],
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Phone Number with Flag
// // // // // // // // // // // //                 Row(
// // // // // // // // // // // //                   children: [
// // // // // // // // // // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // //                       child: TextFormField(
// // // // // // // // // // // //                         controller: _phoneController,
// // // // // // // // // // // //                         keyboardType: TextInputType.phone,
// // // // // // // // // // // //                         maxLength: 9, // Restrict to 9 digits
// // // // // // // // // // // //                         decoration: InputDecoration(
// // // // // // // // // // // //                           labelText: 'Phone Number',
// // // // // // // // // // // //                           counterText: "", // Hide character count
// // // // // // // // // // // //                         ),
// // // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // // //                           if (value == null ||
// // // // // // // // // // // //                               value.isEmpty ||
// // // // // // // // // // // //                               value.length != 9 ||
// // // // // // // // // // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // // // // // // // // // //                             return 'Enter a valid 9-digit number';
// // // // // // // // // // // //                           }
// // // // // // // // // // // //                           return null;
// // // // // // // // // // // //                         },
// // // // // // // // // // // //                       ),
// // // // // // // // // // // //                     ),
// // // // // // // // // // // //                   ],
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Address Dropdown
// // // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // // //                   value: _addressController.text.isEmpty ? null : _addressController.text,
// // // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Street Address'),
// // // // // // // // // // // //                   items: _tripoliStreets
// // // // // // // // // // // //                       .map((street) => DropdownMenuItem(
// // // // // // // // // // // //                             value: street,
// // // // // // // // // // // //                             child: Text(street),
// // // // // // // // // // // //                           ))
// // // // // // // // // // // //                       .toList(),
// // // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // // //                     setState(() {
// // // // // // // // // // // //                       _addressController.text = value!;
// // // // // // // // // // // //                     });
// // // // // // // // // // // //                   },
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Location Icon Button
// // // // // // // // // // // //                 TextFormField(
// // // // // // // // // // // //                   controller: _locationController,
// // // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // // //                     labelText: 'Location',
// // // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // // //                       icon: Icon(Icons.location_on),
// // // // // // // // // // // //                       onPressed: _getCurrentLocation,
// // // // // // // // // // // //                     ),
// // // // // // // // // // // //                   ),
// // // // // // // // // // // //                   readOnly: true,
// // // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // // //                       value == null || value.isEmpty ? 'Location is required' : null,
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // // //                 // Submit Button
// // // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // // //                   child: _isLoading
// // // // // // // // // // // //                       ? CircularProgressIndicator()
// // // // // // // // // // // //                       : Text('Submit'),
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //               ],
// // // // // // // // // // // //             ),
// // // // // // // // // // // //           ),
// // // // // // // // // // // //         ),
// // // // // // // // // // // //       ),
// // // // // // // // // // // //     );
// // // // // // // // // // // //   }
// // // // // // // // // // // // }
// // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // import 'package:location/location.dart';
// // // // // // // // // // // import 'package:flag/flag.dart';

// // // // // // // // // // // // Define the GenderType enum
// // // // // // // // // // // enum GenderType { male, female }

// // // // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // // // //   @override
// // // // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // // // }

// // // // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // // // //   final _phoneController = TextEditingController();
// // // // // // // // // // //   final _locationController = TextEditingController();

// // // // // // // // // // //   File? _avatarImage;
// // // // // // // // // // //   bool _isLoading = false;
// // // // // // // // // // //   bool _obscurePassword = true;
// // // // // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // // // // //   String? _selectedAge;
// // // // // // // // // // //   GenderType? _selectedGender; // Now using GenderType enum
// // // // // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // // // // //     "Martyrs' Square",
// // // // // // // // // // //     "Al-Mansoura",
// // // // // // // // // // //     "Gargaresh",
// // // // // // // // // // //     "Hai Al-Andalus",
// // // // // // // // // // //     "Ben Ashur",
// // // // // // // // // // //     "Garden City",
// // // // // // // // // // //     "Abu Salim",
// // // // // // // // // // //     "Souk Al-Juma",
// // // // // // // // // // //     "Janzour"
// // // // // // // // // // //   ];

// // // // // // // // // // //   // Location Service
// // // // // // // // // // //   Location _location = Location();

// // // // // // // // // // //   // Method to get current location
// // // // // // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // // // // // //     try {
// // // // // // // // // // //       // Check if location service is enabled
// // // // // // // // // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // // // // // // // // //       if (!_serviceEnabled) {
// // // // // // // // // // //         _serviceEnabled = await _location.requestService();
// // // // // // // // // // //         if (!_serviceEnabled) {
// // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // //             SnackBar(content: Text("Location service is not enabled")),
// // // // // // // // // // //           );
// // // // // // // // // // //           return;
// // // // // // // // // // //         }
// // // // // // // // // // //       }

// // // // // // // // // // //       // Check for location permissions
// // // // // // // // // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // // // // // // // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // // // // // // // // //         _permissionGranted = await _location.requestPermission();
// // // // // // // // // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // //             SnackBar(content: Text("Location permission denied")),
// // // // // // // // // // //           );
// // // // // // // // // // //           return;
// // // // // // // // // // //         }
// // // // // // // // // // //       }

// // // // // // // // // // //       // Get current location
// // // // // // // // // // //       LocationData _currentLocation = await _location.getLocation();

// // // // // // // // // // //       // Update the location controller with latitude and longitude
// // // // // // // // // // //       setState(() {
// // // // // // // // // // //         _locationController.text =
// // // // // // // // // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // // // // // // // // //       });
// // // // // // // // // // //     } catch (e) {
// // // // // // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // //         SnackBar(content: Text("Error getting location: $e")),
// // // // // // // // // // //       );
// // // // // // // // // // //     }
// // // // // // // // // // //   }

// // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // //     final pickedFile =
// // // // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // // // //     if (pickedFile != null) {
// // // // // // // // // // //       setState(() {
// // // // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // // // //       });
// // // // // // // // // // //     }
// // // // // // // // // // //   }

// // // // // // // // // // //   void submitForm() async {
// // // // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // // // //       setState(() {
// // // // // // // // // // //         _isLoading = true;
// // // // // // // // // // //       });

// // // // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // // // //         'userName': _nameController.text,
// // // // // // // // // // //         'email': _emailController.text,
// // // // // // // // // // //         'password': _passwordController.text,
// // // // // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // // // // //         'userAddress': _addressController.text, // Address as string
// // // // // // // // // // //         'phone': _phoneController.text, // 9-digit phone number
// // // // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'), // Convert age to int
// // // // // // // // // // //         'gender':
// // // // // // // // // // //             _selectedGender == GenderType.male ? 1 : 0, // 1 = male, 0 = female
// // // // // // // // // // //         'type': widget.userType == 0 ? 0 : 1, // 0 = Customer, 1 = Vendor
// // // // // // // // // // //         'image': _avatarImage != null
// // // // // // // // // // //             ? base64Encode(
// // // // // // // // // // //                 _avatarImage!.readAsBytesSync()) // Convert image to Base64
// // // // // // // // // // //             : null,
// // // // // // // // // // //         'location': _locationController.text, // GPS Location as a string
// // // // // // // // // // //       };

// // // // // // // // // // //       try {
// // // // // // // // // // //         final response = await http.post(
// // // // // // // // // // //           Uri.parse('https://192.168.0.109:7127/api/user'), // Your API
// // // // // // // // // // //           headers: {
// // // // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // // // //           },
// // // // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // // // //         );

// // // // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // // // //           );
// // // // // // // // // // //           Navigator.pop(context);
// // // // // // // // // // //         } else {
// // // // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // // // //           );
// // // // // // // // // // //         }
// // // // // // // // // // //       } catch (e) {
// // // // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // // // //         );
// // // // // // // // // // //       } finally {
// // // // // // // // // // //         setState(() {
// // // // // // // // // // //           _isLoading = false;
// // // // // // // // // // //         });
// // // // // // // // // // //       }
// // // // // // // // // // //     }
// // // // // // // // // // //   }

// // // // // // // // // // //   @override
// // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // //     return Scaffold(
// // // // // // // // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // // // // // // // //       body: Padding(
// // // // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // // // //         child: Form(
// // // // // // // // // // //           key: _formKey,
// // // // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // // // //             child: Column(
// // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // // // //               children: [
// // // // // // // // // // //                 GestureDetector(
// // // // // // // // // // //                   onTap: _pickImage,
// // // // // // // // // // //                   child: CircleAvatar(
// // // // // // // // // // //                     radius: 100,
// // // // // // // // // // //                     backgroundImage:
// // // // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // // // //                     child: _avatarImage == null
// // // // // // // // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // // // // // // // //                         : null,
// // // // // // // // // // //                   ),
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Name
// // // // // // // // // // //                 TextFormField(
// // // // // // // // // // //                   controller: _nameController,
// // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Email
// // // // // // // // // // //                 TextFormField(
// // // // // // // // // // //                   controller: _emailController,
// // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // // // // // // // //                       ? 'Enter a valid email'
// // // // // // // // // // //                       : null,
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Password
// // // // // // // // // // //                 TextFormField(
// // // // // // // // // // //                   controller: _passwordController,
// // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // //                     labelText: 'Password',
// // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // //                       icon: Icon(_obscurePassword
// // // // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // // // //                           : Icons.visibility),
// // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // //                         setState(() {
// // // // // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // // // // //                         });
// // // // // // // // // // //                       },
// // // // // // // // // // //                     ),
// // // // // // // // // // //                   ),
// // // // // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // // // // //                   validator: (value) => value == null || value.length < 6
// // // // // // // // // // //                       ? 'Password must be at least 6 characters'
// // // // // // // // // // //                       : null,
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Confirm Password
// // // // // // // // // // //                 TextFormField(
// // // // // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // //                       icon: Icon(_obscureConfirmPassword
// // // // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // // // //                           : Icons.visibility),
// // // // // // // // // // //                       onPressed: () {
// // // // // // // // // // //                         setState(() {
// // // // // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // // // // //                         });
// // // // // // // // // // //                       },
// // // // // // // // // // //                     ),
// // // // // // // // // // //                   ),
// // // // // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // // // // //                   validator: (value) => value != _passwordController.text
// // // // // // // // // // //                       ? 'Passwords do not match'
// // // // // // // // // // //                       : null,
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Age Dropdown
// // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // //                   value: _selectedAge,
// // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // // // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // // // // // // // // //                       .map((age) =>
// // // // // // // // // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // // // // // // // // //                       .toList(),
// // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // //                     setState(() {
// // // // // // // // // // //                       _selectedAge = value;
// // // // // // // // // // //                     });
// // // // // // // // // // //                   },
// // // // // // // // // // //                   validator: (value) =>
// // // // // // // // // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Gender Radio Buttons
// // // // // // // // // // //                 Row(
// // // // // // // // // // //                   children: [
// // // // // // // // // // //                     Expanded(
// // // // // // // // // // //                       child: ListTile(
// // // // // // // // // // //                         title: Text('Male'),
// // // // // // // // // // //                         leading: Radio<GenderType>(
// // // // // // // // // // //                           value: GenderType.male,
// // // // // // // // // // //                           groupValue: _selectedGender,
// // // // // // // // // // //                           onChanged: (GenderType? value) {
// // // // // // // // // // //                             setState(() {
// // // // // // // // // // //                               _selectedGender = value;
// // // // // // // // // // //                             });
// // // // // // // // // // //                           },
// // // // // // // // // // //                         ),
// // // // // // // // // // //                       ),
// // // // // // // // // // //                     ),
// // // // // // // // // // //                     Expanded(
// // // // // // // // // // //                       child: ListTile(
// // // // // // // // // // //                         title: Text('Female'),
// // // // // // // // // // //                         leading: Radio<GenderType>(
// // // // // // // // // // //                           value: GenderType.female,
// // // // // // // // // // //                           groupValue: _selectedGender,
// // // // // // // // // // //                           onChanged: (GenderType? value) {
// // // // // // // // // // //                             setState(() {
// // // // // // // // // // //                               _selectedGender = value;
// // // // // // // // // // //                             });
// // // // // // // // // // //                           },
// // // // // // // // // // //                         ),
// // // // // // // // // // //                       ),
// // // // // // // // // // //                     ),
// // // // // // // // // // //                   ],
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Phone Number with Flag
// // // // // // // // // // //                 Row(
// // // // // // // // // // //                   children: [
// // // // // // // // // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // // // // // // // // //                     SizedBox(width: 8),
// // // // // // // // // // //                     Expanded(
// // // // // // // // // // //                       child: TextFormField(
// // // // // // // // // // //                         controller: _phoneController,
// // // // // // // // // // //                         keyboardType: TextInputType.phone,
// // // // // // // // // // //                         maxLength: 9, // Restrict to 9 digits
// // // // // // // // // // //                         decoration: InputDecoration(
// // // // // // // // // // //                           labelText: 'Phone Number',
// // // // // // // // // // //                           counterText: "", // Hide character count
// // // // // // // // // // //                         ),
// // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // //                           if (value == null ||
// // // // // // // // // // //                               value.isEmpty ||
// // // // // // // // // // //                               value.length != 9 ||
// // // // // // // // // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // // // // // // // // //                             return 'Enter a valid 9-digit number';
// // // // // // // // // // //                           }
// // // // // // // // // // //                           return null;
// // // // // // // // // // //                         },
// // // // // // // // // // //                       ),
// // // // // // // // // // //                     ),
// // // // // // // // // // //                   ],
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Address Dropdown
// // // // // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // // // // //                   value: _addressController.text.isEmpty
// // // // // // // // // // //                       ? null
// // // // // // // // // // //                       : _addressController.text,
// // // // // // // // // // //                   decoration: InputDecoration(labelText: 'Street Address'),
// // // // // // // // // // //                   items: _tripoliStreets
// // // // // // // // // // //                       .map((street) => DropdownMenuItem(
// // // // // // // // // // //                             value: street,
// // // // // // // // // // //                             child: Text(street),
// // // // // // // // // // //                           ))
// // // // // // // // // // //                       .toList(),
// // // // // // // // // // //                   onChanged: (value) {
// // // // // // // // // // //                     setState(() {
// // // // // // // // // // //                       _addressController.text = value!;
// // // // // // // // // // //                     });
// // // // // // // // // // //                   },
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Location Icon Button
// // // // // // // // // // //                 TextFormField(
// // // // // // // // // // //                   controller: _locationController,
// // // // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // // // //                     labelText: 'Location',
// // // // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // // // //                       icon: Icon(Icons.location_on),
// // // // // // // // // // //                       onPressed: _getCurrentLocation,
// // // // // // // // // // //                     ),
// // // // // // // // // // //                   ),
// // // // // // // // // // //                   readOnly: true,
// // // // // // // // // // //                   validator: (value) => value == null || value.isEmpty
// // // // // // // // // // //                       ? 'Location is required'
// // // // // // // // // // //                       : null,
// // // // // // // // // // //                 ),
// // // // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // // // //                 // Submit Button
// // // // // // // // // // //                 ElevatedButton(
// // // // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // // // //                   child:
// // // // // // // // // // //                       _isLoading ? CircularProgressIndicator() : Text('Submit'),
// // // // // // // // // // //                 ),
// // // // // // // // // // //               ],
// // // // // // // // // // //             ),
// // // // // // // // // // //           ),
// // // // // // // // // // //         ),
// // // // // // // // // // //       ),
// // // // // // // // // // //     );
// // // // // // // // // // //   }
// // // // // // // // // // // }
// // // // // // // // import 'dart:convert';
// // // // // // // // import 'dart:io';
// // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // import 'package:location/location.dart';
// // // // // // // // import 'package:flag/flag.dart';

// // // // // // // // // Define the GenderType enum
// // // // // // // // enum GenderType { male, female }

// // // // // // // // // Define the CategoryType enum for Vendor categories
// // // // // // // // enum CategoryType { salon, education, plumbing, cleaning, other }

// // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // //   @override
// // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // }

// // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // //   final _nameController = TextEditingController();
// // // // // // // //   final _emailController = TextEditingController();
// // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // //   final _addressController = TextEditingController();
// // // // // // // //   final _phoneController = TextEditingController();
// // // // // // // //   final _locationController = TextEditingController();

// // // // // // // //   // For Vendor-specific fields
// // // // // // // //   final _bioController = TextEditingController();
// // // // // // // //   final _experienceController = TextEditingController();
// // // // // // // //   CategoryType? _selectedCategory = CategoryType.other;

// // // // // // // //   File? _avatarImage;
// // // // // // // //   bool _isLoading = false;
// // // // // // // //   bool _obscurePassword = true;
// // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // //   String? _selectedAge;
// // // // // // // //   GenderType? _selectedGender;
// // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // //     "Martyrs' Square",
// // // // // // // //     "Al-Mansoura",
// // // // // // // //     "Gargaresh",
// // // // // // // //     "Hai Al-Andalus",
// // // // // // // //     "Ben Ashur",
// // // // // // // //     "Garden City",
// // // // // // // //     "Abu Salim",
// // // // // // // //     "Souk Al-Juma",
// // // // // // // //     "Janzour"
// // // // // // // //   ];

// // // // // // // //   // Location Service
// // // // // // // //   Location _location = Location();

// // // // // // // //   // Method to get current location
// // // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // // //     try {
// // // // // // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // // // // // //       if (!_serviceEnabled) {
// // // // // // // //         _serviceEnabled = await _location.requestService();
// // // // // // // //         if (!_serviceEnabled) {
// // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // //             SnackBar(content: Text("Location service is not enabled")),
// // // // // // // //           );
// // // // // // // //           return;
// // // // // // // //         }
// // // // // // // //       }

// // // // // // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // // // // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // // // // // //         _permissionGranted = await _location.requestPermission();
// // // // // // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // //             SnackBar(content: Text("Location permission denied")),
// // // // // // // //           );
// // // // // // // //           return;
// // // // // // // //         }
// // // // // // // //       }

// // // // // // // //       LocationData _currentLocation = await _location.getLocation();
// // // // // // // //       setState(() {
// // // // // // // //         _locationController.text =
// // // // // // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // // // // // //       });
// // // // // // // //     } catch (e) {
// // // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // //         SnackBar(content: Text("Error getting location: $e")),
// // // // // // // //       );
// // // // // // // //     }
// // // // // // // //   }

// // // // // // // //   Future<void> _pickImage() async {
// // // // // // // //     final pickedFile =
// // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // //     if (pickedFile != null) {
// // // // // // // //       setState(() {
// // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // //       });
// // // // // // // //     }
// // // // // // // //   }

// // // // // // // //   void submitForm() async {
// // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // //       setState(() {
// // // // // // // //         _isLoading = true;
// // // // // // // //       });

// // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // //         'userName': _nameController.text,
// // // // // // // //         'email': _emailController.text,
// // // // // // // //         'password': _passwordController.text,
// // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // //         'userAddress': _addressController.text,
// // // // // // // //         'phone': _phoneController.text,
// // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // //         'gender': _selectedGender == GenderType.male ? 1 : 0,
// // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // //         'image': _avatarImage != null
// // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // //             : null,
// // // // // // // //         'location': _locationController.text,
// // // // // // // //       };

// // // // // // // //       if (widget.userType == 1) {
// // // // // // // //         // Vendor-specific fields
// // // // // // // //         formData['bio'] = _bioController.text;
// // // // // // // //         formData['experience'] = int.tryParse(_experienceController.text);
// // // // // // // //         formData['category'] = _selectedCategory.toString().split('.').last;
// // // // // // // //       }

// // // // // // // //       try {
// // // // // // // //         final response = await http.post(
// // // // // // // //           Uri.parse('https://192.168.0.109:7127/api/user'),
// // // // // // // //           headers: {
// // // // // // // //             'Content-Type': 'application/json',
// // // // // // // //           },
// // // // // // // //           body: jsonEncode(formData),
// // // // // // // //         );

// // // // // // // //         if (response.statusCode == 201) {
// // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // //           );
// // // // // // // //           Navigator.pop(context);
// // // // // // // //         } else {
// // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // //           );
// // // // // // // //         }
// // // // // // // //       } catch (e) {
// // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // //         );
// // // // // // // //       } finally {
// // // // // // // //         setState(() {
// // // // // // // //           _isLoading = false;
// // // // // // // //         });
// // // // // // // //       }
// // // // // // // //     }
// // // // // // // //   }

// // // // // // // //   @override
// // // // // // // //   Widget build(BuildContext context) {
// // // // // // // //     return Scaffold(
// // // // // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // // // // //       body: Padding(
// // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // //         child: Form(
// // // // // // // //           key: _formKey,
// // // // // // // //           child: SingleChildScrollView(
// // // // // // // //             child: Column(
// // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // //               children: [
// // // // // // // //                 GestureDetector(
// // // // // // // //                   onTap: _pickImage,
// // // // // // // //                   child: CircleAvatar(
// // // // // // // //                     radius: 100,
// // // // // // // //                     backgroundImage:
// // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // //                     child: _avatarImage == null
// // // // // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // // // // //                         : null,
// // // // // // // //                   ),
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 TextFormField(
// // // // // // // //                   controller: _nameController,
// // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // //                   validator: (value) =>
// // // // // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 TextFormField(
// // // // // // // //                   controller: _emailController,
// // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // // // // //                       ? 'Enter a valid email'
// // // // // // // //                       : null,
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 TextFormField(
// // // // // // // //                   controller: _passwordController,
// // // // // // // //                   decoration: InputDecoration(
// // // // // // // //                     labelText: 'Password',
// // // // // // // //                     suffixIcon: IconButton(
// // // // // // // //                       icon: Icon(_obscurePassword
// // // // // // // //                           ? Icons.visibility_off
// // // // // // // //                           : Icons.visibility),
// // // // // // // //                       onPressed: () {
// // // // // // // //                         setState(() {
// // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // //                         });
// // // // // // // //                       },
// // // // // // // //                     ),
// // // // // // // //                   ),
// // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // //                   validator: (value) => value == null || value.length < 6
// // // // // // // //                       ? 'Password must be at least 6 characters'
// // // // // // // //                       : null,
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 TextFormField(
// // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // //                   decoration: InputDecoration(
// // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // //                     suffixIcon: IconButton(
// // // // // // // //                       icon: Icon(_obscureConfirmPassword
// // // // // // // //                           ? Icons.visibility_off
// // // // // // // //                           : Icons.visibility),
// // // // // // // //                       onPressed: () {
// // // // // // // //                         setState(() {
// // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // //                         });
// // // // // // // //                       },
// // // // // // // //                     ),
// // // // // // // //                   ),
// // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // //                   validator: (value) => value != _passwordController.text
// // // // // // // //                       ? 'Passwords do not match'
// // // // // // // //                       : null,
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // //                   value: _selectedAge,
// // // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // // // // // //                       .map((age) =>
// // // // // // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // // // // // //                       .toList(),
// // // // // // // //                   onChanged: (value) {
// // // // // // // //                     setState(() {
// // // // // // // //                       _selectedAge = value;
// // // // // // // //                     });
// // // // // // // //                   },
// // // // // // // //                   validator: (value) =>
// // // // // // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 Row(
// // // // // // // //                   children: [
// // // // // // // //                     Expanded(
// // // // // // // //                       child: ListTile(
// // // // // // // //                         title: Text('Male'),
// // // // // // // //                         leading: Radio<GenderType>(
// // // // // // // //                           value: GenderType.male,
// // // // // // // //                           groupValue: _selectedGender,
// // // // // // // //                           onChanged: (GenderType? value) {
// // // // // // // //                             setState(() {
// // // // // // // //                               _selectedGender = value;
// // // // // // // //                             });
// // // // // // // //                           },
// // // // // // // //                         ),
// // // // // // // //                       ),
// // // // // // // //                     ),
// // // // // // // //                     Expanded(
// // // // // // // //                       child: ListTile(
// // // // // // // //                         title: Text('Female'),
// // // // // // // //                         leading: Radio<GenderType>(
// // // // // // // //                           value: GenderType.female,
// // // // // // // //                           groupValue: _selectedGender,
// // // // // // // //                           onChanged: (GenderType? value) {
// // // // // // // //                             setState(() {
// // // // // // // //                               _selectedGender = value;
// // // // // // // //                             });
// // // // // // // //                           },
// // // // // // // //                         ),
// // // // // // // //                       ),
// // // // // // // //                     ),
// // // // // // // //                   ],
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 Row(
// // // // // // // //                   children: [
// // // // // // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // // // // // //                     SizedBox(width: 8),
// // // // // // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // // // // // //                     SizedBox(width: 8),
// // // // // // // //                     Expanded(
// // // // // // // //                       child: TextFormField(
// // // // // // // //                         controller: _phoneController,
// // // // // // // //                         keyboardType: TextInputType.phone,
// // // // // // // //                         maxLength: 9,
// // // // // // // //                         decoration: InputDecoration(
// // // // // // // //                           labelText: 'Phone Number',
// // // // // // // //                           counterText: "",
// // // // // // // //                         ),
// // // // // // // //                         validator: (value) {
// // // // // // // //                           if (value == null ||
// // // // // // // //                               value.isEmpty ||
// // // // // // // //                               value.length != 9 ||
// // // // // // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // // // // // //                             return 'Enter a valid 9-digit number';
// // // // // // // //                           }
// // // // // // // //                           return null;
// // // // // // // //                         },
// // // // // // // //                       ),
// // // // // // // //                     ),
// // // // // // // //                   ],
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 DropdownButtonFormField<String>(
// // // // // // // //                   value: _addressController.text.isEmpty
// // // // // // // //                       ? null
// // // // // // // //                       : _addressController.text,
// // // // // // // //                   decoration: InputDecoration(labelText: 'Street Address'),
// // // // // // // //                   items: _tripoliStreets
// // // // // // // //                       .map((street) => DropdownMenuItem(
// // // // // // // //                             value: street,
// // // // // // // //                             child: Text(street),
// // // // // // // //                           ))
// // // // // // // //                       .toList(),
// // // // // // // //                   onChanged: (value) {
// // // // // // // //                     setState(() {
// // // // // // // //                       _addressController.text = value!;
// // // // // // // //                     });
// // // // // // // //                   },
// // // // // // // //                 ),
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 TextFormField(
// // // // // // // //                   controller: _locationController,
// // // // // // // //                   decoration: InputDecoration(
// // // // // // // //                     labelText: 'Location',
// // // // // // // //                     suffixIcon: IconButton(
// // // // // // // //                       icon: Icon(Icons.location_on),
// // // // // // // //                       onPressed: _getCurrentLocation,
// // // // // // // //                     ),
// // // // // // // //                   ),
// // // // // // // //                   readOnly: true,
// // // // // // // //                   validator: (value) =>
// // // // // // // //                       value == null || value.isEmpty ? 'Location is required' : null,
// // // // // // // //                 ),
// // // // // // // //                 if (widget.userType == 1) ...[
// // // // // // // //                   SizedBox(height: 16),
// // // // // // // //                   TextFormField(
// // // // // // // //                     controller: _bioController,
// // // // // // // //                     decoration: InputDecoration(labelText: 'Bio'),
// // // // // // // //                     validator: (value) =>
// // // // // // // //                         value == null || value.isEmpty ? 'Enter your bio' : null,
// // // // // // // //                   ),
// // // // // // // //                   SizedBox(height: 16),
// // // // // // // //                   TextFormField(
// // // // // // // //                     controller: _experienceController,
// // // // // // // //                     keyboardType: TextInputType.number,
// // // // // // // //                     decoration: InputDecoration(labelText: 'Experience in Years'),
// // // // // // // //                     validator: (value) {
// // // // // // // //                       if (value == null || value.isEmpty) {
// // // // // // // //                         return 'Enter years of experience';
// // // // // // // //                       }
// // // // // // // //                       if (int.tryParse(value) == null) {
// // // // // // // //                         return 'Enter a valid number';
// // // // // // // //                       }
// // // // // // // //                       return null;
// // // // // // // //                     },
// // // // // // // //                   ),
// // // // // // // //                   SizedBox(height: 16),
// // // // // // // //                   DropdownButtonFormField<CategoryType>(
// // // // // // // //                     value: _selectedCategory,
// // // // // // // //                     decoration: InputDecoration(labelText: 'Category'),
// // // // // // // //                     items: CategoryType.values
// // // // // // // //                         .map((category) => DropdownMenuItem<CategoryType>(
// // // // // // // //                               value: category,
// // // // // // // //                               child: Text(category.toString().split('.').last),
// // // // // // // //                             ))
// // // // // // // //                         .toList(),
// // // // // // // //                     onChanged: (value) {
// // // // // // // //                       setState(() {
// // // // // // // //                         _selectedCategory = value;
// // // // // // // //                       });
// // // // // // // //                     },
// // // // // // // //                   ),
// // // // // // // //                 ],
// // // // // // // //                 SizedBox(height: 16),
// // // // // // // //                 ElevatedButton(
// // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // //                   child: _isLoading ? CircularProgressIndicator() : Text('Submit'),
// // // // // // // //                 ),
// // // // // // // //               ],
// // // // // // // //             ),
// // // // // // // //           ),
// // // // // // // //         ),
// // // // // // // //       ),
// // // // // // // //     );
// // // // // // // //   }
// // // // // // // // }
// // // // // // // // // import 'dart:io';
// // // // // // // // // import 'dart:convert';
// // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // import 'package:location/location.dart';

// // // // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // // // //   @override
// // // // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // // // }

// // // // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // //   final _nameController = TextEditingController();
// // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // //   final _passwordController = TextEditingController();
// // // // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // // // //   final _addressController = TextEditingController();
// // // // // // // // //   final _phoneController = TextEditingController();
// // // // // // // // //   final _locationController = TextEditingController();

// // // // // // // // //   // For Vendor-specific fields
// // // // // // // // //   final _bioController = TextEditingController();
// // // // // // // // //   final _experienceController = TextEditingController();

// // // // // // // // //   List<Map<String, dynamic>> _categories = []; // Categories fetched from API
// // // // // // // // //   Map<String, dynamic>? _selectedCategory; // To store the selected category
// // // // // // // // //   File? _avatarImage;
// // // // // // // // //   bool _isLoading = false;
// // // // // // // // //   bool _obscurePassword = true;
// // // // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // // // //   String? _selectedAge;
// // // // // // // // //   String? _selectedGender;
// // // // // // // // //   final List<String> _tripoliStreets = [
// // // // // // // // //     "Martyrs' Square",
// // // // // // // // //     "Al-Mansoura",
// // // // // // // // //     "Gargaresh",
// // // // // // // // //     "Hai Al-Andalus",
// // // // // // // // //     "Ben Ashur",
// // // // // // // // //     "Garden City",
// // // // // // // // //     "Abu Salim",
// // // // // // // // //     "Souk Al-Juma",
// // // // // // // // //     "Janzour"
// // // // // // // // //   ];

// // // // // // // // //   // Location Service
// // // // // // // // //   Location _location = Location();

// // // // // // // // //   // Method to get current location
// // // // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // // // //     try {
// // // // // // // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // // // // // // //       if (!_serviceEnabled) {
// // // // // // // // //         _serviceEnabled = await _location.requestService();
// // // // // // // // //         if (!_serviceEnabled) {
// // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //             SnackBar(content: Text("Location service is not enabled")),
// // // // // // // // //           );
// // // // // // // // //           return;
// // // // // // // // //         }
// // // // // // // // //       }

// // // // // // // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // // // // // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // // // // // // //         _permissionGranted = await _location.requestPermission();
// // // // // // // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //             SnackBar(content: Text("Location permission denied")),
// // // // // // // // //           );
// // // // // // // // //           return;
// // // // // // // // //         }
// // // // // // // // //       }

// // // // // // // // //       LocationData _currentLocation = await _location.getLocation();
// // // // // // // // //       setState(() {
// // // // // // // // //         _locationController.text =
// // // // // // // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // // // // // // //       });
// // // // // // // // //     } catch (e) {
// // // // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //         SnackBar(content: Text("Error getting location: $e")),
// // // // // // // // //       );
// // // // // // // // //     }
// // // // // // // // //   }

// // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // //     final pickedFile =
// // // // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // // // //     if (pickedFile != null) {
// // // // // // // // //       setState(() {
// // // // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // // // //       });
// // // // // // // // //     }
// // // // // // // // //   }

// // // // // // // // //   // Fetch Categories from API
// // // // // // // // //   Future<void> _fetchCategories() async {
// // // // // // // // //     try {
// // // // // // // // //       final response = await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
// // // // // // // // //       if (response.statusCode == 200 || response.statusCode == 201) {
// // // // // // // // //         final List<dynamic> data = jsonDecode(response.body);
// // // // // // // // //         setState(() {
// // // // // // // // //           _categories = data.map((item) {
// // // // // // // // //             return {
// // // // // // // // //               'id': item['id'],
// // // // // // // // //               'name': item['name'],
// // // // // // // // //             };
// // // // // // // // //           }).toList();
// // // // // // // // //           if (_categories.isNotEmpty) {
// // // // // // // // //             _selectedCategory = _categories[0];  // Set first category as default
// // // // // // // // //           }
// // // // // // // // //         });
// // // // // // // // //       } else {
// // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //           SnackBar(content: Text("Failed to fetch categories")),
// // // // // // // // //         );
// // // // // // // // //       }
// // // // // // // // //     } catch (e) {
// // // // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //         SnackBar(content: Text("Error fetching categories: $e")),
// // // // // // // // //       );
// // // // // // // // //     }
// // // // // // // // //   }

// // // // // // // // //   void submitForm() async {
// // // // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // // // //       setState(() {
// // // // // // // // //         _isLoading = true;
// // // // // // // // //       });

// // // // // // // // //       final Map<String, dynamic> formData = {
// // // // // // // // //         'userName': _nameController.text,
// // // // // // // // //         'email': _emailController.text,
// // // // // // // // //         'password': _passwordController.text,
// // // // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // // // //         'userAddress': _addressController.text,
// // // // // // // // //         'phone': _phoneController.text,
// // // // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // // // //         'gender': _selectedGender,
// // // // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // // // //         'image': _avatarImage != null
// // // // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // // // //             : null,
// // // // // // // // //         'location': _locationController.text,
// // // // // // // // //       };

// // // // // // // // //       if (widget.userType == 1) {
// // // // // // // // //         // Vendor-specific fields
// // // // // // // // //         formData['bio'] = _bioController.text;
// // // // // // // // //         formData['experience'] = int.tryParse(_experienceController.text);
// // // // // // // // //         formData['categoryId'] = _selectedCategory?['id']; // Using category from API
// // // // // // // // //       }

// // // // // // // // //       try {
// // // // // // // // //         final response = await http.post(
// // // // // // // // //           Uri.parse('https://192.168.0.109:7127/api/user'),
// // // // // // // // //           headers: {
// // // // // // // // //             'Content-Type': 'application/json',
// // // // // // // // //           },
// // // // // // // // //           body: jsonEncode(formData),
// // // // // // // // //         );

// // // // // // // // //         if (response.statusCode == 201) {
// // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // // // //           );
// // // // // // // // //           Navigator.pop(context);
// // // // // // // // //         } else {
// // // // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // // // //           );
// // // // // // // // //         }
// // // // // // // // //       } catch (e) {
// // // // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // // // //         );
// // // // // // // // //       } finally {
// // // // // // // // //         setState(() {
// // // // // // // // //           _isLoading = false;
// // // // // // // // //         });
// // // // // // // // //       }
// // // // // // // // //     }
// // // // // // // // //   }

// // // // // // // // //   @override
// // // // // // // // //   void initState() {
// // // // // // // // //     super.initState();
// // // // // // // // //     _fetchCategories();  // Fetch categories on screen load
// // // // // // // // //   }

// // // // // // // // //   @override
// // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // //     return Scaffold(
// // // // // // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // // // // // //       body: Padding(
// // // // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // // // //         child: Form(
// // // // // // // // //           key: _formKey,
// // // // // // // // //           child: SingleChildScrollView(
// // // // // // // // //             child: Column(
// // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // // // //               children: [
// // // // // // // // //                 GestureDetector(
// // // // // // // // //                   onTap: _pickImage,
// // // // // // // // //                   child: CircleAvatar(
// // // // // // // // //                     radius: 100,
// // // // // // // // //                     backgroundImage:
// // // // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // // // //                     child: _avatarImage == null
// // // // // // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // // // // // //                         : null,
// // // // // // // // //                   ),
// // // // // // // // //                 ),
// // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // //                 TextFormField(
// // // // // // // // //                   controller: _nameController,
// // // // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // // // //                   validator: (value) =>
// // // // // // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // // // // // //                 ),
// // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // //                 TextFormField(
// // // // // // // // //                   controller: _emailController,
// // // // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // // // // // //                       ? 'Enter a valid email'
// // // // // // // // //                       : null,
// // // // // // // // //                 ),
// // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // //                 TextFormField(
// // // // // // // // //                   controller: _passwordController,
// // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // //                     labelText: 'Password',
// // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // //                       icon: Icon(_obscurePassword
// // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // //                           : Icons.visibility),
// // // // // // // // //                       onPressed: () {
// // // // // // // // //                         setState(() {
// // // // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // // // //                         });
// // // // // // // // //                       },
// // // // // // // // //                     ),
// // // // // // // // //                   ),
// // // // // // // // //                   obscureText: _obscurePassword,
// // // // // // // // //                   validator: (value) => value == null || value.length < 6
// // // // // // // // //                       ? 'Password must be at least 6 characters'
// // // // // // // // //                       : null,
// // // // // // // // //                 ),
// // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // //                 TextFormField(
// // // // // // // // //                   controller: _confirmPasswordController,
// // // // // // // // //                   decoration: InputDecoration(
// // // // // // // // //                     labelText: 'Confirm Password',
// // // // // // // // //                     suffixIcon: IconButton(
// // // // // // // // //                       icon: Icon(_obscureConfirmPassword
// // // // // // // // //                           ? Icons.visibility_off
// // // // // // // // //                           : Icons.visibility),
// // // // // // // // //                       onPressed: () {
// // // // // // // // //                         setState(() {
// // // // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // // // //                         });
// // // // // // // // //                       },
// // // // // // // // //                     ),
// // // // // // // // //                   ),
// // // // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // // // //                   validator: (value) => value != _passwordController.text
// // // // // // // // //                       ? 'Passwords do not match'
// // // // // // // // //                       : null,
// // // // // // // // //                 ),
// // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // //                 DropdownButtonFormField<Map<String, dynamic>>(
// // // // // // // // //                   value: _selectedCategory,
// // // // // // // // //                   decoration: InputDecoration(labelText: 'Category'),
// // // // // // // // //                   items: _categories.map((category) {
// // // // // // // // //                     return DropdownMenuItem<Map<String, dynamic>>(
// // // // // // // // //                       value: category,
// // // // // // // // //                       child: Text(category['name']),
// // // // // // // // //                     );
// // // // // // // // //                   }).toList(),
// // // // // // // // //                   onChanged: (Map<String, dynamic>? value) {
// // // // // // // // //                     setState(() {
// // // // // // // // //                       _selectedCategory = value;
// // // // // // // // //                     });
// // // // // // // // //                   },
// // // // // // // // //                 ),
// // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // //                 TextFormField(
// // // // // // // // //                   controller: _addressController,
// // // // // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // // // // //                   validator: (value) =>
// // // // // // // // //                       value == null || value.isEmpty ? 'Enter your address' : null,
// // // // // // // // //                 ),
// // // // // // // // //                 SizedBox(height: 16),
// // // // // // // // //                 ElevatedButton(
// // // // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // // // //                   child: _isLoading
// // // // // // // // //                       ? CircularProgressIndicator()
// // // // // // // // //                       : Text('Submit'),
// // // // // // // // //                 ),
// // // // // // // // //               ],
// // // // // // // // //             ),
// // // // // // // // //           ),
// // // // // // // // //         ),
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }
// // // // // // // // // }
// // // // // // // import 'dart:convert';
// // // // // // // import 'dart:io';
// // // // // // // import 'package:flutter/material.dart';
// // // // // // // import 'package:http/http.dart' as http;
// // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // import 'package:location/location.dart';
// // // // // // // import 'package:flag/flag.dart';

// // // // // // // // Define the GenderType enum
// // // // // // // enum GenderType { male, female }

// // // // // // // // Define the CategoryType enum for Vendor categories
// // // // // // // enum CategoryType { salon, education, plumbing, cleaning, other }

// // // // // // // class SignUpScreen extends StatefulWidget {
// // // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // // //   @override
// // // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // // }

// // // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // //   final _nameController = TextEditingController();
// // // // // // //   final _emailController = TextEditingController();
// // // // // // //   final _passwordController = TextEditingController();
// // // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // // //   final _addressController = TextEditingController();
// // // // // // //   final _phoneController = TextEditingController();
// // // // // // //   final _locationController = TextEditingController();

// // // // // // //   // For Vendor-specific fields
// // // // // // //   final _bioController = TextEditingController();
// // // // // // //   final _experienceController = TextEditingController();
// // // // // // //   List<Map<String, dynamic>> _categories = []; // Categories fetched from API
// // // // // // //   Map<String, dynamic>? _selectedCategory; // To store the selected category

// // // // // // //   File? _avatarImage;
// // // // // // //   bool _isLoading = false;
// // // // // // //   bool _obscurePassword = true;
// // // // // // //   bool _obscureConfirmPassword = true;
// // // // // // //   String? _selectedAge;
// // // // // // //   GenderType? _selectedGender;
// // // // // // //   final List<String> _tripoliStreets = [
// // // // // // //     "Martyrs' Square",
// // // // // // //     "Al-Mansoura",
// // // // // // //     "Gargaresh",
// // // // // // //     "Hai Al-Andalus",
// // // // // // //     "Ben Ashur",
// // // // // // //     "Garden City",
// // // // // // //     "Abu Salim",
// // // // // // //     "Souk Al-Juma",
// // // // // // //     "Janzour"
// // // // // // //   ];

// // // // // // //   // Location Service
// // // // // // //   Location _location = Location();

// // // // // // //   // Method to get current location
// // // // // // //   Future<void> _getCurrentLocation() async {
// // // // // // //     try {
// // // // // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // // // // //       if (!_serviceEnabled) {
// // // // // // //         _serviceEnabled = await _location.requestService();
// // // // // // //         if (!_serviceEnabled) {
// // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //             SnackBar(content: Text("Location service is not enabled")),
// // // // // // //           );
// // // // // // //           return;
// // // // // // //         }
// // // // // // //       }

// // // // // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // // // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // // // // //         _permissionGranted = await _location.requestPermission();
// // // // // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //             SnackBar(content: Text("Location permission denied")),
// // // // // // //           );
// // // // // // //           return;
// // // // // // //         }
// // // // // // //       }

// // // // // // //       LocationData _currentLocation = await _location.getLocation();
// // // // // // //       setState(() {
// // // // // // //         _locationController.text =
// // // // // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // // // // //       });
// // // // // // //     } catch (e) {
// // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //         SnackBar(content: Text("Error getting location: $e")),
// // // // // // //       );
// // // // // // //     }
// // // // // // //   }

// // // // // // //   Future<void> _pickImage() async {
// // // // // // //     final pickedFile =
// // // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // // //     if (pickedFile != null) {
// // // // // // //       setState(() {
// // // // // // //         _avatarImage = File(pickedFile.path);
// // // // // // //       });
// // // // // // //     }
// // // // // // //   }

// // // // // // //   void _fetchCategories() async {
// // // // // // //     try {
// // // // // // //       final response =
// // // // // // //           await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
// // // // // // //       print(response.statusCode); // Log the response status code
// // // // // // //       if (response.statusCode == 200 || response.statusCode == 201) {
// // // // // // //         final List<dynamic> data = jsonDecode(response.body);
// // // // // // //         setState(() {
// // // // // // //           _categories = data.map((item) {
// // // // // // //             return {
// // // // // // //               'id': item['id'],
// // // // // // //               'name': item['name'],
// // // // // // //             };
// // // // // // //           }).toList();
// // // // // // //           if (_categories.isNotEmpty) {
// // // // // // //             _selectedCategory =
// // // // // // //                 _categories[0]; // Set the first category as the default
// // // // // // //           }
// // // // // // //         });
// // // // // // //       } else {
// // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //           SnackBar(content: Text("Failed to fetch categories")),
// // // // // // //         );
// // // // // // //       }
// // // // // // //     } catch (e) {
// // // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //         SnackBar(content: Text("Error fetching categories: $e")),
// // // // // // //       );
// // // // // // //     }
// // // // // // //   }

// // // // // // //   void submitForm() async {
// // // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // // //       setState(() {
// // // // // // //         _isLoading = true;
// // // // // // //       });

// // // // // // //       final Map<String, dynamic> formData = {
// // // // // // //         'userName': _nameController.text,
// // // // // // //         'email': _emailController.text,
// // // // // // //         'password': _passwordController.text,
// // // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // // //         'userAddress': _addressController.text,
// // // // // // //         'phone': _phoneController.text,
// // // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // // //         'gender': _selectedGender == GenderType.male ? 1 : 0,
// // // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // // //         'image': _avatarImage != null
// // // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // // //             : null,
// // // // // // //         'location': _locationController.text,
// // // // // // //       };

// // // // // // //       if (widget.userType == 1) {
// // // // // // //         // Vendor-specific fields
// // // // // // //         formData['bio'] = _bioController.text;
// // // // // // //         formData['experience'] = int.tryParse(_experienceController.text);
// // // // // // //       formData['categoryId'] = _fetchCategories();

// // // // // // //       }

// // // // // // //       try {
// // // // // // //         final response = await http.post(
// // // // // // //           Uri.parse('https://192.168.0.109:7127/api/user'),
// // // // // // //           headers: {
// // // // // // //             'Content-Type': 'application/json',
// // // // // // //           },
// // // // // // //           body: jsonEncode(formData),
// // // // // // //         );

// // // // // // //         if (response.statusCode == 201) {
// // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // // //           );
// // // // // // //           Navigator.pop(context);
// // // // // // //         } else {
// // // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // // //           );
// // // // // // //         }
// // // // // // //       } catch (e) {
// // // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // // //         );
// // // // // // //       } finally {
// // // // // // //         setState(() {
// // // // // // //           _isLoading = false;
// // // // // // //         });
// // // // // // //       }
// // // // // // //     }
// // // // // // //   }

// // // // // // //   @override
// // // // // // //   Widget build(BuildContext context) {
// // // // // // //     return Scaffold(
// // // // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // // // //       body: Padding(
// // // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // // //         child: Form(
// // // // // // //           key: _formKey,
// // // // // // //           child: SingleChildScrollView(
// // // // // // //             child: Column(
// // // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // // //               children: [
// // // // // // //                 GestureDetector(
// // // // // // //                   onTap: _pickImage,
// // // // // // //                   child: CircleAvatar(
// // // // // // //                     radius: 100,
// // // // // // //                     backgroundImage:
// // // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // // //                     child: _avatarImage == null
// // // // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // // // //                         : null,
// // // // // // //                   ),
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 TextFormField(
// // // // // // //                   controller: _nameController,
// // // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // // //                   validator: (value) =>
// // // // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 TextFormField(
// // // // // // //                   controller: _emailController,
// // // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // // // //                       ? 'Enter a valid email'
// // // // // // //                       : null,
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 TextFormField(
// // // // // // //                   controller: _passwordController,
// // // // // // //                   decoration: InputDecoration(
// // // // // // //                     labelText: 'Password',
// // // // // // //                     suffixIcon: IconButton(
// // // // // // //                       icon: Icon(_obscurePassword
// // // // // // //                           ? Icons.visibility_off
// // // // // // //                           : Icons.visibility),
// // // // // // //                       onPressed: () {
// // // // // // //                         setState(() {
// // // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // // //                         });
// // // // // // //                       },
// // // // // // //                     ),
// // // // // // //                   ),
// // // // // // //                   obscureText: _obscurePassword,
// // // // // // //                   validator: (value) => value == null || value.length < 6
// // // // // // //                       ? 'Password must be at least 6 characters'
// // // // // // //                       : null,
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 TextFormField(
// // // // // // //                   controller: _confirmPasswordController,
// // // // // // //                   decoration: InputDecoration(
// // // // // // //                     labelText: 'Confirm Password',
// // // // // // //                     suffixIcon: IconButton(
// // // // // // //                       icon: Icon(_obscureConfirmPassword
// // // // // // //                           ? Icons.visibility_off
// // // // // // //                           : Icons.visibility),
// // // // // // //                       onPressed: () {
// // // // // // //                         setState(() {
// // // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // // //                         });
// // // // // // //                       },
// // // // // // //                     ),
// // // // // // //                   ),
// // // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // // //                   validator: (value) => value != _passwordController.text
// // // // // // //                       ? 'Passwords do not match'
// // // // // // //                       : null,
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 DropdownButtonFormField<String>(
// // // // // // //                   value: _selectedAge,
// // // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // // // // //                       .map((age) =>
// // // // // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // // // // //                       .toList(),
// // // // // // //                   onChanged: (value) {
// // // // // // //                     setState(() {
// // // // // // //                       _selectedAge = value;
// // // // // // //                     });
// // // // // // //                   },
// // // // // // //                   validator: (value) =>
// // // // // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 Row(
// // // // // // //                   children: [
// // // // // // //                     Expanded(
// // // // // // //                       child: ListTile(
// // // // // // //                         title: Text('Male'),
// // // // // // //                         leading: Radio<GenderType>(
// // // // // // //                           value: GenderType.male,
// // // // // // //                           groupValue: _selectedGender,
// // // // // // //                           onChanged: (GenderType? value) {
// // // // // // //                             setState(() {
// // // // // // //                               _selectedGender = value;
// // // // // // //                             });
// // // // // // //                           },
// // // // // // //                         ),
// // // // // // //                       ),
// // // // // // //                     ),
// // // // // // //                     Expanded(
// // // // // // //                       child: ListTile(
// // // // // // //                         title: Text('Female'),
// // // // // // //                         leading: Radio<GenderType>(
// // // // // // //                           value: GenderType.female,
// // // // // // //                           groupValue: _selectedGender,
// // // // // // //                           onChanged: (GenderType? value) {
// // // // // // //                             setState(() {
// // // // // // //                               _selectedGender = value;
// // // // // // //                             });
// // // // // // //                           },
// // // // // // //                         ),
// // // // // // //                       ),
// // // // // // //                     ),
// // // // // // //                   ],
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 Row(
// // // // // // //                   children: [
// // // // // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // // // // //                     SizedBox(width: 8),
// // // // // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // // // // //                     SizedBox(width: 8),
// // // // // // //                     Expanded(
// // // // // // //                       child: TextFormField(
// // // // // // //                         controller: _phoneController,
// // // // // // //                         keyboardType: TextInputType.phone,
// // // // // // //                         maxLength: 9,
// // // // // // //                         decoration: InputDecoration(
// // // // // // //                           labelText: 'Phone Number',
// // // // // // //                           counterText: "",
// // // // // // //                         ),
// // // // // // //                         validator: (value) {
// // // // // // //                           if (value == null ||
// // // // // // //                               value.isEmpty ||
// // // // // // //                               value.length != 9 ||
// // // // // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // // // // //                             return 'Enter a valid 9-digit number';
// // // // // // //                           }
// // // // // // //                           return null;
// // // // // // //                         },
// // // // // // //                       ),
// // // // // // //                     ),
// // // // // // //                   ],
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 DropdownButtonFormField<String>(
// // // // // // //                   value: _addressController.text.isEmpty
// // // // // // //                       ? null
// // // // // // //                       : _addressController.text,
// // // // // // //                   decoration: InputDecoration(labelText: 'Street Address'),
// // // // // // //                   items: _tripoliStreets
// // // // // // //                       .map((street) => DropdownMenuItem(
// // // // // // //                             value: street,
// // // // // // //                             child: Text(street),
// // // // // // //                           ))
// // // // // // //                       .toList(),
// // // // // // //                   onChanged: (value) {
// // // // // // //                     setState(() {
// // // // // // //                       _addressController.text = value!;
// // // // // // //                     });
// // // // // // //                   },
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 TextFormField(
// // // // // // //                   controller: _locationController,
// // // // // // //                   decoration: InputDecoration(
// // // // // // //                     labelText: 'Location',
// // // // // // //                     suffixIcon: IconButton(
// // // // // // //                       icon: Icon(Icons.location_on),
// // // // // // //                       onPressed: _getCurrentLocation,
// // // // // // //                     ),
// // // // // // //                   ),
// // // // // // //                   readOnly: true,
// // // // // // //                   validator: (value) => value == null || value.isEmpty
// // // // // // //                       ? 'Select your location'
// // // // // // //                       : null,
// // // // // // //                 ),
// // // // // // //                 SizedBox(height: 16),
// // // // // // //                 // Vendor-specific fields
// // // // // // //                 if (widget.userType == 1) ...[
// // // // // // //                   TextFormField(
// // // // // // //                     controller: _bioController,
// // // // // // //                     decoration: InputDecoration(labelText: 'Bio'),
// // // // // // //                     maxLines: 3,
// // // // // // //                   ),
// // // // // // //                   SizedBox(height: 16),
// // // // // // //                   TextFormField(
// // // // // // //                     controller: _experienceController,
// // // // // // //                     decoration:
// // // // // // //                         InputDecoration(labelText: 'Experience (years)'),
// // // // // // //                     keyboardType: TextInputType.number,
// // // // // // //                   ),
// // // // // // //                   SizedBox(height: 16),
// // // // // // //                   SizedBox(height: 16),
// // // // // // //                   DropdownButtonFormField<Map<String, dynamic>>(
// // // // // // //                     value: _selectedCategory,
// // // // // // //                     decoration: InputDecoration(labelText: 'Category'),
// // // // // // //                     items: _categories.map((category) {
// // // // // // //                       return DropdownMenuItem<Map<String, dynamic>>(
// // // // // // //                         value: category,
// // // // // // //                         child: Text(category['name']),
// // // // // // //                       );
// // // // // // //                     }).toList(),
// // // // // // //                     onChanged: (Map<String, dynamic>? value) {
// // // // // // //                       setState(() {
// // // // // // //                         _selectedCategory = value;
// // // // // // //                       });
// // // // // // //                     },
// // // // // // //                   ),
// // // // // // //                   SizedBox(height: 16),
// // // // // // //                 ],
// // // // // // //                 ElevatedButton(
// // // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // // //                   child:
// // // // // // //                       _isLoading ? CircularProgressIndicator() : Text('Submit'),
// // // // // // //                 ),
// // // // // // //               ],
// // // // // // //             ),
// // // // // // //           ),
// // // // // // //         ),
// // // // // // //       ),
// // // // // // //     );
// // // // // // //   }
// // // // // // // }
// // // // // // import 'dart:convert';
// // // // // // import 'dart:io';
// // // // // // import 'package:flutter/material.dart';
// // // // // // import 'package:http/http.dart' as http;
// // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // import 'package:location/location.dart';
// // // // // // import 'package:flag/flag.dart';

// // // // // // // Define the GenderType enum
// // // // // // enum GenderType { male, female }

// // // // // // // Define the CategoryType enum for Vendor categories
// // // // // // enum CategoryType { salon, education, plumbing, cleaning, other }

// // // // // // class SignUpScreen extends StatefulWidget {
// // // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // // //   @override
// // // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // // }

// // // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // //   final _nameController = TextEditingController();
// // // // // //   final _emailController = TextEditingController();
// // // // // //   final _passwordController = TextEditingController();
// // // // // //   final _confirmPasswordController = TextEditingController();
// // // // // //   final _addressController = TextEditingController();
// // // // // //   final _phoneController = TextEditingController();
// // // // // //   final _locationController = TextEditingController();

// // // // // //   // For Vendor-specific fields
// // // // // //   final _bioController = TextEditingController();
// // // // // //   final _experienceController = TextEditingController();
// // // // // //   List<Map<String, dynamic>> _categories = []; // Categories fetched from API
// // // // // //   Map<String, dynamic>? _selectedCategory; // To store the selected category

// // // // // //   File? _avatarImage;
// // // // // //   bool _isLoading = false;
// // // // // //   bool _obscurePassword = true;
// // // // // //   bool _obscureConfirmPassword = true;
// // // // // //   String? _selectedAge;
// // // // // //   GenderType? _selectedGender;
// // // // // //   final List<String> _tripoliStreets = [
// // // // // //     "Martyrs' Square",
// // // // // //     "Al-Mansoura",
// // // // // //     "Gargaresh",
// // // // // //     "Hai Al-Andalus",
// // // // // //     "Ben Ashur",
// // // // // //     "Garden City",
// // // // // //     "Abu Salim",
// // // // // //     "Souk Al-Juma",
// // // // // //     "Janzour"
// // // // // //   ];

// // // // // //   // Location Service
// // // // // //   Location _location = Location();

// // // // // //   // Method to get current location
// // // // // //   Future<void> _getCurrentLocation() async {
// // // // // //     try {
// // // // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // // // //       if (!_serviceEnabled) {
// // // // // //         _serviceEnabled = await _location.requestService();
// // // // // //         if (!_serviceEnabled) {
// // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // //             SnackBar(content: Text("Location service is not enabled")),
// // // // // //           );
// // // // // //           return;
// // // // // //         }
// // // // // //       }

// // // // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // // // //         _permissionGranted = await _location.requestPermission();
// // // // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // //             SnackBar(content: Text("Location permission denied")),
// // // // // //           );
// // // // // //           return;
// // // // // //         }
// // // // // //       }

// // // // // //       LocationData _currentLocation = await _location.getLocation();
// // // // // //       setState(() {
// // // // // //         _locationController.text =
// // // // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // // // //       });
// // // // // //     } catch (e) {
// // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // //         SnackBar(content: Text("Error getting location: $e")),
// // // // // //       );
// // // // // //     }
// // // // // //   }

// // // // // //   Future<void> _pickImage() async {
// // // // // //     final pickedFile =
// // // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // // //     if (pickedFile != null) {
// // // // // //       setState(() {
// // // // // //         _avatarImage = File(pickedFile.path);
// // // // // //       });
// // // // // //     }
// // // // // //   }

// // // // // //   void _fetchCategories() async {
// // // // // //     try {
// // // // // //       final response =
// // // // // //           await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
// // // // // //       print(response.statusCode); // Log the response status code
// // // // // //       if (response.statusCode == 200 || response.statusCode == 201) {
// // // // // //         final List<dynamic> data = jsonDecode(response.body);
// // // // // //         setState(() {
// // // // // //           _categories = data.map((item) {
// // // // // //             return {
// // // // // //               'id': item['id'],
// // // // // //               'name': item['name'],
// // // // // //             };
// // // // // //           }).toList();
// // // // // //           if (_categories.isNotEmpty) {
// // // // // //             _selectedCategory =
// // // // // //                 _categories[0]; // Set the first category as the default
// // // // // //           }
// // // // // //         });
// // // // // //       } else {
// // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // //           SnackBar(content: Text("Failed to fetch categories")),
// // // // // //         );
// // // // // //       }
// // // // // //     } catch (e) {
// // // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // //         SnackBar(content: Text("Error fetching categories: $e")),
// // // // // //       );
// // // // // //     }
// // // // // //   }

// // // // // //   void submitForm() async {
// // // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // // //       setState(() {
// // // // // //         _isLoading = true;
// // // // // //       });

// // // // // //       final Map<String, dynamic> formData = {
// // // // // //         'userName': _nameController.text,
// // // // // //         'email': _emailController.text,
// // // // // //         'password': _passwordController.text,
// // // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // // //         'userAddress': _addressController.text,
// // // // // //         'phone': _phoneController.text,
// // // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // // //         'gender': _selectedGender == GenderType.male ? 1 : 0,
// // // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // // //         'image': _avatarImage != null
// // // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // // //             : null,
// // // // // //         'location': _locationController.text,
// // // // // //       };

// // // // // //       if (widget.userType == 1) {
// // // // // //         // Vendor-specific fields
// // // // // //         formData['bio'] = _bioController.text;
// // // // // //         formData['experience'] = int.tryParse(_experienceController.text);
// // // // // //         formData['categoryId'] = _selectedCategory != null ? _selectedCategory!['id'] : null;
// // // // // //       }

// // // // // //       try {
// // // // // //         final response = await http.post(
// // // // // //           Uri.parse('https://192.168.0.109:7127/api/user'),
// // // // // //           headers: {
// // // // // //             'Content-Type': 'application/json',
// // // // // //           },
// // // // // //           body: jsonEncode(formData),
// // // // // //         );

// // // // // //         if (response.statusCode == 201) {
// // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // // //           );
// // // // // //           Navigator.pop(context);
// // // // // //         } else {
// // // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // // //           );
// // // // // //         }
// // // // // //       } catch (e) {
// // // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // // //           SnackBar(content: Text("Network error: $e")),
// // // // // //         );
// // // // // //       } finally {
// // // // // //         setState(() {
// // // // // //           _isLoading = false;
// // // // // //         });
// // // // // //       }
// // // // // //     }
// // // // // //   }

// // // // // //   @override
// // // // // //   Widget build(BuildContext context) {
// // // // // //     return Scaffold(
// // // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // // //       body: Padding(
// // // // // //         padding: const EdgeInsets.all(16.0),
// // // // // //         child: Form(
// // // // // //           key: _formKey,
// // // // // //           child: SingleChildScrollView(
// // // // // //             child: Column(
// // // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // // //               children: [
// // // // // //                 GestureDetector(
// // // // // //                   onTap: _pickImage,
// // // // // //                   child: CircleAvatar(
// // // // // //                     radius: 100,
// // // // // //                     backgroundImage:
// // // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // // //                     child: _avatarImage == null
// // // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // // //                         : null,
// // // // // //                   ),
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 TextFormField(
// // // // // //                   controller: _nameController,
// // // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // // //                   validator: (value) =>
// // // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 TextFormField(
// // // // // //                   controller: _emailController,
// // // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // // //                       ? 'Enter a valid email'
// // // // // //                       : null,
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 TextFormField(
// // // // // //                   controller: _passwordController,
// // // // // //                   decoration: InputDecoration(
// // // // // //                     labelText: 'Password',
// // // // // //                     suffixIcon: IconButton(
// // // // // //                       icon: Icon(_obscurePassword
// // // // // //                           ? Icons.visibility_off
// // // // // //                           : Icons.visibility),
// // // // // //                       onPressed: () {
// // // // // //                         setState(() {
// // // // // //                           _obscurePassword = !_obscurePassword;
// // // // // //                         });
// // // // // //                       },
// // // // // //                     ),
// // // // // //                   ),
// // // // // //                   obscureText: _obscurePassword,
// // // // // //                   validator: (value) => value == null || value.length < 6
// // // // // //                       ? 'Password must be at least 6 characters'
// // // // // //                       : null,
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 TextFormField(
// // // // // //                   controller: _confirmPasswordController,
// // // // // //                   decoration: InputDecoration(
// // // // // //                     labelText: 'Confirm Password',
// // // // // //                     suffixIcon: IconButton(
// // // // // //                       icon: Icon(_obscureConfirmPassword
// // // // // //                           ? Icons.visibility_off
// // // // // //                           : Icons.visibility),
// // // // // //                       onPressed: () {
// // // // // //                         setState(() {
// // // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // // //                         });
// // // // // //                       },
// // // // // //                     ),
// // // // // //                   ),
// // // // // //                   obscureText: _obscureConfirmPassword,
// // // // // //                   validator: (value) => value != _passwordController.text
// // // // // //                       ? 'Passwords do not match'
// // // // // //                       : null,
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 DropdownButtonFormField<String>( 
// // // // // //                   value: _selectedAge,
// // // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // // // //                       .map((age) =>
// // // // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // // // //                       .toList(),
// // // // // //                   onChanged: (value) {
// // // // // //                     setState(() {
// // // // // //                       _selectedAge = value;
// // // // // //                     });
// // // // // //                   },
// // // // // //                   validator: (value) =>
// // // // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 Row(
// // // // // //                   children: [
// // // // // //                     Expanded(
// // // // // //                       child: ListTile(
// // // // // //                         title: Text('Male'),
// // // // // //                         leading: Radio<GenderType>( 
// // // // // //                           value: GenderType.male,
// // // // // //                           groupValue: _selectedGender,
// // // // // //                           onChanged: (GenderType? value) {
// // // // // //                             setState(() {
// // // // // //                               _selectedGender = value;
// // // // // //                             });
// // // // // //                           },
// // // // // //                         ),
// // // // // //                       ),
// // // // // //                     ),
// // // // // //                     Expanded(
// // // // // //                       child: ListTile(
// // // // // //                         title: Text('Female'),
// // // // // //                         leading: Radio<GenderType>(
// // // // // //                           value: GenderType.female,
// // // // // //                           groupValue: _selectedGender,
// // // // // //                           onChanged: (GenderType? value) {
// // // // // //                             setState(() {
// // // // // //                               _selectedGender = value;
// // // // // //                             });
// // // // // //                           },
// // // // // //                         ),
// // // // // //                       ),
// // // // // //                     ),
// // // // // //                   ],
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 Row(
// // // // // //                   children: [
// // // // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // // // //                     SizedBox(width: 8),
// // // // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // // // //                     SizedBox(width: 8),
// // // // // //                     Expanded(
// // // // // //                       child: TextFormField(
// // // // // //                         controller: _phoneController,
// // // // // //                         keyboardType: TextInputType.phone,
// // // // // //                         maxLength: 9,
// // // // // //                         decoration: InputDecoration(
// // // // // //                           labelText: 'Phone Number',
// // // // // //                           counterText: "",
// // // // // //                         ),
// // // // // //                         validator: (value) {
// // // // // //                           if (value == null ||
// // // // // //                               value.isEmpty ||
// // // // // //                               value.length != 9 ||
// // // // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // // // //                             return 'Enter a valid 9-digit number';
// // // // // //                           }
// // // // // //                           return null;
// // // // // //                         },
// // // // // //                       ),
// // // // // //                     ),
// // // // // //                   ],
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 DropdownButtonFormField<String>(
// // // // // //                   value: _addressController.text.isEmpty
// // // // // //                       ? null
// // // // // //                       : _addressController.text,
// // // // // //                   onChanged: (value) {
// // // // // //                     setState(() {
// // // // // //                       _addressController.text = value!;
// // // // // //                     });
// // // // // //                   },
// // // // // //                   items: _tripoliStreets
// // // // // //                       .map<DropdownMenuItem<String>>(
// // // // // //                         (street) => DropdownMenuItem<String>(
// // // // // //                           value: street,
// // // // // //                           child: Text(street),
// // // // // //                         ),
// // // // // //                       )
// // // // // //                       .toList(),
// // // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // // //                 ),
// // // // // //                 SizedBox(height: 16),
// // // // // //                 widget.userType == 1
// // // // // //                     ? Column(
// // // // // //                         children: [
// // // // // //                           TextFormField(
// // // // // //                             controller: _bioController,
// // // // // //                             decoration: InputDecoration(labelText: 'Bio'),
// // // // // //                           ),
// // // // // //                           SizedBox(height: 16),
// // // // // //                           TextFormField(
// // // // // //                             controller: _experienceController,
// // // // // //                             decoration: InputDecoration(
// // // // // //                                 labelText: 'Experience (years)'),
// // // // // //                           ),
// // // // // //                           SizedBox(height: 16),
// // // // // //                           Text('Category'),
// // // // // //                           // Display categories dropdown for Vendor
// // // // // //                           DropdownButtonFormField<Map<String, dynamic>>(
// // // // // //                             value: _selectedCategory,
// // // // // //                             onChanged: (newValue) {
// // // // // //                               setState(() {
// // // // // //                                 _selectedCategory = newValue!;
// // // // // //                               });
// // // // // //                             },
// // // // // //                             items: _categories
// // // // // //                                 .map((category) => DropdownMenuItem(
// // // // // //                                       value: category,
// // // // // //                                       child: Text(category['name']),
// // // // // //                                     ))
// // // // // //                                 .toList(),
// // // // // //                             decoration:
// // // // // //                                 InputDecoration(labelText: 'Select Category'),
// // // // // //                           ),
// // // // // //                         ],
// // // // // //                       )
// // // // // //                     : SizedBox.shrink(), 
// // // // // //                 SizedBox(height: 16),
// // // // // //                 ElevatedButton(
// // // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // // //                   child: _isLoading
// // // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // // //                       : Text('Sign Up'),
// // // // // //                 ),
// // // // // //               ],
// // // // // //             ),
// // // // // //           ),
// // // // // //         ),
// // // // // //       ),
// // // // // //     );
// // // // // //   }
// // // // // // }
// // // // // import 'dart:convert';
// // // // // import 'dart:io';
// // // // // import 'package:flutter/material.dart';
// // // // // import 'package:http/http.dart' as http;
// // // // // import 'package:image_picker/image_picker.dart';
// // // // // import 'package:location/location.dart';
// // // // // import 'package:flag/flag.dart';

// // // // // // Define the GenderType enum
// // // // // enum GenderType { male, female }

// // // // // class SignUpScreen extends StatefulWidget {
// // // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // // //   @override
// // // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // // }

// // // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // // //   final _formKey = GlobalKey<FormState>();
// // // // //   final _nameController = TextEditingController();
// // // // //   final _emailController = TextEditingController();
// // // // //   final _passwordController = TextEditingController();
// // // // //   final _confirmPasswordController = TextEditingController();
// // // // //   final _addressController = TextEditingController();
// // // // //   final _phoneController = TextEditingController();
// // // // //   final _locationController = TextEditingController();

// // // // //   // For Vendor-specific fields
// // // // //   final _bioController = TextEditingController();
// // // // //   final _experienceController = TextEditingController();
// // // // //   List<Map<String, dynamic>> _categories = []; // Categories fetched from API
// // // // //   Map<String, dynamic>? _selectedCategory; // To store the selected category

// // // // //   File? _avatarImage;
// // // // //   bool _isLoading = false;
// // // // //   bool _obscurePassword = true;
// // // // //   bool _obscureConfirmPassword = true;
// // // // //   String? _selectedAge;
// // // // //   GenderType? _selectedGender;
// // // // //   final List<String> _tripoliStreets = [
// // // // //     "Martyrs' Square",
// // // // //     "Al-Mansoura",
// // // // //     "Gargaresh",
// // // // //     "Hai Al-Andalus",
// // // // //     "Ben Ashur",
// // // // //     "Garden City",
// // // // //     "Abu Salim",
// // // // //     "Souk Al-Juma",
// // // // //     "Janzour"
// // // // //   ];

// // // // //   // Location Service
// // // // //   Location _location = Location();

// // // // //   @override
// // // // //   void initState() {
// // // // //     super.initState();
// // // // //     _fetchCategories();
// // // // //   }

// // // // //   // Method to get current location
// // // // //   Future<void> _getCurrentLocation() async {
// // // // //     try {
// // // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // // //       if (!_serviceEnabled) {
// // // // //         _serviceEnabled = await _location.requestService();
// // // // //         if (!_serviceEnabled) {
// // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // //             SnackBar(content: Text("Location service is not enabled")),
// // // // //           );
// // // // //           return;
// // // // //         }
// // // // //       }

// // // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // // //         _permissionGranted = await _location.requestPermission();
// // // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // //             SnackBar(content: Text("Location permission denied")),
// // // // //           );
// // // // //           return;
// // // // //         }
// // // // //       }

// // // // //       LocationData _currentLocation = await _location.getLocation();
// // // // //       setState(() {
// // // // //         _locationController.text =
// // // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // // //       });
// // // // //     } catch (e) {
// // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // //         SnackBar(content: Text("Error getting location: $e")),
// // // // //       );
// // // // //     }
// // // // //   }

// // // // //   Future<void> _pickImage() async {
// // // // //     final pickedFile =
// // // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // // //     if (pickedFile != null) {
// // // // //       setState(() {
// // // // //         _avatarImage = File(pickedFile.path);
// // // // //       });
// // // // //     }
// // // // //   }

// // // // //   void _fetchCategories() async {
// // // // //     try {
// // // // //       final response =
// // // // //           await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
// // // // //       print(response.statusCode); // Log the response status code
// // // // //       if (response.statusCode == 200 || response.statusCode == 201) {
// // // // //         final List<dynamic> data = jsonDecode(response.body);
// // // // //         setState(() {
// // // // //           _categories = data.map((item) {
// // // // //             return {
// // // // //               'id': item['id'],
// // // // //               'name': item['name'],
// // // // //             };
// // // // //           }).toList();
// // // // //           if (_categories.isNotEmpty) {
// // // // //             _selectedCategory =
// // // // //                 _categories[0]; // Set the first category as the default
// // // // //           }
// // // // //         });
// // // // //       } else {
// // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // //           SnackBar(content: Text("Failed to fetch categories")),
// // // // //         );
// // // // //       }
// // // // //     } catch (e) {
// // // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // // //         SnackBar(content: Text("Error fetching categories: $e")),
// // // // //       );
// // // // //     }
// // // // //   }

// // // // //   void submitForm() async {
// // // // //     if (_formKey.currentState?.validate() ?? false) {
// // // // //       setState(() {
// // // // //         _isLoading = true;
// // // // //       });

// // // // //       final Map<String, dynamic> formData = {
// // // // //         'userName': _nameController.text,
// // // // //         'email': _emailController.text,
// // // // //         'password': _passwordController.text,
// // // // //         'confirmPassword': _confirmPasswordController.text,
// // // // //         'userAddress': _addressController.text,
// // // // //         'phone': _phoneController.text,
// // // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // // //         'gender': _selectedGender == GenderType.male ? 1 : 0,
// // // // //         'type': widget.userType == 0 ? 0 : 1,
// // // // //         'image': _avatarImage != null
// // // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // // //             : null,
// // // // //         'location': _locationController.text,
// // // // //       };

// // // // //       if (widget.userType == 1) {
// // // // //         // Vendor-specific fields
// // // // //         formData['bio'] = _bioController.text;
// // // // //         formData['experience'] = int.tryParse(_experienceController.text);
// // // // //         formData['categoryId'] = _selectedCategory != null ? _selectedCategory!['id'] : null;
// // // // //       }

// // // // //       try {
// // // // //         final response = await http.post(
// // // // //           Uri.parse('https://192.168.0.109:7127/api/user'),
// // // // //           headers: {
// // // // //             'Content-Type': 'application/json',
// // // // //           },
// // // // //           body: jsonEncode(formData),
// // // // //         );

// // // // //         if (response.statusCode == 201) {
// // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // //             SnackBar(content: Text("Account created successfully!")),
// // // // //           );
// // // // //           Navigator.pop(context);
// // // // //         } else {
// // // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // // //           );
// // // // //         }
// // // // //       } catch (e) {
// // // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // // //           SnackBar(content: Text("Network error: $e")),
// // // // //         );
// // // // //       } finally {
// // // // //         setState(() {
// // // // //           _isLoading = false;
// // // // //         });
// // // // //       }
// // // // //     }
// // // // //   }

// // // // //   @override
// // // // //   Widget build(BuildContext context) {
// // // // //     return Scaffold(
// // // // //       appBar: AppBar(title: Text('Sign Up')),
// // // // //       body: Padding(
// // // // //         padding: const EdgeInsets.all(16.0),
// // // // //         child: Form(
// // // // //           key: _formKey,
// // // // //           child: SingleChildScrollView(
// // // // //             child: Column(
// // // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // // //               children: [
// // // // //                 GestureDetector(
// // // // //                   onTap: _pickImage,
// // // // //                   child: CircleAvatar(
// // // // //                     radius: 100,
// // // // //                     backgroundImage:
// // // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // // //                     child: _avatarImage == null
// // // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // // //                         : null,
// // // // //                   ),
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 TextFormField(
// // // // //                   controller: _nameController,
// // // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // // //                   validator: (value) =>
// // // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 TextFormField(
// // // // //                   controller: _emailController,
// // // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // // //                   validator: (value) => value == null || !value.contains('@')
// // // // //                       ? 'Enter a valid email'
// // // // //                       : null,
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 TextFormField(
// // // // //                   controller: _passwordController,
// // // // //                   decoration: InputDecoration(
// // // // //                     labelText: 'Password',
// // // // //                     suffixIcon: IconButton(
// // // // //                       icon: Icon(_obscurePassword
// // // // //                           ? Icons.visibility_off
// // // // //                           : Icons.visibility),
// // // // //                       onPressed: () {
// // // // //                         setState(() {
// // // // //                           _obscurePassword = !_obscurePassword;
// // // // //                         });
// // // // //                       },
// // // // //                     ),
// // // // //                   ),
// // // // //                   obscureText: _obscurePassword,
// // // // //                   validator: (value) => value == null || value.length < 6
// // // // //                       ? 'Password must be at least 6 characters'
// // // // //                       : null,
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 TextFormField(
// // // // //                   controller: _confirmPasswordController,
// // // // //                   decoration: InputDecoration(
// // // // //                     labelText: 'Confirm Password',
// // // // //                     suffixIcon: IconButton(
// // // // //                       icon: Icon(_obscureConfirmPassword
// // // // //                           ? Icons.visibility_off
// // // // //                           : Icons.visibility),
// // // // //                       onPressed: () {
// // // // //                         setState(() {
// // // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // // //                         });
// // // // //                       },
// // // // //                     ),
// // // // //                   ),
// // // // //                   obscureText: _obscureConfirmPassword,
// // // // //                   validator: (value) => value != _passwordController.text
// // // // //                       ? 'Passwords do not match'
// // // // //                       : null,
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 DropdownButtonFormField<String>( 
// // // // //                   value: _selectedAge,
// // // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // // //                       .map((age) =>
// // // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // // //                       .toList(),
// // // // //                   onChanged: (value) {
// // // // //                     setState(() {
// // // // //                       _selectedAge = value;
// // // // //                     });
// // // // //                   },
// // // // //                   validator: (value) =>
// // // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 Row(
// // // // //                   children: [
// // // // //                     Expanded(
// // // // //                       child: ListTile(
// // // // //                         title: Text('Male'),
// // // // //                         leading: Radio<GenderType>( 
// // // // //                           value: GenderType.male,
// // // // //                           groupValue: _selectedGender,
// // // // //                           onChanged: (GenderType? value) {
// // // // //                             setState(() {
// // // // //                               _selectedGender = value;
// // // // //                             });
// // // // //                           },
// // // // //                         ),
// // // // //                       ),
// // // // //                     ),
// // // // //                     Expanded(
// // // // //                       child: ListTile(
// // // // //                         title: Text('Female'),
// // // // //                         leading: Radio<GenderType>(
// // // // //                           value: GenderType.female,
// // // // //                           groupValue: _selectedGender,
// // // // //                           onChanged: (GenderType? value) {
// // // // //                             setState(() {
// // // // //                               _selectedGender = value;
// // // // //                             });
// // // // //                           },
// // // // //                         ),
// // // // //                       ),
// // // // //                     ),
// // // // //                   ],
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 Row(
// // // // //                   children: [
// // // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // // //                     SizedBox(width: 8),
// // // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // // //                     SizedBox(width: 8),
// // // // //                     Expanded(
// // // // //                       child: TextFormField(
// // // // //                         controller: _phoneController,
// // // // //                         keyboardType: TextInputType.phone,
// // // // //                         maxLength: 9,
// // // // //                         decoration: InputDecoration(
// // // // //                           labelText: 'Phone Number',
// // // // //                           counterText: "",
// // // // //                         ),
// // // // //                         validator: (value) {
// // // // //                           if (value == null ||
// // // // //                               value.isEmpty ||
// // // // //                               value.length != 9 ||
// // // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // // //                             return 'Enter a valid 9-digit number';
// // // // //                           }
// // // // //                           return null;
// // // // //                         },
// // // // //                       ),
// // // // //                     ),
// // // // //                   ],
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 DropdownButtonFormField<String>(
// // // // //                   value: _addressController.text.isEmpty
// // // // //                       ? null
// // // // //                       : _addressController.text,
// // // // //                   onChanged: (value) {
// // // // //                     setState(() {
// // // // //                       _addressController.text = value!;
// // // // //                     });
// // // // //                   },
// // // // //                   items: _tripoliStreets
// // // // //                       .map<DropdownMenuItem<String>>(
// // // // //                         (street) => DropdownMenuItem<String>(
// // // // //                           value: street,
// // // // //                           child: Text(street),
// // // // //                         ),
// // // // //                       )
// // // // //                       .toList(),
// // // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // // //                 ),
// // // // //                 SizedBox(height: 16),
// // // // //                 widget.userType == 1
// // // // //                     ? Column(
// // // // //                         children: [
// // // // //                           TextFormField(
// // // // //                             controller: _bioController,
// // // // //                             decoration: InputDecoration(labelText: 'Bio'),
// // // // //                           ),
// // // // //                           SizedBox(height: 16),
// // // // //                           TextFormField(
// // // // //                             controller: _experienceController,
// // // // //                             decoration: InputDecoration(
// // // // //                                 labelText: 'Experience (years)'),
// // // // //                           ),
// // // // //                           SizedBox(height: 16),
                         
// // // // //                           // Display categories dropdown for Vendor
// // // // //                           DropdownButtonFormField<Map<String, dynamic>>(
// // // // //                             value: _selectedCategory,
// // // // //                             onChanged: (newValue) {
// // // // //                               setState(() {
// // // // //                                 _selectedCategory = newValue!;
// // // // //                               });
// // // // //                             },
// // // // //                             items: _categories
// // // // //                                 .map((category) => DropdownMenuItem(
// // // // //                                       value: category,
// // // // //                                       child: Text(category['name']),
// // // // //                                     ))
// // // // //                                 .toList(),
// // // // //                             decoration:
// // // // //                                 InputDecoration(labelText: 'Select Category'),
// // // // //                           ),
// // // // //                         ],
// // // // //                       )
// // // // //                     : SizedBox.shrink(), 
// // // // //                 SizedBox(height: 16),
// // // // //                 ElevatedButton(
// // // // //                   onPressed: _isLoading ? null : submitForm,
// // // // //                   child: _isLoading
// // // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // // //                       : Text('Sign Up'),
// // // // //                 ),
// // // // //               ],
// // // // //             ),
// // // // //           ),
// // // // //         ),
// // // // //       ),
// // // // //     );
// // // // //   }
// // // // // }


// // // // import 'dart:convert';
// // // // import 'dart:io';
// // // // import 'package:flutter/material.dart';
// // // // import 'package:http/http.dart' as http;
// // // // import 'package:image_picker/image_picker.dart';
// // // // import 'package:location/location.dart';
// // // // import 'package:flag/flag.dart';

// // // // // Define the GenderType enum
// // // // enum GenderType { male, female }

// // // // class SignUpScreen extends StatefulWidget {
// // // //   final int userType; // 0 for Customer, 1 for Vendor
// // // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // // //   @override
// // // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // // }

// // // // class _SignUpScreenState extends State<SignUpScreen> {
// // // //   final _formKey = GlobalKey<FormState>();
// // // //   final _nameController = TextEditingController();
// // // //   final _emailController = TextEditingController();
// // // //   final _passwordController = TextEditingController();
// // // //   final _confirmPasswordController = TextEditingController();
// // // //   final _addressController = TextEditingController();
// // // //   final _phoneController = TextEditingController();
// // // //   final _locationController = TextEditingController();

// // // //   // For Vendor-specific fields
// // // //   final _bioController = TextEditingController();
// // // //   final _experienceController = TextEditingController();
// // // //   List<Map<String, dynamic>> _categories = []; // Categories fetched from API
// // // //   Map<String, dynamic>? _selectedCategory; // To store the selected category

// // // //   File? _avatarImage;
// // // //   bool _isLoading = false;
// // // //   bool _obscurePassword = true;
// // // //   bool _obscureConfirmPassword = true;
// // // //   String? _selectedAge;
// // // //   GenderType? _selectedGender;
// // // //   final List<String> _tripoliStreets = [
// // // //     "Martyrs' Square",
// // // //     "Al-Mansoura",
// // // //     "Gargaresh",
// // // //     "Hai Al-Andalus",
// // // //     "Ben Ashur",
// // // //     "Garden City",
// // // //     "Abu Salim",
// // // //     "Souk Al-Juma",
// // // //     "Janzour"
// // // //   ];

// // // //   // Location Service
// // // //   Location _location = Location();

// // // //   @override
// // // //   void initState() {
// // // //     super.initState();
// // // //     _fetchCategories();
// // // //   }

// // // //   // Method to get current location
// // // //   Future<void> _getCurrentLocation() async {
// // // //     try {
// // // //       bool _serviceEnabled = await _location.serviceEnabled();
// // // //       if (!_serviceEnabled) {
// // // //         _serviceEnabled = await _location.requestService();
// // // //         if (!_serviceEnabled) {
// // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // //             SnackBar(content: Text("Location service is not enabled")),
// // // //           );
// // // //           return;
// // // //         }
// // // //       }

// // // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // // //       if (_permissionGranted == PermissionStatus.denied) {
// // // //         _permissionGranted = await _location.requestPermission();
// // // //         if (_permissionGranted != PermissionStatus.granted) {
// // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // //             SnackBar(content: Text("Location permission denied")),
// // // //           );
// // // //           return;
// // // //         }
// // // //       }

// // // //       LocationData _currentLocation = await _location.getLocation();
// // // //       setState(() {
// // // //         _locationController.text =
// // // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // // //       });
// // // //     } catch (e) {
// // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // //         SnackBar(content: Text("Error getting location: $e")),
// // // //       );
// // // //     }
// // // //   }

// // // //   Future<void> _pickImage() async {
// // // //     final pickedFile =
// // // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // // //     if (pickedFile != null) {
// // // //       setState(() {
// // // //         _avatarImage = File(pickedFile.path);
// // // //       });
// // // //     }
// // // //   }

// // // //   void _fetchCategories() async {
// // // //     try {
// // // //       final response =
// // // //           await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
// // // //       print(response.statusCode); // Log the response status code
// // // //       if (response.statusCode == 200 || response.statusCode == 201) {
// // // //         final List<dynamic> data = jsonDecode(response.body);
// // // //         setState(() {
// // // //           _categories = data.map((item) {
// // // //             return {
// // // //               'id': item['id'],
// // // //               'name': item['name'],
// // // //             };
// // // //           }).toList();
// // // //           if (_categories.isNotEmpty) {
// // // //             _selectedCategory =
// // // //                 _categories[0]; // Set the first category as the default
// // // //           }
// // // //         });
// // // //       } else {
// // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // //           SnackBar(content: Text("Failed to fetch categories")),
// // // //         );
// // // //       }
// // // //     } catch (e) {
// // // //       ScaffoldMessenger.of(context).showSnackBar(
// // // //         SnackBar(content: Text("Error fetching categories: $e")),
// // // //       );
// // // //     }
// // // //   }

// // // //   Future<void> submitForm() async {
// // // //     if (_formKey.currentState?.validate() ?? false) {
// // // //       setState(() {
// // // //         _isLoading = true;
// // // //       });

// // // //       final Map<String, dynamic> userData = {
// // // //         'userName': _nameController.text,
// // // //         'email': _emailController.text,
// // // //         'password': _passwordController.text,
// // // //         'confirmPassword': _confirmPasswordController.text,
// // // //         'userAddress': _addressController.text,
// // // //         'phone': _phoneController.text,
// // // //         'age': int.tryParse(_selectedAge ?? '0'),
// // // //         'gender': _selectedGender == GenderType.male ? 1 : 0,
// // // //         'type': widget.userType == 0 ? 0 : 1,
// // // //         'image': _avatarImage != null
// // // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // // //             : null,
// // // //         'location': _locationController.text,
// // // //       };

// // // //       try {
// // // //         final response = await http.post(
// // // //           Uri.parse('https://192.168.0.109:7127/api/user'),
// // // //           headers: {
// // // //             'Content-Type': 'application/json',
// // // //           },
// // // //           body: jsonEncode(userData),
// // // //         );

// // // //         if (response.statusCode == 201||response.statusCode == 200) {
// // // //           final newUser = jsonDecode(response.body);

// // // //           if (widget.userType == 1) {
// // // //             final Map<String, dynamic> vendorData = {
// // // //               'userId': newUser['id'],
// // // //               'categoryId': _selectedCategory != null
// // // //                   ? _selectedCategory!['id']
// // // //                   : null,
// // // //               'bio': _bioController.text,
// // // //               'experience': int.tryParse(_experienceController.text),
// // // //             };

// // // //             final vendorResponse = await http.post(
// // // //               Uri.parse('https://192.168.0.109:7127/api/VenderProfile'),
// // // //               headers: {
// // // //                 'Content-Type': 'application/json',
// // // //               },
// // // //               body: jsonEncode(vendorData),
// // // //             );

// // // //             if (vendorResponse.statusCode == 201||vendorResponse.statusCode == 200) {
// // // //               ScaffoldMessenger.of(context).showSnackBar(
// // // //                 SnackBar(content: Text("Account created successfully!")),
// // // //               );
// // // //               Navigator.pop(context);
// // // //             } else {
// // // //               ScaffoldMessenger.of(context).showSnackBar(
// // // //                 SnackBar(content: Text("Error: ${vendorResponse.body}")),
// // // //               );
// // // //             }
// // // //           } else {
// // // //             ScaffoldMessenger.of(context).showSnackBar(
// // // //               SnackBar(content: Text("Account created successfully!")),
// // // //             );
// // // //             Navigator.pop(context);
// // // //           }
// // // //         } else {
// // // //           ScaffoldMessenger.of(context).showSnackBar(
// // // //             SnackBar(content: Text("Error: ${response.body}")),
// // // //           );
// // // //         }
// // // //       } catch (e) {
// // // //         ScaffoldMessenger.of(context).showSnackBar(
// // // //           SnackBar(content: Text("Network error: $e")),
// // // //         );
// // // //       } finally {
// // // //         setState(() {
// // // //           _isLoading = false;
// // // //         });
// // // //       }
// // // //     }
// // // //   }

// // // //   @override
// // // //   Widget build(BuildContext context) {
// // // //     return Scaffold(
// // // //       appBar: AppBar(title: Text('Sign Up')),
// // // //       body: Padding(
// // // //         padding: const EdgeInsets.all(16.0),
// // // //         child: Form(
// // // //           key: _formKey,
// // // //           child: SingleChildScrollView(
// // // //             child: Column(
// // // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // // //               children: [
// // // //                 GestureDetector(
// // // //                   onTap: _pickImage,
// // // //                   child: CircleAvatar(
// // // //                     radius: 100,
// // // //                     backgroundImage:
// // // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // // //                     child: _avatarImage == null
// // // //                         ? Icon(Icons.camera_alt, size: 70)
// // // //                         : null,
// // // //                   ),
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 TextFormField(
// // // //                   controller: _nameController,
// // // //                   decoration: InputDecoration(labelText: 'Name'),
// // // //                   validator: (value) =>
// // // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 TextFormField(
// // // //                   controller: _emailController,
// // // //                   decoration: InputDecoration(labelText: 'Email'),
// // // //                   validator: (value) => value == null || !value.contains('@')
// // // //                       ? 'Enter a valid email'
// // // //                       : null,
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 TextFormField(
// // // //                   controller: _passwordController,
// // // //                   decoration: InputDecoration(
// // // //                     labelText: 'Password',
// // // //                     suffixIcon: IconButton(
// // // //                       icon: Icon(_obscurePassword
// // // //                           ? Icons.visibility_off
// // // //                           : Icons.visibility),
// // // //                       onPressed: () {
// // // //                         setState(() {
// // // //                           _obscurePassword = !_obscurePassword;
// // // //                         });
// // // //                       },
// // // //                     ),
// // // //                   ),
// // // //                   obscureText: _obscurePassword,
// // // //                   validator: (value) => value == null || value.length < 6
// // // //                       ? 'Password must be at least 6 characters'
// // // //                       : null,
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 TextFormField(
// // // //                   controller: _confirmPasswordController,
// // // //                   decoration: InputDecoration(
// // // //                     labelText: 'Confirm Password',
// // // //                     suffixIcon: IconButton(
// // // //                       icon: Icon(_obscureConfirmPassword
// // // //                           ? Icons.visibility_off
// // // //                           : Icons.visibility),
// // // //                       onPressed: () {
// // // //                         setState(() {
// // // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // // //                         });
// // // //                       },
// // // //                     ),
// // // //                   ),
// // // //                   obscureText: _obscureConfirmPassword,
// // // //                   validator: (value) => value != _passwordController.text
// // // //                       ? 'Passwords do not match'
// // // //                       : null,
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 DropdownButtonFormField<String>(
// // // //                   value: _selectedAge,
// // // //                   decoration: InputDecoration(labelText: 'Age'),
// // // //                   items: List.generate(100, (index) => (index + 1).toString())
// // // //                       .map((age) =>
// // // //                           DropdownMenuItem(value: age, child: Text(age)))
// // // //                       .toList(),
// // // //                   onChanged: (value) {
// // // //                     setState(() {
// // // //                       _selectedAge = value;
// // // //                     });
// // // //                   },
// // // //                   validator: (value) =>
// // // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 Row(
// // // //                   children: [
// // // //                     Expanded(
// // // //                       child: ListTile(
// // // //                         title: Text('Male'),
// // // //                         leading: Radio<GenderType>(
// // // //                           value: GenderType.male,
// // // //                           groupValue: _selectedGender,
// // // //                           onChanged: (GenderType? value) {
// // // //                             setState(() {
// // // //                               _selectedGender = value;
// // // //                             });
// // // //                           },
// // // //                         ),
// // // //                       ),
// // // //                     ),
// // // //                     Expanded(
// // // //                       child: ListTile(
// // // //                         title: Text('Female'),
// // // //                         leading: Radio<GenderType>(
// // // //                           value: GenderType.female,
// // // //                           groupValue: _selectedGender,
// // // //                           onChanged: (GenderType? value) {
// // // //                             setState(() {
// // // //                               _selectedGender = value;
// // // //                             });
// // // //                           },
// // // //                         ),
// // // //                       ),
// // // //                     ),
// // // //                   ],
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 Row(
// // // //                   children: [
// // // //                     Flag.fromString('LY', height: 24, width: 32),
// // // //                     SizedBox(width: 8),
// // // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // // //                     SizedBox(width: 8),
// // // //                     Expanded(
// // // //                       child: TextFormField(
// // // //                         controller: _phoneController,
// // // //                         keyboardType: TextInputType.phone,
// // // //                         maxLength: 9,
// // // //                         decoration: InputDecoration(
// // // //                           labelText: 'Phone Number',
// // // //                           counterText: "",
// // // //                         ),
// // // //                         validator: (value) {
// // // //                           if (value == null ||
// // // //                               value.isEmpty ||
// // // //                               value.length != 9 ||
// // // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // // //                             return 'Enter a valid 9-digit number';
// // // //                           }
// // // //                           return null;
// // // //                         },
// // // //                       ),
// // // //                     ),
// // // //                   ],
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 DropdownButtonFormField<String>(
// // // //                   value: _addressController.text.isEmpty
// // // //                       ? null
// // // //                       : _addressController.text,
// // // //                   onChanged: (value) {
// // // //                     setState(() {
// // // //                       _addressController.text = value!;
// // // //                     });
// // // //                   },
// // // //                   items: _tripoliStreets
// // // //                       .map<DropdownMenuItem<String>>(
// // // //                         (street) => DropdownMenuItem<String>(
// // // //                           value: street,
// // // //                           child: Text(street),
// // // //                         ),
// // // //                       )
// // // //                       .toList(),
// // // //                   decoration: InputDecoration(labelText: 'Address'),
// // // //                 ),
// // // //                 SizedBox(height: 16),
// // // //                 widget.userType == 1
// // // //                     ? Column(
// // // //                         children: [
// // // //                           TextFormField(
// // // //                             controller: _bioController,
// // // //                             decoration: InputDecoration(labelText: 'Bio'),
// // // //                           ),
// // // //                           SizedBox(height: 16),
// // // //                           TextFormField(
// // // //                             controller: _experienceController,
// // // //                             decoration: InputDecoration(
// // // //                                 labelText: 'Experience (years)'),
// // // //                           ),
// // // //                           SizedBox(height: 16),
// // // //                           Text('Category'),
// // // //                           // Display categories dropdown for Vendor
// // // //                           DropdownButtonFormField<Map<String, dynamic>>(
// // // //                             value: _selectedCategory,
// // // //                             onChanged: (newValue) {
// // // //                               setState(() {
// // // //                                 _selectedCategory = newValue!;
// // // //                               });
// // // //                             },
// // // //                             items: _categories
// // // //                                 .map((category) => DropdownMenuItem(
// // // //                                       value: category,
// // // //                                       child: Text(category['name']),
// // // //                                     ))
// // // //                                 .toList(),
// // // //                             decoration:
// // // //                                 InputDecoration(labelText: 'Select Category'),
// // // //                           ),
// // // //                         ],
// // // //                       )
// // // //                     : SizedBox.shrink(),
// // // //                 SizedBox(height: 16),
// // // //                 ElevatedButton(
// // // //                   onPressed: _isLoading ? null : submitForm,
// // // //                   child: _isLoading
// // // //                       ? CircularProgressIndicator(color: Colors.white)
// // // //                       : Text('Sign Up'),
// // // //                 ),
// // // //               ],
// // // //             ),
// // // //           ),
// // // //         ),
// // // //       ),
// // // //     );
// // // //   }
// // // // }
// // // import 'dart:convert';
// // // import 'dart:io';
// // // import 'package:flutter/material.dart';
// // // import 'package:http/http.dart' as http;
// // // import 'package:image_picker/image_picker.dart';
// // // import 'package:location/location.dart';
// // // import 'package:flag/flag.dart';

// // // // Define the GenderType enum
// // // enum GenderType { male, female }

// // // class SignUpScreen extends StatefulWidget {
// // //   final int userType; // 0 for Customer, 1 for Vendor
// // //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// // //   @override
// // //   State<SignUpScreen> createState() => _SignUpScreenState();
// // // }

// // // class _SignUpScreenState extends State<SignUpScreen> {
// // //   final _formKey = GlobalKey<FormState>();
// // //   final _nameController = TextEditingController();
// // //   final _emailController = TextEditingController();
// // //   final _passwordController = TextEditingController();
// // //   final _confirmPasswordController = TextEditingController();
// // //   final _addressController = TextEditingController();
// // //   final _phoneController = TextEditingController();
// // //   final _locationController = TextEditingController();

// // //   // For Vendor-specific fields
// // //   final _bioController = TextEditingController();
// // //   final _experienceController = TextEditingController();
// // //   List<Map<String, dynamic>> _categories = []; // Categories fetched from API
// // //   Map<String, dynamic>? _selectedCategory; // To store the selected category

// // //   File? _avatarImage;
// // //   bool _isLoading = false;
// // //   bool _obscurePassword = true;
// // //   bool _obscureConfirmPassword = true;
// // //   String? _selectedAge;
// // //   GenderType? _selectedGender;
// // //   final List<String> _tripoliStreets = [
// // //     "Martyrs' Square",
// // //     "Al-Mansoura",
// // //     "Gargaresh",
// // //     "Hai Al-Andalus",
// // //     "Ben Ashur",
// // //     "Garden City",
// // //     "Abu Salim",
// // //     "Souk Al-Juma",
// // //     "Janzour"
// // //   ];

// // //   // Location Service
// // //   Location _location = Location();

// // //   @override
// // //   void initState() {
// // //     super.initState();
// // //     _fetchCategories();
// // //   }

// // //   // Method to get current location
// // //   Future<void> _getCurrentLocation() async {
// // //     try {
// // //       bool _serviceEnabled = await _location.serviceEnabled();
// // //       if (!_serviceEnabled) {
// // //         _serviceEnabled = await _location.requestService();
// // //         if (!_serviceEnabled) {
// // //           ScaffoldMessenger.of(context).showSnackBar(
// // //             SnackBar(content: Text("Location service is not enabled")),
// // //           );
// // //           return;
// // //         }
// // //       }

// // //       PermissionStatus _permissionGranted = await _location.hasPermission();
// // //       if (_permissionGranted == PermissionStatus.denied) {
// // //         _permissionGranted = await _location.requestPermission();
// // //         if (_permissionGranted != PermissionStatus.granted) {
// // //           ScaffoldMessenger.of(context).showSnackBar(
// // //             SnackBar(content: Text("Location permission denied")),
// // //           );
// // //           return;
// // //         }
// // //       }

// // //       LocationData _currentLocation = await _location.getLocation();
// // //       setState(() {
// // //         _locationController.text =
// // //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// // //       });
// // //     } catch (e) {
// // //       ScaffoldMessenger.of(context).showSnackBar(
// // //         SnackBar(content: Text("Error getting location: $e")),
// // //       );
// // //     }
// // //   }

// // //   Future<void> _pickImage() async {
// // //     final pickedFile =
// // //         await ImagePicker().pickImage(source: ImageSource.gallery);
// // //     if (pickedFile != null) {
// // //       setState(() {
// // //         _avatarImage = File(pickedFile.path);
// // //       });
// // //     }
// // //   }

// // //   void _fetchCategories() async {
// // //     try {
// // //       final response =
// // //           await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
// // //       print(response.statusCode); // Log the response status code
// // //       if (response.statusCode == 200 || response.statusCode == 201) {
// // //         final List<dynamic> data = jsonDecode(response.body);
// // //         setState(() {
// // //           _categories = data.map((item) {
// // //             return {
// // //               'id': item['id'],
// // //               'name': item['name'],
// // //             };
// // //           }).toList();
// // //           if (_categories.isNotEmpty) {
// // //             _selectedCategory =
// // //                 _categories[0]; // Set the first category as the default
// // //           }
// // //         });
// // //       } else {
// // //         ScaffoldMessenger.of(context).showSnackBar(
// // //           SnackBar(content: Text("Failed to fetch categories")),
// // //         );
// // //       }
// // //     } catch (e) {
// // //       ScaffoldMessenger.of(context).showSnackBar(
// // //         SnackBar(content: Text("Error fetching categories: $e")),
// // //       );
// // //     }
// // //   }

// // //   Future<void> submitForm() async {
// // //     if (_formKey.currentState?.validate() ?? false) {
// // //       setState(() {
// // //         _isLoading = true;
// // //       });

// // //       final Map<String, dynamic> userData = {
// // //         'userName': _nameController.text,
// // //         'email': _emailController.text,
// // //         'password': _passwordController.text,
// // //         'confirmPassword': _confirmPasswordController.text,
// // //         'userAddress': _addressController.text,
// // //         'phone': _phoneController.text,
// // //         'age': int.tryParse(_selectedAge ?? '0'),
// // //         'gender': _selectedGender == GenderType.male ? 1 : 0,
// // //         'type': widget.userType == 0 ? 0 : 1,
// // //         'image': _avatarImage != null
// // //             ? base64Encode(_avatarImage!.readAsBytesSync())
// // //             : null,
// // //         'location': _locationController.text,
// // //       };

// // //       try {
// // //         final response = await http.post(
// // //           Uri.parse('https://192.168.0.109:7127/api/user'),
// // //           headers: {
// // //             'Content-Type': 'application/json',
// // //           },
// // //           body: jsonEncode(userData),
// // //         );

// // //         if (response.statusCode == 201) {
// // //           final newUser = jsonDecode(response.body);
// // //           print("New user created with ID: ${newUser['id']}");

// // //           if (widget.userType == 1) {
// // //             final Map<String, dynamic> vendorData = {
// // //               'userId': newUser['id'].toString(),  // Ensure userId is a string
// // //               'categoryId': _selectedCategory != null
// // //                   ? _selectedCategory!['id'].toString() // Ensure categoryId is a string
// // //                   : null,
// // //               'bio': _bioController.text,
// // //               'experience': int.tryParse(_experienceController.text),
// // //             };

// // //             final vendorResponse = await http.post(
// // //               Uri.parse('https://192.168.0.109:7127/api/VenderProfile'),
// // //               headers: {
// // //                 'Content-Type': 'application/json',
// // //               },
// // //               body: jsonEncode(vendorData),
// // //             );

// // //             if (vendorResponse.statusCode == 201) {
// // //               ScaffoldMessenger.of(context).showSnackBar(
// // //                 SnackBar(content: Text("Account created successfully!")),
// // //               );
// // //               Navigator.pop(context);
// // //             } else {
// // //               ScaffoldMessenger.of(context).showSnackBar(
// // //                 SnackBar(content: Text("Error: ${vendorResponse.body}")),
// // //               );
// // //               print("Vendor profile creation error: ${vendorResponse.body}");
// // //             }
// // //           } else {
// // //             ScaffoldMessenger.of(context).showSnackBar(
// // //               SnackBar(content: Text("Account created successfully!")),
// // //             );
// // //             Navigator.pop(context);
// // //           }
// // //         } else {
// // //           ScaffoldMessenger.of(context).showSnackBar(
// // //             SnackBar(content: Text("Error: ${response.body}")),
// // //           );
// // //           print("User creation error: ${response.body}");
// // //         }
// // //       } catch (e) {
// // //         ScaffoldMessenger.of(context).showSnackBar(
// // //           SnackBar(content: Text("Network error: $e")),
// // //         );
// // //         print("Network error: $e");
// // //       } finally {
// // //         setState(() {
// // //           _isLoading = false;
// // //         });
// // //       }
// // //     }
// // //   }

// // //   @override
// // //   Widget build(BuildContext context) {
// // //     return Scaffold(
// // //       appBar: AppBar(title: Text('Sign Up')),
// // //       body: Padding(
// // //         padding: const EdgeInsets.all(16.0),
// // //         child: Form(
// // //           key: _formKey,
// // //           child: SingleChildScrollView(
// // //             child: Column(
// // //               crossAxisAlignment: CrossAxisAlignment.stretch,
// // //               children: [
// // //                 GestureDetector(
// // //                   onTap: _pickImage,
// // //                   child: CircleAvatar(
// // //                     radius: 100,
// // //                     backgroundImage:
// // //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// // //                     child: _avatarImage == null
// // //                         ? Icon(Icons.camera_alt, size: 70)
// // //                         : null,
// // //                   ),
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 TextFormField(
// // //                   controller: _nameController,
// // //                   decoration: InputDecoration(labelText: 'Name'),
// // //                   validator: (value) =>
// // //                       value == null || value.isEmpty ? 'Enter your name' : null,
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 TextFormField(
// // //                   controller: _emailController,
// // //                   decoration: InputDecoration(labelText: 'Email'),
// // //                   validator: (value) => value == null || !value.contains('@')
// // //                       ? 'Enter a valid email'
// // //                       : null,
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 TextFormField(
// // //                   controller: _passwordController,
// // //                   decoration: InputDecoration(
// // //                     labelText: 'Password',
// // //                     suffixIcon: IconButton(
// // //                       icon: Icon(_obscurePassword
// // //                           ? Icons.visibility_off
// // //                           : Icons.visibility),
// // //                       onPressed: () {
// // //                         setState(() {
// // //                           _obscurePassword = !_obscurePassword;
// // //                         });
// // //                       },
// // //                     ),
// // //                   ),
// // //                   obscureText: _obscurePassword,
// // //                   validator: (value) => value == null || value.length < 6
// // //                       ? 'Password must be at least 6 characters'
// // //                       : null,
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 TextFormField(
// // //                   controller: _confirmPasswordController,
// // //                   decoration: InputDecoration(
// // //                     labelText: 'Confirm Password',
// // //                     suffixIcon: IconButton(
// // //                       icon: Icon(_obscureConfirmPassword
// // //                           ? Icons.visibility_off
// // //                           : Icons.visibility),
// // //                       onPressed: () {
// // //                         setState(() {
// // //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// // //                         });
// // //                       },
// // //                     ),
// // //                   ),
// // //                   obscureText: _obscureConfirmPassword,
// // //                   validator: (value) => value != _passwordController.text
// // //                       ? 'Passwords do not match'
// // //                       : null,
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 DropdownButtonFormField<String>(
// // //                   value: _selectedAge,
// // //                   decoration: InputDecoration(labelText: 'Age'),
// // //                   items: List.generate(100, (index) => (index + 1).toString())
// // //                       .map((age) =>
// // //                           DropdownMenuItem(value: age, child: Text(age)))
// // //                       .toList(),
// // //                   onChanged: (value) {
// // //                     setState(() {
// // //                       _selectedAge = value;
// // //                     });
// // //                   },
// // //                   validator: (value) =>
// // //                       value == null || value.isEmpty ? 'Select your age' : null,
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 Row(
// // //                   children: [
// // //                     Expanded(
// // //                       child: ListTile(
// // //                         title: Text('Male'),
// // //                         leading: Radio<GenderType>(
// // //                           value: GenderType.male,
// // //                           groupValue: _selectedGender,
// // //                           onChanged: (GenderType? value) {
// // //                             setState(() {
// // //                               _selectedGender = value;
// // //                             });
// // //                           },
// // //                         ),
// // //                       ),
// // //                     ),
// // //                     Expanded(
// // //                       child: ListTile(
// // //                         title: Text('Female'),
// // //                         leading: Radio<GenderType>(
// // //                           value: GenderType.female,
// // //                           groupValue: _selectedGender,
// // //                           onChanged: (GenderType? value) {
// // //                             setState(() {
// // //                               _selectedGender = value;
// // //                             });
// // //                           },
// // //                         ),
// // //                       ),
// // //                     ),
// // //                   ],
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 Row(
// // //                   children: [
// // //                     Flag.fromString('LY', height: 24, width: 32),
// // //                     SizedBox(width: 8),
// // //                     Text('+218', style: TextStyle(fontSize: 16)),
// // //                     SizedBox(width: 8),
// // //                     Expanded(
// // //                       child: TextFormField(
// // //                         controller: _phoneController,
// // //                         keyboardType: TextInputType.phone,
// // //                         maxLength: 9,
// // //                         decoration: InputDecoration(
// // //                           labelText: 'Phone Number',
// // //                           counterText: "",
// // //                         ),
// // //                         validator: (value) {
// // //                           if (value == null ||
// // //                               value.isEmpty ||
// // //                               value.length != 9 ||
// // //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// // //                             return 'Enter a valid 9-digit number';
// // //                           }
// // //                           return null;
// // //                         },
// // //                       ),
// // //                     ),
// // //                   ],
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 DropdownButtonFormField<String>(
// // //                   value: _addressController.text.isEmpty
// // //                       ? null
// // //                       : _addressController.text,
// // //                   onChanged: (value) {
// // //                     setState(() {
// // //                       _addressController.text = value!;
// // //                     });
// // //                   },
// // //                   items: _tripoliStreets
// // //                       .map<DropdownMenuItem<String>>(
// // //                         (street) => DropdownMenuItem<String>(
// // //                           value: street,
// // //                           child: Text(street),
// // //                         ),
// // //                       )
// // //                       .toList(),
// // //                   decoration: InputDecoration(labelText: 'Address'),
// // //                 ),
// // //                 SizedBox(height: 16),
// // //                 widget.userType == 1
// // //                     ? Column(
// // //                         children: [
// // //                           TextFormField(
// // //                             controller: _bioController,
// // //                             decoration: InputDecoration(labelText: 'Bio'),
// // //                           ),
// // //                           SizedBox(height: 16),
// // //                           TextFormField(
// // //                             controller: _experienceController,
// // //                             decoration: InputDecoration(
// // //                                 labelText: 'Experience (years)'),
// // //                           ),
// // //                           SizedBox(height: 16),
// // //                           Text('Category'),
// // //                           // Display categories dropdown for Vendor
// // //                           DropdownButtonFormField<Map<String, dynamic>>(
// // //                             value: _selectedCategory,
// // //                             onChanged: (newValue) {
// // //                               setState(() {
// // //                                 _selectedCategory = newValue!;
// // //                               });
// // //                             },
// // //                             items: _categories
// // //                                 .map((category) => DropdownMenuItem(
// // //                                       value: category,
// // //                                       child: Text(category['name']),
// // //                                     ))
// // //                                 .toList(),
// // //                             decoration:
// // //                                 InputDecoration(labelText: 'Select Category'),
// // //                           ),
// // //                         ],
// // //                       )
// // //                     : SizedBox.shrink(),
// // //                 SizedBox(height: 16),
// // //                 ElevatedButton(
// // //                   onPressed: _isLoading ? null : submitForm,
// // //                   child: _isLoading
// // //                       ? CircularProgressIndicator(color: Colors.white)
// // //                       : Text('Sign Up'),
// // //                 ),
// // //               ],
// // //             ),
// // //           ),
// // //         ),
// // //       ),
// // //     );
// // //   }
// // // }
// // import 'dart:convert';
// // import 'dart:io';
// // import 'package:flutter/material.dart';
// // import 'package:http/http.dart' as http;
// // import 'package:image_picker/image_picker.dart';
// // import 'package:location/location.dart';
// // import 'package:flag/flag.dart';

// // // Define the GenderType enum
// // enum GenderType { male, female }

// // class SignUpScreen extends StatefulWidget {
// //   final int userType; // 0 for Customer, 1 for Vendor
// //   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

// //   @override
// //   State<SignUpScreen> createState() => _SignUpScreenState();
// // }

// // class _SignUpScreenState extends State<SignUpScreen> {
// //   final _formKey = GlobalKey<FormState>();
// //   final _nameController = TextEditingController();
// //   final _emailController = TextEditingController();
// //   final _passwordController = TextEditingController();
// //   final _confirmPasswordController = TextEditingController();
// //   final _addressController = TextEditingController();
// //   final _phoneController = TextEditingController();
// //   final _locationController = TextEditingController();

// //   // For Vendor-specific fields
// //   final _bioController = TextEditingController();
// //   final _experienceController = TextEditingController();
// //   List<Map<String, dynamic>> _categories = []; // Categories fetched from API
// //   Map<String, dynamic>? _selectedCategory; // To store the selected category

// //   File? _avatarImage;
// //   bool _isLoading = false;
// //   bool _obscurePassword = true;
// //   bool _obscureConfirmPassword = true;
// //   String? _selectedAge;
// //   GenderType? _selectedGender;
// //   final List<String> _tripoliStreets = [
// //     "Martyrs' Square",
// //     "Al-Mansoura",
// //     "Gargaresh",
// //     "Hai Al-Andalus",
// //     "Ben Ashur",
// //     "Garden City",
// //     "Abu Salim",
// //     "Souk Al-Juma",
// //     "Janzour"
// //   ];

// //   // Location Service
// //   Location _location = Location();

// //   @override
// //   void initState() {
// //     super.initState();
// //     _fetchCategories();
// //   }

// //   // Method to get current location
// //   Future<void> _getCurrentLocation() async {
// //     try {
// //       bool _serviceEnabled = await _location.serviceEnabled();
// //       if (!_serviceEnabled) {
// //         _serviceEnabled = await _location.requestService();
// //         if (!_serviceEnabled) {
// //           ScaffoldMessenger.of(context).showSnackBar(
// //             SnackBar(content: Text("Location service is not enabled")),
// //           );
// //           return;
// //         }
// //       }

// //       PermissionStatus _permissionGranted = await _location.hasPermission();
// //       if (_permissionGranted == PermissionStatus.denied) {
// //         _permissionGranted = await _location.requestPermission();
// //         if (_permissionGranted != PermissionStatus.granted) {
// //           ScaffoldMessenger.of(context).showSnackBar(
// //             SnackBar(content: Text("Location permission denied")),
// //           );
// //           return;
// //         }
// //       }

// //       LocationData _currentLocation = await _location.getLocation();
// //       setState(() {
// //         _locationController.text =
// //             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
// //       });
// //     } catch (e) {
// //       ScaffoldMessenger.of(context).showSnackBar(
// //         SnackBar(content: Text("Error getting location: $e")),
// //       );
// //     }
// //   }

// //   Future<void> _pickImage() async {
// //     final pickedFile =
// //         await ImagePicker().pickImage(source: ImageSource.gallery);
// //     if (pickedFile != null) {
// //       setState(() {
// //         _avatarImage = File(pickedFile.name);
// //       });
// //     }
// //   }

// //   void _fetchCategories() async {
// //     try {
// //       final response =
// //           await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
// //       print(response.statusCode); // Log the response status code
// //       if (response.statusCode == 200 || response.statusCode == 201) {
// //         final List<dynamic> data = jsonDecode(response.body);
// //         setState(() {
// //           _categories = data.map((item) {
// //             return {
// //               'id': item['id'],
// //               'name': item['name'],
// //             };
// //           }).toList();
// //           if (_categories.isNotEmpty) {
// //             _selectedCategory =
// //                 _categories[0]; // Set the first category as the default
// //           }
// //         });
// //       } else {
// //         ScaffoldMessenger.of(context).showSnackBar(
// //           SnackBar(content: Text("Failed to fetch categories")),
// //         );
// //       }
// //     } catch (e) {
// //       ScaffoldMessenger.of(context).showSnackBar(
// //         SnackBar(content: Text("Error fetching categories: $e")),
// //       );
// //     }
// //   }

// //   Future<void> submitForm() async {
// //     if (_formKey.currentState?.validate() ?? false) {
// //       setState(() {
// //         _isLoading = true;
// //       });

// //       final Map<String, dynamic> userData = {
// //         'userName': _nameController.text,
// //         'email': _emailController.text,
// //         'password': _passwordController.text,
// //         'confirmPassword': _confirmPasswordController.text,
// //         'userAddress': _addressController.text,
// //         'phone': _phoneController.text,
// //         'age': int.tryParse(_selectedAge ?? '0'),
// //         'gender': _selectedGender == GenderType.male ? 1 : 0,
// //         'type': widget.userType == 0 ? 0 : 1,
// //         'image': _avatarImage != null
// //             ? base64Encode(_avatarImage!.readAsBytesSync())
// //             : null,
// //         'location': _locationController.text,
// //       };

// //       try {
// //         final response = await http.post(
// //           Uri.parse('https://192.168.0.109:7127/api/user'),
// //           headers: {
// //             'Content-Type': 'application/json',
// //           },
// //           body: jsonEncode(userData),
// //         );

// //         if (response.statusCode == 201) {
// //           final newUser = jsonDecode(response.body);
// //           print("New user created with ID: ${newUser['id']}");

// //           if (widget.userType == 1) {
// //             // Fetch the user by email to get the user ID using the filter endpoint
// //             final userResponse = await http.get(
// //               Uri.parse('https://192.168.0.109:7127/api/user/filter?email=${_emailController.text}')
// //             );

// //             if (userResponse.statusCode == 200) {
// //               final filteredUsers = jsonDecode(userResponse.body);
// //               if (filteredUsers.isNotEmpty) {
// //                 final fetchedUser = filteredUsers[0];
// //                 final userId = fetchedUser['id'];

// //                 final Map<String, dynamic> vendorData = {
// //                   'userId': userId,  // Use fetched user ID
// //                   'categoryId': _selectedCategory != null
// //                       ? _selectedCategory!['id']
// //                       : null,
// //                   'bio': _bioController.text,
// //                   'experience': int.tryParse(_experienceController.text),
// //                 };

// //                 final vendorResponse = await http.post(
// //                   Uri.parse('https://192.168.0.109:7127/api/VenderProfile'),
// //                   headers: {
// //                     'Content-Type': 'application/json',
// //                   },
// //                   body: jsonEncode(vendorData),
// //                 );

// //                 if (vendorResponse.statusCode == 201) {
// //                   ScaffoldMessenger.of(context).showSnackBar(
// //                     SnackBar(content: Text("Account created successfully!")),
// //                   );
// //                   Navigator.pop(context);
// //                 } else {
// //                   ScaffoldMessenger.of(context).showSnackBar(
// //                     SnackBar(content: Text("Error: ${vendorResponse.body}")),
// //                   );
// //                   print("Vendor profile creation error: ${vendorResponse.body}");
// //                 }
// //               } else {
// //                 ScaffoldMessenger.of(context).showSnackBar(
// //                   SnackBar(content: Text("User not found by email")),
// //                 );
// //                 print("User not found by email: ${userResponse.body}");
// //               }
// //             } else {
// //               ScaffoldMessenger.of(context).showSnackBar(
// //                 SnackBar(content: Text("Error fetching user by email")),
// //               );
// //               print("Error fetching user by email: ${userResponse.body}");
// //             }
// //           } else {
// //             ScaffoldMessenger.of(context).showSnackBar(
// //               SnackBar(content: Text("Account created successfully!")),
// //             );
// //             Navigator.pop(context);
// //           }
// //         } else {
// //           ScaffoldMessenger.of(context).showSnackBar(
// //             SnackBar(content: Text("Error: ${response.body}")),
// //           );
// //           print("User creation error: ${response.body}");
// //         }
// //       } catch (e) {
// //         ScaffoldMessenger.of(context).showSnackBar(
// //           SnackBar(content: Text("Network error: $e")),
// //         );
// //         print("Network error: $e");
// //       } finally {
// //         setState(() {
// //           _isLoading = false;
// //         });
// //       }
// //     }
// //   }

// //   @override
// //   Widget build(BuildContext context) {
// //     return Scaffold(
// //       appBar: AppBar(title: Text('Sign Up')),
// //       body: Padding(
// //         padding: const EdgeInsets.all(16.0),
// //         child: Form(
// //           key: _formKey,
// //           child: SingleChildScrollView(
// //             child: Column(
// //               crossAxisAlignment: CrossAxisAlignment.stretch,
// //               children: [
// //                 GestureDetector(
// //                   onTap: _pickImage,
// //                   child: CircleAvatar(
// //                     radius: 100,
// //                     backgroundImage:
// //                         _avatarImage != null ? FileImage(_avatarImage!) : null,
// //                     child: _avatarImage == null
// //                         ? Icon(Icons.camera_alt, size: 70)
// //                         : null,
// //                   ),
// //                 ),
// //                 SizedBox(height: 16),
// //                 TextFormField(
// //                   controller: _nameController,
// //                   decoration: InputDecoration(labelText: 'Name'),
// //                   validator: (value) =>
// //                       value == null || value.isEmpty ? 'Enter your name' : null,
// //                 ),
// //                 SizedBox(height: 16),
// //                 TextFormField(
// //                   controller: _emailController,
// //                   decoration: InputDecoration(labelText: 'Email'),
// //                   validator: (value) => value == null || !value.contains('@')
// //                       ? 'Enter a valid email'
// //                       : null,
// //                 ),
// //                 SizedBox(height: 16),
// //                 TextFormField(
// //                   controller: _passwordController,
// //                   decoration: InputDecoration(
// //                     labelText: 'Password',
// //                     suffixIcon: IconButton(
// //                       icon: Icon(_obscurePassword
// //                           ? Icons.visibility_off
// //                           : Icons.visibility),
// //                       onPressed: () {
// //                         setState(() {
// //                           _obscurePassword = !_obscurePassword;
// //                         });
// //                       },
// //                     ),
// //                   ),
// //                   obscureText: _obscurePassword,
// //                   validator: (value) => value == null || value.length < 6
// //                       ? 'Password must be at least 6 characters'
// //                       : null,
// //                 ),
// //                 SizedBox(height: 16),
// //                 TextFormField(
// //                   controller: _confirmPasswordController,
// //                   decoration: InputDecoration(
// //                     labelText: 'Confirm Password',
// //                     suffixIcon: IconButton(
// //                       icon: Icon(_obscureConfirmPassword
// //                           ? Icons.visibility_off
// //                           : Icons.visibility),
// //                       onPressed: () {
// //                         setState(() {
// //                           _obscureConfirmPassword = !_obscureConfirmPassword;
// //                         });
// //                       },
// //                     ),
// //                   ),
// //                   obscureText: _obscureConfirmPassword,
// //                   validator: (value) => value != _passwordController.text
// //                       ? 'Passwords do not match'
// //                       : null,
// //                 ),
// //                 SizedBox(height: 16),
// //                 DropdownButtonFormField<String>(
// //                   value: _selectedAge,
// //                   decoration: InputDecoration(labelText: 'Age'),
// //                   items: List.generate(100, (index) => (index + 1).toString())
// //                       .map((age) =>
// //                           DropdownMenuItem(value: age, child: Text(age)))
// //                       .toList(),
// //                   onChanged: (value) {
// //                     setState(() {
// //                       _selectedAge = value;
// //                     });
// //                   },
// //                   validator: (value) =>
// //                       value == null || value.isEmpty ? 'Select your age' : null,
// //                 ),
// //                 SizedBox(height: 16),
// //                 Row(
// //                   children: [
// //                     Expanded(
// //                       child: ListTile(
// //                         title: Text('Male'),
// //                         leading: Radio<GenderType>(
// //                           value: GenderType.male,
// //                           groupValue: _selectedGender,
// //                           onChanged: (GenderType? value) {
// //                             setState(() {
// //                               _selectedGender = value;
// //                             });
// //                           },
// //                         ),
// //                       ),
// //                     ),
// //                     Expanded(
// //                       child: ListTile(
// //                         title: Text('Female'),
// //                         leading: Radio<GenderType>(
// //                           value: GenderType.female,
// //                           groupValue: _selectedGender,
// //                           onChanged: (GenderType? value) {
// //                             setState(() {
// //                               _selectedGender = value;
// //                             });
// //                           },
// //                         ),
// //                       ),
// //                     ),
// //                   ],
// //                 ),
// //                 SizedBox(height: 16),
// //                 Row(
// //                   children: [
// //                     Flag.fromString('LY', height: 24, width: 32),
// //                     SizedBox(width: 8),
// //                     Text('+218', style: TextStyle(fontSize: 16)),
// //                     SizedBox(width: 8),
// //                     Expanded(
// //                       child: TextFormField(
// //                         controller: _phoneController,
// //                         keyboardType: TextInputType.phone,
// //                         maxLength: 9,
// //                         decoration: InputDecoration(
// //                           labelText: 'Phone Number',
// //                           counterText: "",
// //                         ),
// //                         validator: (value) {
// //                           if (value == null ||
// //                               value.isEmpty ||
// //                               value.length != 9 ||
// //                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
// //                             return 'Enter a valid 9-digit number';
// //                           }
// //                           return null;
// //                         },
// //                       ),
// //                     ),
// //                   ],
// //                 ),
// //                 SizedBox(height: 16),
// //                 DropdownButtonFormField<String>(
// //                   value: _addressController.text.isEmpty
// //                       ? null
// //                       : _addressController.text,
// //                   onChanged: (value) {
// //                     setState(() {
// //                       _addressController.text = value!;
// //                     });
// //                   },
// //                   items: _tripoliStreets
// //                       .map<DropdownMenuItem<String>>(
// //                         (street) => DropdownMenuItem<String>(
// //                           value: street,
// //                           child: Text(street),
// //                         ),
// //                       )
// //                       .toList(),
// //                   decoration: InputDecoration(labelText: 'Address'),
// //                 ),
// //                 SizedBox(height: 16),
// //                 widget.userType == 1
// //                     ? Column(
// //                         children: [
// //                           TextFormField(
// //                             controller: _bioController,
// //                             decoration: InputDecoration(labelText: 'Bio'),
// //                           ),
// //                           SizedBox(height: 16),
// //                           TextFormField(
// //                             controller: _experienceController,
// //                             decoration: InputDecoration(
// //                                 labelText: 'Experience (years)'),
// //                           ),
// //                           SizedBox(height: 16),
// //                           Text('Category'),
// //                           // Display categories dropdown for Vendor
// //                           DropdownButtonFormField<Map<String, dynamic>>(
// //                             value: _selectedCategory,
// //                             onChanged: (newValue) {
// //                               setState(() {
// //                                 _selectedCategory = newValue!;
// //                               });
// //                             },
// //                             items: _categories
// //                                 .map((category) => DropdownMenuItem(
// //                                       value: category,
// //                                       child: Text(category['name']),
// //                                     ))
// //                                 .toList(),
// //                             decoration:
// //                                 InputDecoration(labelText: 'Select Category'),
// //                           ),
// //                         ],
// //                       )
// //                     : SizedBox.shrink(),
// //                 SizedBox(height: 16),
// //                 ElevatedButton(
// //                   onPressed: _isLoading ? null : submitForm,
// //                   child: _isLoading
// //                       ? CircularProgressIndicator(color: Colors.white)
// //                       : Text('Sign Up'),
// //                 ),
// //               ],
// //             ),
// //           ),
// //         ),
// //       ),
// //     );
// //   }
// // }
// import 'dart:convert';
// import 'dart:io';
// import 'package:flutter/material.dart';
// import 'package:http/http.dart' as http;
// import 'package:image_picker/image_picker.dart';
// import 'package:location/location.dart';
// import 'package:flag/flag.dart';
// import 'package:path/path.dart' as path;

// // Define the GenderType enum
// enum GenderType { male, female }

// class SignUpScreen extends StatefulWidget {
//   final int userType; // 0 for Customer, 1 for Vendor
//   const SignUpScreen({Key? key, required this.userType}) : super(key: key);

//   @override
//   State<SignUpScreen> createState() => _SignUpScreenState();
// }

// class _SignUpScreenState extends State<SignUpScreen> {
//   final _formKey = GlobalKey<FormState>();
//   final _nameController = TextEditingController();
//   final _emailController = TextEditingController();
//   final _passwordController = TextEditingController();
//   final _confirmPasswordController = TextEditingController();
//   final _addressController = TextEditingController();
//   final _phoneController = TextEditingController();
//   final _locationController = TextEditingController();

//   // For Vendor-specific fields
//   final _bioController = TextEditingController();
//   final _experienceController = TextEditingController();
//   List<Map<String, dynamic>> _categories = []; // Categories fetched from API
//   Map<String, dynamic>? _selectedCategory; // To store the selected category

//   File? _avatarImage;
//   bool _isLoading = false;
//   bool _obscurePassword = true;
//   bool _obscureConfirmPassword = true;
//   String? _selectedAge;
//   GenderType? _selectedGender;
//   final List<String> _tripoliStreets = [
//     "Martyrs' Square",
//     "Al-Mansoura",
//     "Gargaresh",
//     "Hai Al-Andalus",
//     "Ben Ashur",
//     "Garden City",
//     "Abu Salim",
//     "Souk Al-Juma",
//     "Janzour"
//   ];

//   // Location Service
//   Location _location = Location();

//   @override
//   void initState() {
//     super.initState();
//     _fetchCategories();
//   }

//   // Method to get current location
//   Future<void> _getCurrentLocation() async {
//     try {
//       bool _serviceEnabled = await _location.serviceEnabled();
//       if (!_serviceEnabled) {
//         _serviceEnabled = await _location.requestService();
//         if (!_serviceEnabled) {
//           ScaffoldMessenger.of(context).showSnackBar(
//             SnackBar(content: Text("Location service is not enabled")),
//           );
//           return;
//         }
//       }

//       PermissionStatus _permissionGranted = await _location.hasPermission();
//       if (_permissionGranted == PermissionStatus.denied) {
//         _permissionGranted = await _location.requestPermission();
//         if (_permissionGranted != PermissionStatus.granted) {
//           ScaffoldMessenger.of(context).showSnackBar(
//             SnackBar(content: Text("Location permission denied")),
//           );
//           return;
//         }
//       }

//       LocationData _currentLocation = await _location.getLocation();
//       setState(() {
//         _locationController.text =
//             '${_currentLocation.latitude}, ${_currentLocation.longitude}';
//       });
//     } catch (e) {
//       ScaffoldMessenger.of(context).showSnackBar(
//         SnackBar(content: Text("Error getting location: $e")),
//       );
//     }
//   }

//   Future<void> _pickImage() async {
//     final pickedFile = await ImagePicker().pickImage(source: ImageSource.gallery);
//     if (pickedFile != null) {
//       setState(() {
//         _avatarImage = File(pickedFile.path); // Keep the full path for file operations
//         String fileName = path.basename(pickedFile.path); // Extract the file name
//         // Use fileName to store in the database or send to server
//       });
//     }
//   }

//   void _fetchCategories() async {
//     try {
//       final response =
//           await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
//       print(response.statusCode); // Log the response status code
//       if (response.statusCode == 200 || response.statusCode == 201) {
//         final List<dynamic> data = jsonDecode(response.body);
//         setState(() {
//           _categories = data.map((item) {
//             return {
//               'id': item['id'],
//               'name': item['name'],
//             };
//           }).toList();
//           if (_categories.isNotEmpty) {
//             _selectedCategory =
//                 _categories[0]; // Set the first category as the default
//           }
//         });
//       } else {
//         ScaffoldMessenger.of(context).showSnackBar(
//           SnackBar(content: Text("Failed to fetch categories")),
//         );
//       }
//     } catch (e) {
//       ScaffoldMessenger.of(context).showSnackBar(
//         SnackBar(content: Text("Error fetching categories: $e")),
//       );
//     }
//   }

//   Future<void> submitForm() async {
//     if (_formKey.currentState?.validate() ?? false) {
//       setState(() {
//         _isLoading = true;
//       });

//       final Map<String, dynamic> userData = {
//         'userName': _nameController.text,
//         'email': _emailController.text,
//         'password': _passwordController.text,
//         'confirmPassword': _confirmPasswordController.text,
//         'userAddress': _addressController.text,
//         'phone': _phoneController.text,
//         'age': int.tryParse(_selectedAge ?? '0'),
//         'gender': _selectedGender == GenderType.male ? 1 : 0,
//         'type': widget.userType == 0 ? 0 : 1,
//         'image': _avatarImage != null
//             ? base64Encode(_avatarImage!.readAsBytesSync())
//             : null,
//         'location': _locationController.text,
//         'fileName': _avatarImage != null ? path.basename(_avatarImage!.path) : null, // Store the file name
//       };

//       try {
//         final response = await http.post(
//           Uri.parse('https://192.168.0.109:7127/api/user'),
//           headers: {
//             'Content-Type': 'application/json',
//           },
//           body: jsonEncode(userData),
//         );

//         if (response.statusCode == 201) {
//           final newUser = jsonDecode(response.body);
//           print("New user created with ID: ${newUser['id']}");

//           if (widget.userType == 1) {
//             // Fetch the user by email to get the user ID using the filter endpoint
//             final userResponse = await http.get(
//               Uri.parse('https://192.168.0.109:7127/api/user/filter?email=${_emailController.text}')
//             );

//             if (userResponse.statusCode == 200) {
//               final filteredUsers = jsonDecode(userResponse.body);
//               if (filteredUsers.isNotEmpty) {
//                 final fetchedUser = filteredUsers[0];
//                 final userId = fetchedUser['id'];

//                 final Map<String, dynamic> vendorData = {
//                   'userId': userId,  // Use fetched user ID
//                   'categoryId': _selectedCategory != null
//                       ? _selectedCategory!['id']
//                       : null,
//                   'bio': _bioController.text,
//                   'experience': int.tryParse(_experienceController.text),
//                 };

//                 final vendorResponse = await http.post(
//                   Uri.parse('https://192.168.0.109:7127/api/VenderProfile'),
//                   headers: {
//                     'Content-Type': 'application/json',
//                   },
//                   body: jsonEncode(vendorData),
//                 );

//                 if (vendorResponse.statusCode == 201) {
//                   ScaffoldMessenger.of(context).showSnackBar(
//                     SnackBar(content: Text("Account created successfully!")),
//                   );
//                   Navigator.pop(context);
//                 } else {
//                   ScaffoldMessenger.of(context).showSnackBar(
//                     SnackBar(content: Text("Error: ${vendorResponse.body}")),
//                   );
//                   print("Vendor profile creation error: ${vendorResponse.body}");
//                 }
//               } else {
//                 ScaffoldMessenger.of(context).showSnackBar(
//                   SnackBar(content: Text("User not found by email")),
//                 );
//                 print("User not found by email: ${userResponse.body}");
//               }
//             } else {
//               ScaffoldMessenger.of(context).showSnackBar(
//                 SnackBar(content: Text("Error fetching user by email")),
//               );
//               print("Error fetching user by email: ${userResponse.body}");
//             }
//           } else {
//             ScaffoldMessenger.of(context).showSnackBar(
//               SnackBar(content: Text("Account created successfully!")),
//             );
//             Navigator.pop(context);
//           }
//         } else {
//           ScaffoldMessenger.of(context).showSnackBar(
//             SnackBar(content: Text("Error: ${response.body}")),
//           );
//           print("User creation error: ${response.body}");
//         }
//       } catch (e) {
//         ScaffoldMessenger.of(context).showSnackBar(
//           SnackBar(content: Text("Network error: $e")),
//         );
//         print("Network error: $e");
//       } finally {
//         setState(() {
//           _isLoading = false;
//         });
//       }
//     }
//   }

//   @override
//   Widget build(BuildContext context) {
//     return Scaffold(
//       appBar: AppBar(title: Text('Sign Up')),
//       body: Padding(
//         padding: const EdgeInsets.all(16.0),
//         child: Form(
//           key: _formKey,
//           child: SingleChildScrollView(
//             child: Column(
//               crossAxisAlignment: CrossAxisAlignment.stretch,
//               children: [
//                 GestureDetector(
//                   onTap: _pickImage,
//                   child: CircleAvatar(
//                     radius: 100,
//                     backgroundImage:
//                         _avatarImage != null ? FileImage(_avatarImage!) : null,
//                     child: _avatarImage == null
//                         ? Icon(Icons.camera_alt, size: 70)
//                         : null,
//                   ),
//                 ),
//                 SizedBox(height: 16),
//                 TextFormField(
//                   controller: _nameController,
//                   decoration: InputDecoration(labelText: 'Name'),
//                   validator: (value) =>
//                       value == null || value.isEmpty ? 'Enter your name' : null,
//                 ),
//                 SizedBox(height: 16),
//                 TextFormField(
//                   controller: _emailController,
//                   decoration: InputDecoration(labelText: 'Email'),
//                   validator: (value) => value == null || !value.contains('@')
//                       ? 'Enter a valid email'
//                       : null,
//                 ),
//                 SizedBox(height: 16),
//                 TextFormField(
//                   controller: _passwordController,
//                   decoration: InputDecoration(
//                     labelText: 'Password',
//                     suffixIcon: IconButton(
//                       icon: Icon(_obscurePassword
//                           ? Icons.visibility_off
//                           : Icons.visibility),
//                       onPressed: () {
//                         setState(() {
//                           _obscurePassword = !_obscurePassword;
//                         });
//                       },
//                     ),
//                   ),
//                   obscureText: _obscurePassword,
//                   validator: (value) => value == null || value.length < 6
//                       ? 'Password must be at least 6 characters'
//                       : null,
//                 ),
//                 SizedBox(height: 16),
//                 TextFormField(
//                   controller: _confirmPasswordController,
//                   decoration: InputDecoration(
//                     labelText: 'Confirm Password',
//                     suffixIcon: IconButton(
//                       icon: Icon(_obscureConfirmPassword
//                           ? Icons.visibility_off
//                           : Icons.visibility),
//                       onPressed: () {
//                         setState(() {
//                           _obscureConfirmPassword = !_obscureConfirmPassword;
//                         });
//                       },
//                     ),
//                   ),
//                   obscureText: _obscureConfirmPassword,
//                   validator: (value) => value != _passwordController.text
//                       ? 'Passwords do not match'
//                       : null,
//                 ),
//                 SizedBox(height: 16),
//                 DropdownButtonFormField<String>(
//                   value: _selectedAge,
//                   decoration: InputDecoration(labelText: 'Age'),
//                   items: List.generate(100, (index) => (index + 1).toString())
//                       .map((age) =>
//                           DropdownMenuItem(value: age, child: Text(age)))
//                       .toList(),
//                   onChanged: (value) {
//                     setState(() {
//                       _selectedAge = value;
//                     });
//                   },
//                   validator: (value) =>
//                       value == null || value.isEmpty ? 'Select your age' : null,
//                 ),
//                 SizedBox(height: 16),
//                 Row(
//                   children: [
//                     Expanded(
//                       child: ListTile(
//                         title: Text('Male'),
//                         leading: Radio<GenderType>(
//                           value: GenderType.male,
//                           groupValue: _selectedGender,
//                           onChanged: (GenderType? value) {
//                             setState(() {
//                               _selectedGender = value;
//                             });
//                           },
//                         ),
//                       ),
//                     ),
//                     Expanded(
//                       child: ListTile(
//                         title: Text('Female'),
//                         leading: Radio<GenderType>(
//                           value: GenderType.female,
//                           groupValue: _selectedGender,
//                           onChanged: (GenderType? value) {
//                             setState(() {
//                               _selectedGender = value;
//                             });
//                           },
//                         ),
//                       ),
//                     ),
//                   ],
//                 ),
//                 SizedBox(height: 16),
//                 Row(
//                   children: [
//                     Flag.fromString('LY', height: 24, width: 32),
//                     SizedBox(width: 8),
//                     Text('+218', style: TextStyle(fontSize: 16)),
//                     SizedBox(width: 8),
//                     Expanded(
//                       child: TextFormField(
//                         controller: _phoneController,
//                         keyboardType: TextInputType.phone,
//                         maxLength: 9,
//                         decoration: InputDecoration(
//                           labelText: 'Phone Number',
//                           counterText: "",
//                         ),
//                         validator: (value) {
//                           if (value == null ||
//                               value.isEmpty ||
//                               value.length != 9 ||
//                               !RegExp(r'^[0-9]+$').hasMatch(value)) {
//                             return 'Enter a valid 9-digit number';
//                           }
//                           return null;
//                         },
//                       ),
//                     ),
//                   ],
//                 ),
//                 SizedBox(height: 16),
//                 DropdownButtonFormField<String>(
//                   value: _addressController.text.isEmpty
//                       ? null
//                       : _addressController.text,
//                   onChanged: (value) {
//                     setState(() {
//                       _addressController.text = value!;
//                     });
//                   },
//                   items: _tripoliStreets
//                       .map<DropdownMenuItem<String>>(
//                         (street) => DropdownMenuItem<String>(
//                           value: street,
//                           child: Text(street),
//                         ),
//                       )
//                       .toList(),
//                   decoration: InputDecoration(labelText: 'Address'),
//                 ),
//                 SizedBox(height: 16),
//                 widget.userType == 1
//                     ? Column(
//                         children: [
//                           TextFormField(
//                             controller: _bioController,
//                             decoration: InputDecoration(labelText: 'Bio'),
//                           ),
//                           SizedBox(height: 16),
//                           TextFormField(
//                             controller: _experienceController,
//                             decoration: InputDecoration(
//                                 labelText: 'Experience (years)'),
//                           ),
//                           SizedBox(height: 16),
//                           Text('Category'),
//                           // Display categories dropdown for Vendor
//                           DropdownButtonFormField<Map<String, dynamic>>(
//                             value: _selectedCategory,
//                             onChanged: (newValue) {
//                               setState(() {
//                                 _selectedCategory = newValue!;
//                               });
//                             },
//                             items: _categories
//                                 .map((category) => DropdownMenuItem(
//                                       value: category,
//                                       child: Text(category['name']),
//                                     ))
//                                 .toList(),
//                             decoration:
//                                 InputDecoration(labelText: 'Select Category'),
//                           ),
//                         ],
//                       )
//                     : SizedBox.shrink(),
//                 SizedBox(height: 16),
//                 ElevatedButton(
//                   onPressed: _isLoading ? null : submitForm,
//                   child: _isLoading
//                       ? CircularProgressIndicator(color: Colors.white)
//                       : Text('Sign Up'),
//                 ),
//               ],
//             ),
//           ),
//         ),
//       ),
//     );
//   }
// }
import 'dart:convert';
import 'dart:io';
import 'dart:typed_data';
import 'package:flutter/material.dart';
import 'package:http/http.dart' as http;
import 'package:image_picker/image_picker.dart';
import 'package:location/location.dart';
import 'package:flag/flag.dart';
import 'package:path/path.dart' as path;

// Define the GenderType enum
enum GenderType { male, female }

class SignUpScreen extends StatefulWidget {
  final int userType; // 0 for Customer, 1 for Vendor
  const SignUpScreen({Key? key, required this.userType}) : super(key: key);

  @override
  State<SignUpScreen> createState() => _SignUpScreenState();
}

class _SignUpScreenState extends State<SignUpScreen> {
  final _formKey = GlobalKey<FormState>();
  final _nameController = TextEditingController();
  final _emailController = TextEditingController();
  final _passwordController = TextEditingController();
  final _confirmPasswordController = TextEditingController();
  final _addressController = TextEditingController();
  final _phoneController = TextEditingController();
  final _locationController = TextEditingController();

  // For Vendor-specific fields
  final _bioController = TextEditingController();
  final _experienceController = TextEditingController();
  List<Map<String, dynamic>> _categories = []; // Categories fetched from API
  Map<String, dynamic>? _selectedCategory; // To store the selected category

  File? _avatarImage;
  String? _avatarFileName;
  String? _base64Image; // To store the Base64 encoded image string
  bool _isLoading = false;
  bool _obscurePassword = true;
  bool _obscureConfirmPassword = true;
  String? _selectedAge;
  GenderType? _selectedGender;
  final List<String> _tripoliStreets = [
    "Martyrs' Square",
    "Al-Mansoura",
    "Gargaresh",
    "Hai Al-Andalus",
    "Ben Ashur",
    "Garden City",
    "Abu Salim",
    "Souk Al-Juma",
    "Janzour"
  ];

  // Location Service
  Location _location = Location();

  @override
  void initState() {
    super.initState();
    _fetchCategories();
  }

  Future<void> _getCurrentLocation() async {
    try {
      bool serviceEnabled = await _location.serviceEnabled();
      if (!serviceEnabled) {
        serviceEnabled = await _location.requestService();
        if (!serviceEnabled) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(content: Text("Location service is not enabled")),
          );
          return;
        }
      }

      PermissionStatus permissionGranted = await _location.hasPermission();
      if (permissionGranted == PermissionStatus.denied) {
        permissionGranted = await _location.requestPermission();
        if (permissionGranted != PermissionStatus.granted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(content: Text("Location permission denied")),
          );
          return;
        }
      }

      LocationData currentLocation = await _location.getLocation();
      setState(() {
        _locationController.text =
            '${currentLocation.latitude}, ${currentLocation.longitude}';
      });
    } catch (e) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text("Error getting location: $e")),
      );
    }
  }

  Future<void> _pickImage() async {
    final pickedFile = await ImagePicker().pickImage(source: ImageSource.gallery);
    if (pickedFile != null) {
      setState(() {
        _avatarImage = File(pickedFile.path); // Store the full path for file operations
        _avatarFileName = path.basename(pickedFile.path); // Extract and store the file name
        _base64Image = base64Encode(_avatarImage!.readAsBytesSync()); // Convert image to Base64 string
      });
    }
  }

  void _fetchCategories() async {
    try {
      final response =
          await http.get(Uri.parse('https://192.168.0.109:7127/api/Category'));
      print(response.statusCode); // Log the response status code
      if (response.statusCode == 200 || response.statusCode == 201) {
        final List<dynamic> data = jsonDecode(response.body);
        setState(() {
          _categories = data.map((item) {
            return {
              'id': item['id'],
              'name': item['name'],
            };
          }).toList();
          if (_categories.isNotEmpty) {
            _selectedCategory =
                _categories[0]; // Set the first category as the default
          }
        });
      } else {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text("Failed to fetch categories")),
        );
      }
    } catch (e) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text("Error fetching categories: $e")),
      );
    }
  }

  Future<void> submitForm() async {
    if (_formKey.currentState?.validate() ?? false) {
      setState(() {
        _isLoading = true;
      });

      final Map<String, dynamic> userData = {
        'userName': _nameController.text,
        'email': _emailController.text,
        'password': _passwordController.text,
        'confirmPassword': _confirmPasswordController.text,
        'userAddress': _addressController.text,
        'phone': _phoneController.text,
        'age': int.tryParse(_selectedAge ?? '0'),
        'gender': _selectedGender == GenderType.male ? 1 : 0,
        'type': widget.userType == 0 ? 0 : 1,
        'image': _base64Image, // Store the Base64 encoded image string
        'location': _locationController.text,
        'fileName': _avatarFileName, // Store only the file name
      };

      try {
        final response = await http.post(
          Uri.parse('https://192.168.0.109:7127/api/user'),
          headers: {
            'Content-Type': 'application/json',
          },
          body: jsonEncode(userData),
        );

        if (response.statusCode == 201) {
          final newUser = jsonDecode(response.body);
          print("New user created with ID: ${newUser['id']}");

          if (widget.userType == 1) {
            // Fetch the user by email to get the user ID using the filter endpoint
            final userResponse = await http.get(
              Uri.parse('https://192.168.0.109:7127/api/user/filter?email=${_emailController.text}')
            );

            if (userResponse.statusCode == 200) {
              final filteredUsers = jsonDecode(userResponse.body);
              if (filteredUsers.isNotEmpty) {
                final fetchedUser = filteredUsers[0];
                final userId = fetchedUser['id'];

                final Map<String, dynamic> vendorData = {
                  'userId': userId,  // Use fetched user ID
                  'categoryId': _selectedCategory != null
                      ? _selectedCategory!['id']
                      : null,
                  'bio': _bioController.text,
                  'experience': int.tryParse(_experienceController.text),
                };

                final vendorResponse = await http.post(
                  Uri.parse('https://192.168.0.109:7127/api/VenderProfile'),
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: jsonEncode(vendorData),
                );

                if (vendorResponse.statusCode == 201) {
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text("Account created successfully!")),
                  );
                  Navigator.pop(context);
                } else {
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text("Error: ${vendorResponse.body}")),
                  );
                  print("Vendor profile creation error: ${vendorResponse.body}");
                }
              } else {
                ScaffoldMessenger.of(context).showSnackBar(
                  SnackBar(content: Text("User not found by email")),
                );
                print("User not found by email: ${userResponse.body}");
              }
            } else {
              ScaffoldMessenger.of(context).showSnackBar(
                SnackBar(content: Text("Error fetching user by email")),
              );
              print("Error fetching user by email: ${userResponse.body}");
            }
          } else {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text("Account created successfully!")),
            );
            Navigator.pop(context);
          }
        } else {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(content: Text("Error: ${response.body}")),
          );
          print("User creation error: ${response.body}");
        }
      } catch (e) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text("Network error: $e")),
        );
        print("Network error: $e");
      } finally {
        setState(() {
          _isLoading = false;
        });
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('Sign Up')),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Form(
          key: _formKey,
          child: SingleChildScrollView(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.stretch,
              children: [
                GestureDetector(
                  onTap: _pickImage,
                  child: CircleAvatar(
                    radius: 100,
                    backgroundImage:
                        _avatarImage != null ? FileImage(_avatarImage!) : null,
                    child: _avatarImage == null
                        ? Icon(Icons.camera_alt, size: 70)
                        : null,
                  ),
                ),
                SizedBox(height: 16),
                _buildTextFormField(
                  controller: _nameController,
                  labelText: 'Name',
                  validator: (value) => value == null || value.isEmpty ? 'Enter your name' : null,
                ),
                SizedBox(height: 16),
                _buildTextFormField(
                  controller: _emailController,
                  labelText: 'Email',
                  validator: (value) => value == null || !value.contains('@') ? 'Enter a valid email' : null,
                ),
                SizedBox(height: 16),
                _buildPasswordFormField(
                  controller: _passwordController,
                  labelText: 'Password',
                  obscureText: _obscurePassword,
                  onToggleVisibility: () {
                    setState(() {
                      _obscurePassword = !_obscurePassword;
                    });
                  },
                  validator: (value) => value == null || value.length < 6 ? 'Password must be at least 6 characters' : null,
                ),
                SizedBox(height: 16),
                _buildPasswordFormField(
                  controller: _confirmPasswordController,
                  labelText: 'Confirm Password',
                  obscureText: _obscureConfirmPassword,
                  onToggleVisibility: () {
                    setState(() {
                      _obscureConfirmPassword = !_obscureConfirmPassword;
                    });
                  },
                  validator: (value) => value != _passwordController.text ? 'Passwords do not match' : null,
                ),
                SizedBox(height: 16),
                _buildDropdownButtonFormField(
                  value: _selectedAge,
                  labelText: 'Age',
                  items: List.generate(100, (index) => (index + 1).toString())
                      .map((age) => DropdownMenuItem(value: age, child: Text(age)))
                      .toList(),
                  onChanged: (value) {
                    setState(() {
                      _selectedAge = value;
                    });
                  },
                  validator: (value) => value == null || value.isEmpty ? 'Select your age' : null,
                ),
                SizedBox(height: 16),
                _buildGenderSelection(),
                SizedBox(height: 16),
                _buildPhoneNumberField(),
                SizedBox(height: 16),
                _buildDropdownButtonFormField(
                  value: _addressController.text.isEmpty ? null : _addressController.text,
                  labelText: 'Address',
                  items: _tripoliStreets
                      .map<DropdownMenuItem<String>>(
                        (street) => DropdownMenuItem<String>(
                          value: street,
                          child: Text(street),
                        ),
                      )
                      .toList(),
                  onChanged: (value) {
                    setState(() {
                      _addressController.text = value!;
                    });
                  },
                  validator: (value) => value == null || value.isEmpty ? 'Select your address' : null,
                ),
                SizedBox(height: 16),
                if (widget.userType == 1) _buildVendorFields(),
                SizedBox(height: 16),
                ElevatedButton(
                  onPressed: _isLoading ? null : submitForm,
                  child: _isLoading
                      ? CircularProgressIndicator(color: Colors.white)
                      : Text('Sign Up'),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }

  Widget _buildTextFormField({
    required TextEditingController controller,
    required String labelText,
    required String? Function(String?) validator,
  }) {
    return TextFormField(
      controller: controller,
      decoration: InputDecoration(labelText: labelText),
      validator: validator,
    );
  }

  Widget _buildPasswordFormField({
    required TextEditingController controller,
    required String labelText,
    required bool obscureText,
    required VoidCallback onToggleVisibility,
    required String? Function(String?) validator,
  }) {
    return TextFormField(
      controller: controller,
      decoration: InputDecoration(
        labelText: labelText,
        suffixIcon: IconButton(
          icon: Icon(obscureText ? Icons.visibility_off : Icons.visibility),
          onPressed: onToggleVisibility,
        ),
      ),
      obscureText: obscureText,
      validator: validator,
    );
  }

  Widget _buildDropdownButtonFormField({
    required String? value,
    required String labelText,
    required List<DropdownMenuItem<String>> items,
    required void Function(String?) onChanged,
    required String? Function(String?) validator,
  }) {
    return DropdownButtonFormField<String>(
      value: value,
      decoration: InputDecoration(labelText: labelText),
      items: items,
      onChanged: onChanged,
      validator: validator,
    );
  }

  Widget _buildGenderSelection() {
    return Row(
      children: [
        Expanded(
          child: ListTile(
            title: Text('Male'),
            leading: Radio<GenderType>(
              value: GenderType.male,
              groupValue: _selectedGender,
              onChanged: (GenderType? value) {
                setState(() {
                  _selectedGender = value;
                });
              },
            ),
          ),
        ),
        Expanded(
          child: ListTile(
            title: Text('Female'),
            leading: Radio<GenderType>(
              value: GenderType.female,
              groupValue: _selectedGender,
              onChanged: (GenderType? value) {
                setState(() {
                  _selectedGender = value;
                });
              },
            ),
          ),
        ),
      ],
    );
  }

  Widget _buildPhoneNumberField() {
    return Row(
      children: [
        Flag.fromString('LY', height: 24, width: 32),
        SizedBox(width: 8),
        Text('+218', style: TextStyle(fontSize: 16)),
        SizedBox(width: 8),
        Expanded(
          child: TextFormField(
            controller: _phoneController,
            keyboardType: TextInputType.phone,
            maxLength: 9,
            decoration: InputDecoration(
              labelText: 'Phone Number',
              counterText: "",
            ),
            validator: (value) {
              if (value == null ||
                  value.isEmpty ||
                  value.length != 9 ||
                  !RegExp(r'^[0-9]+$').hasMatch(value)) {
                return 'Enter a valid 9-digit number';
              }
              return null;
            },
          ),
        ),
      ],
    );
  }

  Widget _buildVendorFields() {
    return Column(
      children: [
        _buildTextFormField(
          controller: _bioController,
          labelText: 'Bio',
          validator: (value) => null,
        ),
        SizedBox(height: 16),
        _buildTextFormField(
          controller: _experienceController,
          labelText: 'Experience (years)',
          validator: (value) => null,
        ),
        SizedBox(height: 16),
        Text('Category'),
        DropdownButtonFormField<Map<String, dynamic>>(
          value: _selectedCategory,
          decoration: InputDecoration(labelText: 'Select Category'),
          items: _categories
              .map((category) => DropdownMenuItem<Map<String, dynamic>>(
                    value: category,
                    child: Text(category['name']),
                  ))
              .toList(),
          onChanged: (newValue) {
            setState(() {
              _selectedCategory = newValue;
            });
          },
          validator: (value) => value == null ? 'Select a category' : null,
        ),
      ],
    );
  }
}